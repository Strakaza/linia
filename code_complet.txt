### ARCHITECTURE DU PROJET ###

[D] __pycache__
    |-- config_data.cpython-313.pyc
    |-- translations.cpython-313.pyc
|-- app.py
|-- build_gtfs.py
|-- code_complet.txt
|-- config_data.py
|-- Dockerfile
|-- extract.py
[D] output_gtfs
    [D] mapping
    [D] temp_blablacar
        |-- agency.txt
        |-- calendar.txt
        |-- calendar_dates.txt
        |-- feed_info.txt
        |-- routes.txt
        |-- stop_times.txt
        |-- stops.txt
        |-- translations.txt
        |-- trips.txt
    [D] temp_flixbus
        |-- agency.txt
        |-- calendar.txt
        |-- calendar_dates.txt
        |-- feed_info.txt
        |-- routes.txt
        |-- shapes.txt
        |-- stop_times.txt
        |-- stops.txt
        |-- transfers.txt
        |-- trips.txt
    [D] unified
        |-- agency.txt
        |-- gtfs.sqlite
        |-- routes.txt
        |-- shapes.txt
        |-- stop_times.txt
        |-- stops.txt
        |-- trips.txt
|-- README.md
|-- requirements.txt
[D] static
    [D] downloads
        |-- gtfs_unifie.zip
    |-- favicon.ico
    |-- i18n.js
    |-- logo.png
    |-- manifest.json
    |-- map.js
    |-- mobile-panels.js
    |-- og-image.png
    |-- planner.js
    |-- robots.txt
    |-- style.css
[D] templates
    |-- about.html
    |-- hreflang.html
    |-- landing.html
    |-- legal.html
    |-- map.html
    |-- planner.html
    |-- seo_head.html
|-- translations.json

==================================================

### CONTENU DES FICHIERS ###

--- DÉBUT FICHIER : app.py ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\app.py ---

import pandas as pd
import os
import sqlite3
import logging
import json
from flask import Flask, jsonify, render_template, request, send_from_directory, redirect, url_for, Response, abort
from flask_cors import CORS
from flask_talisman import Talisman
from flask_caching import Cache
from werkzeug.middleware.proxy_fix import ProxyFix
import traceback
from contextlib import closing

# --- CHARGEMENT DES TRADUCTIONS (FORCED RELOAD) ---
try:
    with open('translations.json', 'r', encoding='utf-8') as f:
        TRANSLATIONS = json.load(f)
except Exception as e:
    print(f"Erreur de chargement du fichier de traduction JSON: {e}")
    TRANSLATIONS = {"fr": {}}

GTFS_DATA_PATH = os.path.join("output_gtfs", "unified")

# Import de la configuration déportée
from config_data import TOP_HUBS, BASE_URL, SUPPORTED_LANGS, DEFAULT_LANG, OG_LOCALES, URL_SLUGS, SEARCH_SYNONYMS, SEO_CONFIG

app = Flask(__name__)
CORS(app)

# Configuration de sécurité CSP
csp = {
    'default-src': "'self'",
    'script-src': ["'self'", "'unsafe-inline'", "'unsafe-eval'", "https://api.mapbox.com", "https://cdn.jsdelivr.net", "https://unpkg.com", "https://cdnjs.cloudflare.com"],
    'style-src': ["'self'", "'unsafe-inline'", "https://api.mapbox.com", "https://fonts.googleapis.com", "https://cdn.jsdelivr.net", "https://unpkg.com"],
    'img-src': ["'self'", "data:", "blob:", "https://*.mapbox.com", "https://liniabus.eu", "https://*.tile.openstreetmap.org", "https://*.basemaps.cartocdn.com"],
    'font-src': ["'self'", "https://fonts.gstatic.com", "https://cdn.jsdelivr.net"],
    'connect-src': ["'self'", "https://api.mapbox.com", "https://events.mapbox.com", "https://unpkg.com", "https://router.project-osrm.org", "https://cdnjs.cloudflare.com"],
    'worker-src': ["'self'", "blob:"],
    'child-src': ["'self'", "blob:"],
}
Talisman(app, content_security_policy=csp, force_https=False)

# Configuration du cache
cache = Cache(app, config={'CACHE_TYPE': 'SimpleCache', 'CACHE_DEFAULT_TIMEOUT': 3600})

# Configuration des logs
log_level_str = os.environ.get("LOG_LEVEL", "INFO").upper()
log_level = getattr(logging, log_level_str, logging.INFO)
app.logger.setLevel(log_level)

# Proxy Fix pour Render/Gunicorn
app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1, x_proto=1, x_host=1, x_port=1)

@app.before_request
def log_request_info():
    app.logger.info(f"Requête reçue: [ANONYME] [{request.method}] {request.url}")

# --- FONCTIONS UTILITAIRES ---

def get_operator_from_id(item_id):
    if item_id is None or not isinstance(item_id, str): return "unknown"
    if item_id.startswith("FLX-") or item_id.startswith("FLX_"): return "flixbus"
    if item_id.startswith("BLA-") or item_id.startswith("BLA_"): return "blablacar_bus"
    return "unknown"

def get_db():
    db_path = os.path.join(GTFS_DATA_PATH, "gtfs.sqlite")
    conn = sqlite3.connect(db_path)
    conn.row_factory = sqlite3.Row
    return conn

def simple_slugify(text):
    text = str(text).lower()
    text = text.replace('é', 'e').replace('è', 'e').replace('ä', 'ae').replace('ö', 'oe').replace('ü', 'ue').replace('ß', 'ss')
    return text.replace(' ', '-').replace("'", "-")

def find_city_by_slug(slug_input):
    slug_input = slug_input.lower()
    for internal_key, data in TOP_HUBS.items():
        slugs = data.get("slugs", {})
        if slug_input in slugs.values() or slug_input == internal_key:
            return internal_key, data
    return None, None

def get_translated_slug(page_key: str, lang: str) -> str:
    if page_key in URL_SLUGS:
        return URL_SLUGS[page_key].get(lang, URL_SLUGS[page_key].get("en", page_key))
    return page_key

def normalize_lang(lang_code: str | None) -> str:
    if not lang_code:
        return DEFAULT_LANG
    lang_code = lang_code.lower()
    return lang_code if lang_code in SUPPORTED_LANGS else DEFAULT_LANG

def get_route_separator(lang_code: str) -> str:
    separators = {
        "fr": "-vers-", "en": "-to-", "de": "-nach-", "es": "-a-", 
        "it": "-verso-", "pt": "-para-", "nl": "-naar-", "pl": "-do-",
        "cs": "-do-", "hu": "-ba-", "ro": "-spre-", "bg": "-do-",
        "ru": "-v-", "tr": "-a-", "uk": "-v-", "sv": "-till-",
        "da": "-til-", "fi": "-naan-", "no": "-til-", "el": "-pros-",
        "hr": "-do-", "sr": "-do-", "sk": "-do-", "sl": "-v-",
        "et": "-sse-", "lv": "-uz-", "lt": "-i-"
    }
    return separators.get(lang_code, "-to-")

def parse_route_slug(slug: str):
    separators = [
        "-vers-", "-to-", "-nach-", "-a-", "-verso-", "-para-", "-naar-", 
        "-do-", "-ba-", "-spre-", "-v-", "-till-", "-til-", "-naan-", "-pros-", "-sse-", "-uz-", "-i-"
    ]
    for sep in separators:
        if sep in slug:
            parts = slug.split(sep)
            if len(parts) == 2:
                return parts[0], parts[1], sep
    return None, None, None

def build_lang_urls(page_key: str, path_slug: str | None = None) -> dict:
    urls = {}
    is_city_page = (page_key == "city")
    city_data = None
    if is_city_page and path_slug:
        city_data = TOP_HUBS.get(path_slug)

    for lang in SUPPORTED_LANGS:
        current_slug = None
        if is_city_page and city_data:
            local_slug = city_data["slugs"].get(lang, city_data["slugs"].get("default"))
            current_slug = f"bus/{local_slug}"
        elif path_slug is not None and not is_city_page:
            current_slug = path_slug
        else:
            current_slug = get_translated_slug(page_key, lang)

        prefix = f"{BASE_URL}"
        if lang != "fr":
            prefix += f"/{lang}"
        if current_slug and current_slug != "home":
            urls[lang] = f"{prefix}/{current_slug}"
        else:
            urls[lang] = f"{prefix}/"

    urls["x-default"] = BASE_URL + "/"
    return urls

def get_seo_meta(page_key: str, lang: str, path_slug: str | None = None) -> dict:
    lang = normalize_lang(lang)
    page_conf = SEO_CONFIG.get(page_key, {})
    lang_conf = page_conf.get(lang) or page_conf.get(DEFAULT_LANG, {})

    lang_urls = build_lang_urls(page_key, path_slug=path_slug)
    current_url = lang_urls.get(lang, BASE_URL + "/")

    title = lang_conf.get("title", "Linia")
    description = lang_conf.get("description", "Linia - Visualisation et planification de lignes de bus longue distance en Europe.")

    og_locale = OG_LOCALES.get(lang, OG_LOCALES.get(DEFAULT_LANG))
    og_locale_alternates = [OG_LOCALES[l] for l in SUPPORTED_LANGS if l in OG_LOCALES and l != lang]

    return {
        "page_title": title,
        "page_description": description,
        "canonical_url": current_url,
        "og_title": title,
        "og_description": description,
        "og_url": current_url,
        "og_locale": og_locale,
        "og_locale_alternates": og_locale_alternates,
        "hreflang_urls": lang_urls,
    }

def get_structured_data(page_key: str, lang: str, current_url: str) -> str | None:
    data = []
    if page_key == "home":
        data.append({"@context": "https://schema.org", "@type": "Organization", "name": "Linia", "url": BASE_URL + "/", "logo": BASE_URL + "/static/logo.png"})
        data.append({
            "@context": "https://schema.org",
            "@type": "WebSite",
            "name": "Linia - Bus Route Planner",
            "url": BASE_URL + "/",
            "potentialAction": {
                "@type": "SearchAction",
                "target": BASE_URL + "/" + get_translated_slug("planner", lang) + "?q={search_term_string}",
                "query-input": "required name=search_term_string",
            },
        })
    if page_key == "planner":
        data.append({
            "@context": "https://schema.org", "@type": "Trip", "name": "European bus itinerary planner",
            "description": "Interactive tool to plan multi-step bus itineraries across Europe using FlixBus and BlaBlaCar routes.",
            "url": current_url, "provider": {"@type": "Organization", "name": "Linia", "url": BASE_URL + "/"},
            "areaServed": {"@type": "AdministrativeArea", "name": "Europe"},
        })
    if page_key == "about" and lang == "fr":
        data.append({
            "@context": "https://schema.org",
            "@type": "FAQPage",
            "mainEntity": [
                {"@type": "Question", "name": "Linia est-il gratuit ?", "acceptedAnswer": {"@type": "Answer", "text": "Oui, l'outil est entièrement gratuit et sans publicité."}},
                {"@type": "Question", "name": "Quels sont les pays couverts par Linia ?", "acceptedAnswer": {"@type": "Answer", "text": "Linia couvre principalement l'Europe : France, Allemagne, Espagne, Italie, Benelux, et d'autres pays européens desservis par FlixBus et BlaBlaCar Bus."}},
                {"@type": "Question", "name": "À quelle fréquence les données sont-elles mises à jour ?", "acceptedAnswer": {"@type": "Answer", "text": "Les données GTFS sont mises à jour le premier jour de chaque mois."}},
                {"@type": "Question", "name": "Comment signaler une erreur ou proposer une amélioration ?", "acceptedAnswer": {"@type": "Answer", "text": "Vous pouvez ouvrir une issue sur le dépôt GitHub du projet ou contacter le développeur via contact@liniabus.eu"}},
            ],
        })
    if page_key in {"home", "map", "planner", "about", "legal"}:
        items = [{"@type": "ListItem", "position": 1, "name": "Linia", "item": BASE_URL + "/"}]
        if page_key != "home":
            name_map = {"map": "Map", "planner": "Planner", "about": "About", "legal": "Legal"}
            items.append({"@type": "ListItem", "position": 2, "name": name_map.get(page_key, page_key.title()), "item": current_url})
        data.append({"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": items})

    if not data: return None
    try: return json.dumps(data, ensure_ascii=False)
    except Exception: return None

# --- REQUÊTES BDD GTFS ---

def get_stop_info_and_routes(stop_id_input):
    try:
        with closing(get_db()) as conn:
            s_id = str(stop_id_input)
            stop_row = conn.execute("SELECT stop_id, stop_name, stop_lat, stop_lon FROM stops WHERE stop_id = ?", (s_id,)).fetchone()
            
            if not stop_row:
                return {"error": f"L'arrêt avec l'ID '{s_id}' n'a pas été trouvé."}
                
            stop_details = {
                "stop_id": stop_row['stop_id'],
                "stop_name": stop_row['stop_name'] or '',
                "stop_lat": stop_row['stop_lat'],
                "stop_lon": stop_row['stop_lon']
            }
            
            query = """
                SELECT DISTINCT
                    t.trip_id,
                    t.route_id,
                    COALESCE(t.trip_headsign, '') as trip_headsign,
                    COALESCE(r.route_long_name, '') as route_long_name,
                    COALESCE(r.route_short_name, '') as route_short_name
                FROM stop_times st
                JOIN trips t ON st.trip_id = t.trip_id
                JOIN routes r ON t.route_id = r.route_id
                WHERE st.stop_id = ?
            """
            routes_cursor = conn.execute(query, (s_id,))
            passing_routes = []
            seen_routes = set()
            
            for row in routes_cursor:
                route_id = row['route_id']
                headsign = row['trip_headsign']
                long_name = row['route_long_name']
                short_name = row['route_short_name']
                display_name = headsign if headsign else long_name
                display_name = display_name if display_name else (short_name or 'Itinéraire sans nom')
                operator = get_operator_from_id(route_id)
                
                uniq_key = (route_id, display_name, operator)
                if uniq_key not in seen_routes:
                    seen_routes.add(uniq_key)
                    passing_routes.append({
                        "trip_id": row['trip_id'],
                        "route_id": route_id,
                        "display_name": display_name,
                        "operator": operator
                    })

            if not passing_routes:
                return { "stop_info": stop_details, "routes": [], "message": "Aucun itinéraire pour cet arrêt." }
            return { "stop_info": stop_details, "routes": passing_routes }
            
    except Exception as e:
        app.logger.error(f"SQL Error in get_stop_info: {e}")
        return {"error": "Erreur serveur lors de la récupération des données GTFS."}

def get_trip_details_and_shape(trip_id_input):
    try:
        with closing(get_db()) as conn:
            t_id = str(trip_id_input)
            trip_row = conn.execute("SELECT trip_id, shape_id, route_id FROM trips WHERE trip_id = ?", (t_id,)).fetchone()
            
            if not trip_row:
                return {"error": f"Voyage non trouvé."}
                
            shape_id = trip_row['shape_id']
            operator = get_operator_from_id(trip_row['route_id']) # Utilise route_id pour déterminer l'opérateur
            
            stops_query = """
                SELECT 
                    s.stop_id, s.stop_name, s.stop_lat, s.stop_lon, st.stop_sequence, st.arrival_time
                FROM stop_times st
                JOIN stops s ON st.stop_id = s.stop_id
                WHERE st.trip_id = ?
                ORDER BY CAST(st.stop_sequence AS INTEGER)
            """
            ordered_stops = []
            for row in conn.execute(stops_query, (t_id,)):
                ordered_stops.append({
                    "stop_id": row['stop_id'],
                    "stop_name": row['stop_name'] or '',
                    "stop_lat": row['stop_lat'],
                    "stop_lon": row['stop_lon'],
                    "arrival_time": row['arrival_time']
                })
                
            trip_shape_points = []
            if shape_id:
                shape_query = "SELECT shape_pt_lat, shape_pt_lon FROM shapes WHERE shape_id = ? ORDER BY CAST(shape_pt_sequence AS INTEGER)"
                for row in conn.execute(shape_query, (str(shape_id),)):
                    trip_shape_points.append([row['shape_pt_lat'], row['shape_pt_lon']])
            
            return {
                "trip_id": t_id,
                "stops": ordered_stops,
                "shape_points": trip_shape_points,
                "operator": operator
            }
    except Exception as e:
        app.logger.error(f"SQL Error in get_trip_details: {e}")
        return {"error": "Erreur serveur lors de la récupération des données de voyage."}

def try_find_stop_by_slug(slug):
    try:
        with closing(get_db()) as conn:
            cursor = conn.execute("SELECT stop_id, stop_name FROM stops")
            for row in cursor:
                if simple_slugify(row['stop_name']) == slug:
                    return {
                        "id": row['stop_id'],
                        "name": row['stop_name'],
                        "slugs": {"default": slug} 
                    }
    except Exception as e:
        app.logger.error(f"Erreur recherche dynamique slug: {e}")
    return None

def get_ssr_connected_stops(stop_id, current_lang, source_slug=None):
    """Récupère les villes connectées pour le maillage SEO. Transforme les liens en A vers B."""
    if not source_slug:
        for hub_key, hub_data in TOP_HUBS.items():
            if str(hub_data["id"]) == str(stop_id):
                source_slug = hub_data["slugs"].get(current_lang, hub_data["slugs"].get("default"))
                break
        if not source_slug:
            with closing(get_db()) as conn:
                row = conn.execute("SELECT stop_name FROM stops WHERE stop_id = ?", (str(stop_id),)).fetchone()
                if row: source_slug = simple_slugify(row['stop_name'])
                else: source_slug = "depart"

    try:
        query = """
            SELECT DISTINCT s.stop_id, s.stop_name
            FROM stop_times st1
            JOIN stop_times st2 ON st1.trip_id = st2.trip_id
            JOIN stops s ON st2.stop_id = s.stop_id
            WHERE st1.stop_id = ? AND st2.stop_id != ?
            ORDER BY s.stop_name
            LIMIT 80
        """
        with closing(get_db()) as conn:
            cursor = conn.execute(query, (str(stop_id), str(stop_id)))
            results = []
            sep = get_route_separator(current_lang)
            for row in cursor:
                s_id = row['stop_id']
                s_name = row['stop_name'] or ''
                city_slug = None
                # Cherche slug traduit si top hub
                for hub_key, hub_data in TOP_HUBS.items():
                    if str(hub_data["id"]) == str(s_id):
                        city_slug = hub_data["slugs"].get(current_lang, hub_data["slugs"].get("default"))
                        break
                if not city_slug:
                    city_slug = simple_slugify(s_name)
                
                prefix = f"{BASE_URL}"
                if current_lang != "fr":
                    prefix += f"/{current_lang}"
                
                link_url = f"{prefix}/bus/{source_slug}{sep}{city_slug}"
                results.append({"name": s_name, "url": link_url})
            return results
    except Exception as e:
        app.logger.error(f"Erreur SSR connected_stops : {e}")
        return []

# --- RENDU DE PAGE ---

def _render_page(page_key: str, lang_code: str | None, template_name: str, path_slug: str | None = None, **kwargs):
    current_lang = normalize_lang(lang_code)
    
    if "seo_meta_override" in kwargs:
        seo_meta = kwargs.pop("seo_meta_override")
        structured_jsonld = None
    else:
        seo_meta = get_seo_meta(page_key, current_lang, path_slug=path_slug)
        structured_jsonld = get_structured_data(
            page_key, current_lang, seo_meta.get("canonical_url", BASE_URL + "/")
        )

    def translate(key, **t_kwargs):
        try:
            with open('translations.json', 'r', encoding='utf-8') as f:
                current_translations = json.load(f)
        except:
            current_translations = TRANSLATIONS
            
        dict_lang = current_translations.get(current_lang, current_translations.get('fr', {}))
        if 'count' in t_kwargs:
            count = t_kwargs['count']
            plural_key = f"{key}_one" if count == 1 else f"{key}_other"
            if plural_key in dict_lang:
                key = plural_key
        text = dict_lang.get(key, key)
        for k, v in t_kwargs.items():
            text = text.replace(f"{{{k}}}", str(v))
        return text

    def get_url(page_key_target):
        if page_key_target == "home":
            return "/" if current_lang == "fr" else f"/{current_lang}/"
        slug = get_translated_slug(page_key_target, current_lang)
        return f"/{slug}" if current_lang == "fr" else f"/{current_lang}/{slug}"

    try:
        with open('translations.json', 'r', encoding='utf-8') as f:
            current_translations = json.load(f)
    except:
        current_translations = TRANSLATIONS

    dict_lang = current_translations.get(current_lang, current_translations.get('fr', {}))

    context = {
        "current_lang": current_lang,
        "page_title": seo_meta["page_title"],
        "page_description": seo_meta["page_description"],
        "canonical_url": seo_meta["canonical_url"],
        "og_title": seo_meta["og_title"],
        "og_description": seo_meta["og_description"],
        "og_url": seo_meta["og_url"],
        "og_locale": seo_meta.get("og_locale"),
        "hreflang_urls": seo_meta["hreflang_urls"],
        "structured_data_jsonld": structured_jsonld,
        "t": translate,  
        "t_dict": dict_lang,
        "url_for_page": get_url 
    }
    context.update(kwargs)
    return render_template(template_name, **context)

def city_seo_page(url_slug, lang_code=None):
    """Génère la page SEO d'une ville spécifique."""
    current_lang = normalize_lang(lang_code)
    
    # 1. Recherche dans TOP_HUBS
    internal_key, city_info = find_city_by_slug(url_slug)
    
    # 2. FALLBACK : Recherche GTFS
    is_generic_city = False
    if not city_info:
        city_info = try_find_stop_by_slug(url_slug)
        is_generic_city = True
    
    if not city_info:
        return redirect(url_for('index', lang_code=normalize_lang(lang_code)))
        
    city_name = city_info["name"]
    stop_id = city_info["id"]
    
    # Textes SEO simplifiés pour l'exemple (tu peux réintégrer tes gros dictionnaires ici ou les importer)
    title = f"Bus depuis {city_name} : Lignes directes"
    desc = f"Découvrez toutes les lignes de bus au départ de {city_name}. Comparateur FlixBus et BlaBlaCar."
    
    lang_urls = {}
    if not is_generic_city:
        lang_urls = build_lang_urls("city", path_slug=internal_key)
    else:
        current_path = f"bus/{url_slug}"
        lang_urls = {
            "x-default": f"{BASE_URL}/{current_path}",
            current_lang: f"{BASE_URL}/{current_lang if current_lang != 'fr' else ''}/{current_path}".replace('//', '/')
        }

    current_url = lang_urls.get(current_lang, BASE_URL + "/")
    
    custom_seo = {
        "page_title": title,
        "page_description": desc,
        "canonical_url": current_url,
        "og_title": title,
        "og_description": desc,
        "og_url": current_url,
        "hreflang_urls": lang_urls,
    }

    connected_dests = get_ssr_connected_stops(stop_id, current_lang, url_slug)
    
    return _render_page(
        page_key="city", 
        lang_code=current_lang, 
        template_name="map.html", 
        path_slug=f"bus/{url_slug}", 
        seo_meta_override=custom_seo,
        preloaded_stop_id=stop_id,
        preloaded_stop_name=city_name,
        connected_destinations=connected_dests
    )

def route_a_to_b_page(slug_a, slug_b, lang_code=None):
    current_lang = normalize_lang(lang_code)
    
    # 1. Trouver les villes
    key_a, city_a = find_city_by_slug(slug_a)
    if not city_a:
        city_a = try_find_stop_by_slug(slug_a)
        key_a = slug_a
        
    key_b, city_b = find_city_by_slug(slug_b)
    if not city_b:
        city_b = try_find_stop_by_slug(slug_b)
        key_b = slug_b
        
    if not city_a or not city_b:
        abort(404)
        
    name_a, name_b = city_a["name"], city_b["name"]
    
    # Textes SEO ciblés "A vers B"
    title_translations = {
        "fr": f"Bus {name_a} ↔ {name_b} : Carte, Lignes et Comparateur",
        "en": f"Bus {name_a} ↔ {name_b} : Map, Routes and Tickets",
        "de": f"Bus {name_a} ↔ {name_b} : Karte, Routen und Tickets",
        "es": f"Autobús {name_a} ↔ {name_b} : Mapa, Rutas y Billetes",
        "it": f"Autobus {name_a} ↔ {name_b} : Mappa, Percorsi e Biglietti"
    }
    desc_translations = {
        "fr": f"Visualisez le trajet en bus de {name_a} à {name_b} sur notre carte interactive. Comparez les lignes FlixBus et BlaBlaCar pour ce trajet.",
        "en": f"View the bus route from {name_a} to {name_b} on our interactive map. Compare FlixBus and BlaBlaCar routes for this journey.",
        "de": f"Sehen Sie sich die Buslinie von {name_a} nach {name_b} auf unserer interaktiven Karte an. Vergleichen Sie FlixBus und BlaBlaCar für diese Strecke.",
        "es": f"Vea la ruta de autobús de {name_a} a {name_b} en nuestro mapa interactivo. Compare las rutas de FlixBus y BlaBlaCar para este viaje.",
        "it": f"Visualizza il percorso in autobus da {name_a} a {name_b} sulla nostra mappa interattiva. Confronta le linee FlixBus e BlaBlaCar per questo viaggio."
    }
    
    title = title_translations.get(current_lang, f"Bus {name_a} ↔ {name_b} : Map, Routes and Tickets")
    desc = desc_translations.get(current_lang, f"View the bus route from {name_a} to {name_b} on our interactive map. Compare FlixBus and BlaBlaCar routes for this journey.")
    
    # Build equivalent urls for hreflang
    lang_urls = {}
    for lang in SUPPORTED_LANGS:
        sep = get_route_separator(lang)
        slug_a_lang = city_a["slugs"].get(lang, city_a["slugs"].get("default")) if "slugs" in city_a else simple_slugify(name_a)
        slug_b_lang = city_b["slugs"].get(lang, city_b["slugs"].get("default")) if "slugs" in city_b else simple_slugify(name_b)
        
        prefix = f"{BASE_URL}"
        if lang != "fr":
            prefix += f"/{lang}"
            
        lang_urls[lang] = f"{prefix}/bus/{slug_a_lang}{sep}{slug_b_lang}"
        if lang == "en":
            lang_urls["x-default"] = lang_urls[lang]
            
    if "x-default" not in lang_urls:
         lang_urls["x-default"] = lang_urls["fr"]

    current_url = lang_urls.get(current_lang, BASE_URL + "/")
    
    custom_seo = {
        "page_title": title,
        "page_description": desc,
        "canonical_url": current_url,
        "og_title": title,
        "og_description": desc,
        "og_url": current_url,
        "hreflang_urls": lang_urls,
    }
    
    return _render_page(
        page_key="route_a_b",
        lang_code=current_lang,
        template_name="map.html",
        seo_meta_override=custom_seo,
        preloaded_start_id=city_a["id"],
        preloaded_end_id=city_b["id"],
        city_a_name=name_a,
        city_b_name=name_b
    )

# --- ROUTES ---

@app.route("/")
def index():
    detected_lang = request.accept_languages.best_match(SUPPORTED_LANGS)
    if detected_lang and detected_lang != DEFAULT_LANG:
        return redirect(f"/{detected_lang}/")
    return _render_page("home", "fr", "landing.html")

@app.route('/download/gtfs_unifie')
def download_unified_gtfs():
    try:
        static_downloads_path = os.path.join(app.root_path, 'static', 'downloads')
        return send_from_directory(static_downloads_path, 'gtfs_unifie.zip', as_attachment=True)
    except Exception as e:
        app.logger.error(f"Erreur téléchargement GTFS: {e}")
        abort(404)

@app.route("/<path:path>", strict_slashes=False)
def universal_router(path):
    parts = path.strip('/').split('/')
    
    if len(parts) == 1 and parts[0] in SUPPORTED_LANGS:
        return _render_page("home", parts[0], "landing.html")
        
    if len(parts) == 2 and parts[0] == "bus":
        slug_a, slug_b, sep = parse_route_slug(parts[1])
        if slug_a and slug_b:
            return route_a_to_b_page(slug_a, slug_b, "fr")
        return city_seo_page(parts[1], "fr")
        
    if len(parts) == 3 and parts[0] in SUPPORTED_LANGS and parts[1] == "bus":
        slug_a, slug_b, sep = parse_route_slug(parts[2])
        if slug_a and slug_b:
            return route_a_to_b_page(slug_a, slug_b, parts[0])
        return city_seo_page(parts[2], parts[0])
        
    if len(parts) == 1:
        slug = parts[0]
        for page_key, translations in URL_SLUGS.items():
            if slug == translations.get("fr", page_key):
                return _render_page(page_key, "fr", f"{page_key}.html")
                
    if len(parts) == 2 and parts[0] in SUPPORTED_LANGS:
        lang = parts[0]
        slug = parts[1]
        for page_key, translations in URL_SLUGS.items():
            expected_slug = translations.get(lang, translations.get("en", page_key))
            if slug == expected_slug:
                return _render_page(page_key, lang, f"{page_key}.html")
                
    abort(404)

@app.route('/robots.txt')
def robots_txt():
    return send_from_directory(app.static_folder, 'robots.txt')

@app.route('/sitemap.xml')
@cache.cached(timeout=86400)
def sitemap():
    pages = ["home", "map", "planner", "about", "legal"]
    xml = '<?xml version="1.0" encoding="UTF-8"?>\n<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xhtml="http://www.w3.org/1999/xhtml">\n'
    
    for page in pages:
        urls = build_lang_urls(page)
        for lang in SUPPORTED_LANGS:
            if lang not in urls: continue
            xml += f'  <url>\n    <loc>{urls[lang]}</loc>\n'
            for alt_lang, alt_url in urls.items():
                xml += f'    <xhtml:link rel="alternate" hreflang="{alt_lang}" href="{alt_url}" />\n'
            xml += '  </url>\n'

    for city_key in TOP_HUBS.keys():
        urls = build_lang_urls("city", path_slug=city_key)
        for lang in SUPPORTED_LANGS:
            if lang not in urls: continue
            xml += f'  <url>\n    <loc>{urls[lang]}</loc>\n'
            for alt_lang, alt_url in urls.items():
                xml += f'    <xhtml:link rel="alternate" hreflang="{alt_lang}" href="{alt_url}" />\n'
            xml += '  </url>\n'

    # Trajets A vers B (Top combinations)
    import itertools
    hub_keys = list(TOP_HUBS.keys())[:11]
    for key_a, key_b in itertools.permutations(hub_keys, 2):
        lang_urls = {}
        for lang in SUPPORTED_LANGS:
            sep = get_route_separator(lang)
            slug_a_lang = TOP_HUBS[key_a]["slugs"].get(lang, TOP_HUBS[key_a]["slugs"].get("default"))
            slug_b_lang = TOP_HUBS[key_b]["slugs"].get(lang, TOP_HUBS[key_b]["slugs"].get("default"))
            prefix = f"{BASE_URL}"
            if lang != "fr":
                prefix += f"/{lang}"
            lang_urls[lang] = f"{prefix}/bus/{slug_a_lang}{sep}{slug_b_lang}"
            
        for lang, url in lang_urls.items():
            if lang not in SUPPORTED_LANGS: continue
            xml += f'  <url>\n    <loc>{url}</loc>\n'
            for alt_lang, alt_url in lang_urls.items():
                xml += f'    <xhtml:link rel="alternate" hreflang="{alt_lang}" href="{alt_url}" />\n'
            xml += '  </url>\n'
            
    xml += '</urlset>'
    return Response(xml, mimetype='application/xml')

# --- API ENDPOINTS ---

@app.route('/api/search_stops', methods=['GET'])
def api_search_stops():
    query_term = request.args.get('query', default='', type=str).strip()
    if not query_term or len(query_term) < 2: return jsonify([]), 200
    
    query_lower = query_term.lower()
    search_targets = {query_lower}
    for synonym, standard_name in SEARCH_SYNONYMS.items():
        if synonym.startswith(query_lower):
            search_targets.add(standard_name.lower())
    
    try:
        with closing(get_db()) as conn:
            conditions = ["stop_name LIKE ?" for _ in search_targets]
            params = [f"%{target}%" for target in search_targets]
            where_clause = " OR ".join(conditions)
            query = f"SELECT stop_id, stop_name FROM stops WHERE {where_clause} LIMIT 10"
            cursor = conn.execute(query, params)
            results = [{"stop_id": row['stop_id'], "stop_name": row['stop_name']} for row in cursor]
            return jsonify(results)
    except Exception as e:
        app.logger.error(f"Search error: {e}")
        return jsonify({"error": "Internal search error"}), 500

@app.route('/api/stop_info/<stop_id>', methods=['GET'])
@cache.cached(timeout=3600)
def api_get_stop_info(stop_id):
    try:
        data = get_stop_info_and_routes(stop_id)
        if "error" in data: return jsonify(data), 404
        return jsonify(data)
    except Exception: return jsonify({"error": "Server error"}), 500

@app.route('/api/trip_details/<trip_id>', methods=['GET'])
@cache.cached(timeout=3600)
def api_get_trip_details(trip_id):
    try:
        data = get_trip_details_and_shape(trip_id)
        if "error" in data: return jsonify(data), 404
        return jsonify(data)
    except Exception: return jsonify({"error": "Server error"}), 500

@app.route('/api/connected_stops/<stop_id>', methods=['GET'])
@cache.cached(timeout=3600)
def api_get_connected_stops(stop_id):
    try:
        query = """
            SELECT DISTINCT
                s.stop_id, s.stop_name, s.stop_lat, s.stop_lon, t.route_id
            FROM stop_times st1
            JOIN stop_times st2 ON st1.trip_id = st2.trip_id
            JOIN stops s ON st2.stop_id = s.stop_id
            JOIN trips t ON st1.trip_id = t.trip_id
            WHERE st1.stop_id = ? AND st2.stop_id != ?
        """
        with closing(get_db()) as conn:
            cursor = conn.execute(query, (str(stop_id), str(stop_id)))
            stop_map = {}
            for row in cursor:
                s_id = row['stop_id']
                if s_id not in stop_map:
                    stop_map[s_id] = {
                        "stop_id": s_id,
                        "stop_name": row['stop_name'] or '',
                        "stop_lat": float(row['stop_lat']) if row['stop_lat'] else None,
                        "stop_lon": float(row['stop_lon']) if row['stop_lon'] else None,
                        "operators_set": set()
                    }
                op = get_operator_from_id(row['route_id'])
                if op and op != 'unknown':
                    stop_map[s_id]['operators_set'].add(op)
                    
            results = []
            for s_id, data in stop_map.items():
                ops = sorted(list(data['operators_set']))
                if not ops: ops = ['flixbus']
                data['operators'] = ops
                del data['operators_set']
                results.append(data)
                
            results.sort(key=lambda x: x["stop_name"])
            return jsonify(results)
    except Exception as e:
        app.logger.error(f"Erreur API connected_stops : {e}")
        return jsonify({"error": "Erreur interne."}), 500

if __name__ == "__main__":
    app.logger.info("--- DÉMARRAGE MODE DÉVELOPPEMENT ---")
    app.run(debug=True, host='0.0.0.0', port=int(os.environ.get("PORT", 5000)))

--- FIN FICHIER ---

--- DÉBUT FICHIER : build_gtfs.py ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\build_gtfs.py ---

import pandas as pd
import numpy as np
import requests
import zipfile
import io
import os
import logging
import re
from math import radians, sin, cos, sqrt, atan2
from datetime import datetime, timedelta
import shutil


logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)



SOURCES = {
    "flixbus": {
        "url": "https://www.data.gouv.fr/api/1/datasets/r/30d94e83-48a4-4c44-8a96-c082377f5221",
        "prefix": "FLX_",
    },
    "blablacar": {
        "url": "https://www.data.gouv.fr/api/1/datasets/r/fd54f81f-4389-4e73-be75-491133d011c3",
        "prefix": "BLA_",
    }
}

OUTPUT_DIR = "output_gtfs"
UNIFIED_DIR = os.path.join(OUTPUT_DIR, "unified")
MAPPING_DIR = os.path.join(OUTPUT_DIR, "mapping")

MAJOR_CITIES = [
    "Berlin", "Paris", "Londres", "London", "Rome", "Madrid", "Barcelona", "Barcelone",
    "Munich", "München", "Milan", "Milano", "Amsterdam", "Vienna", "Wien", "Prague", "Praha",
    "Warsaw", "Warszawa", "Brussels", "Bruxelles", "Budapest", "Lyon", "Marseille",
    "Toulouse", "Bordeaux", "Lille", "Strasbourg", "Frankfurt", "Francfort", "Hamburg", "Hambourg",
    "Cologne", "Köln", "Naples", "Napoli", "Turin", "Torino", "Lisbon", "Lisboa", "Porto",
    "Stockholm", "Copenhagen", "Copenhague", "Oslo", "Helsinki", "Zurich", "Zürich", "Geneva", "Genève",
    "Nantes", "Rennes", "Montpellier", "Nice", "Bremen", "Hannover", "Stuttgart", "Leipzig", "Dresden",
    "Krakow", "Kraków", "Sevilla", "Seville", "Valencia", "Valence", "Zaragoza", "Malaga"
]

def clean_display_name(name):
    if not name or not isinstance(name, str):
        return "Itinéraire inconnu"
    name = name.strip()
    if " > " in name:
        parts = [p.strip() for p in name.split(" > ")]
        if len(parts) > 2:
            return f"{parts[0]} > {parts[-1]}"
        return name
    if " - " in name:
        parts = [p.strip() for p in name.split(" - ")]
        if len(parts) > 2:
            return f"{parts[0]} - {parts[-1]}"
        return name
    return name

def get_city_name(stop_name):
    if not stop_name or not isinstance(stop_name, str):
        return "Unknown"

    cleaned_name = stop_name.strip()

    separators = [" - ", " (", ", ", " – ", " — ", " | "]
    for sep in separators:
        if sep in cleaned_name:
            cleaned_name = cleaned_name.split(sep)[0].strip()

    lower_name = cleaned_name.lower()
    for city in MAJOR_CITIES:
        lower_city = city.lower()
        if lower_name.startswith(lower_city + " ") or lower_name.startswith(lower_city + "-"):
            return city
        if lower_name == lower_city:
            return city

    suffixes_to_remove = [
        " central bus station", " central station", " bus station",
        " airport", " aéroport", " aeroport", " hbf", " zob", " p+r",
        " gare routière", " gare", " sud", " nord", " est", " ouest"
    ]
    for suffix in suffixes_to_remove:
        if cleaned_name.lower().endswith(suffix):
            cleaned_name = cleaned_name[:len(cleaned_name)-len(suffix)].strip()

    return cleaned_name

def download_and_extract(url, operator_key):
    logger.info(f"Téléchargement de {operator_key}...")
    try:
        response = requests.get(url, timeout=120)
        response.raise_for_status()
        temp_dir = os.path.join(OUTPUT_DIR, f"temp_{operator_key}")
        os.makedirs(temp_dir, exist_ok=True)
        with zipfile.ZipFile(io.BytesIO(response.content)) as z:
            z.extractall(temp_dir)
        return temp_dir
    except Exception as e:
        logger.error(f"Erreur téléchargement {operator_key}: {e}")
        return None

def load_gtfs_file(path, filename, prefix):
    file_path = os.path.join(path, filename)
    if not os.path.exists(file_path):
        return pd.DataFrame()
    try:
        df = pd.read_csv(file_path, dtype=str, keep_default_na=False, na_values=['', ' '])
    except pd.errors.EmptyDataError:
        return pd.DataFrame()

    id_cols = ['stop_id', 'trip_id', 'route_id', 'agency_id', 'shape_id', 'service_id', 'from_stop_id', 'to_stop_id']
    for col in df.columns:
        if col in id_cols:
            df[col] = df[col].apply(lambda x: f"{prefix}{x}" if pd.notna(x) and x != '' else x)
    return df

def get_valid_services(calendar_df, calendar_dates_df, start_date, end_date):
    valid_services = set()

    if not calendar_df.empty:
        for _, row in calendar_df.iterrows():
            svc_id = row.get('service_id')
            start_svc = row.get('start_date')
            end_svc = row.get('end_date')

            if not svc_id or not start_svc or not end_svc:
                continue
            try:
                d_start = datetime.strptime(str(start_svc), '%Y%m%d')
                d_end = datetime.strptime(str(end_svc), '%Y%m%d')
                if d_start <= end_date and d_end >= start_date:
                    valid_services.add(svc_id)
            except ValueError:
                continue

    if not calendar_dates_df.empty:
        adds = calendar_dates_df[calendar_dates_df['exception_type'] == '1']
        for _, row in adds.iterrows():
            svc_id = row.get('service_id')
            date_svc = row.get('date')
            if not svc_id or not date_svc:
                continue
            try:
                d_svc = datetime.strptime(str(date_svc), '%Y%m%d')
                if start_date <= d_svc <= end_date:
                    valid_services.add(svc_id)
            except ValueError:
                continue

    return valid_services


def aggregate_by_city_select_flixbus(stops_df):
    logger.info("Étape : Agrégation par ville (Sélection arrêt FlixBus réel)...")

    stops_df['city_name'] = stops_df['stop_name'].apply(get_city_name)
    stops_df['lat_num'] = pd.to_numeric(stops_df['stop_lat'], errors='coerce')
    stops_df['lon_num'] = pd.to_numeric(stops_df['stop_lon'], errors='coerce')

    stops_df['is_flixbus'] = stops_df['stop_id'].str.startswith('FLX_')

    stops_df_sorted = stops_df.sort_values(by='is_flixbus', ascending=False)
    master_stops = stops_df_sorted.drop_duplicates(subset=['city_name'], keep='first').copy()

    city_to_master_id = dict(zip(master_stops['city_name'], master_stops['stop_id']))
    stop_to_city = dict(zip(stops_df['stop_id'], stops_df['city_name']))

    stop_mapping = {}
    for stop_id, city in stop_to_city.items():
        stop_mapping[stop_id] = city_to_master_id.get(city, stop_id)

    final_stops = master_stops.copy()
    final_stops['stop_name'] = final_stops['city_name']
    final_stops['stop_lat'] = final_stops['lat_num']
    final_stops['stop_lon'] = final_stops['lon_num']

    cols_to_keep = ['stop_id', 'stop_name', 'stop_lat', 'stop_lon', 'location_type', 'parent_station']
    for col in cols_to_keep:
        if col not in final_stops.columns:
            final_stops[col] = ''

    final_stops = final_stops[cols_to_keep]
    final_stops['location_type'] = '1'

    logger.info(f"Création de {len(final_stops)} villes uniques (points réels).")

    return final_stops, stop_mapping

def clean_stop_sequences(stop_times_df, stop_mapping):
    logger.info("Nettoyage des séquences d'arrêts...")

    stop_times_df['stop_id'] = stop_times_df['stop_id'].map(stop_mapping).fillna(stop_times_df['stop_id'])
    stop_times_df['stop_sequence'] = pd.to_numeric(stop_times_df['stop_sequence'], errors='coerce')
    stop_times_df = stop_times_df.sort_values(['trip_id', 'stop_sequence'])

    stop_times_df['prev_stop_id'] = stop_times_df.groupby('trip_id')['stop_id'].shift(1)

    cleaned_df = stop_times_df[
        (stop_times_df['prev_stop_id'] != stop_times_df['stop_id']) |
        (stop_times_df['prev_stop_id'].isna())
    ].copy()

    cleaned_df['stop_sequence'] = cleaned_df.groupby('trip_id').cumcount() + 1
    cleaned_df = cleaned_df.drop(columns=['prev_stop_id'])

    logger.info(f"Séquences nettoyées : {len(stop_times_df)} -> {len(cleaned_df)} arrêts.")
    return cleaned_df

def simplify_trips(trips_df, stop_times_df):
    logger.info("Simplification des trajets (Suppression aller-retours)...")
    if stop_times_df.empty or trips_df.empty:
        return trips_df, stop_times_df


    stop_times_sorted = stop_times_df.sort_values(['trip_id', 'stop_sequence'])
    trip_signatures = stop_times_sorted.groupby('trip_id')['stop_id'].apply(lambda x: "|".join(x)).reset_index()
    trip_signatures.columns = ['trip_id', 'stop_sequence_signature']

    trips_merged = pd.merge(trips_df, trip_signatures, on='trip_id', how='left')


    def reverse_signature(sig):
        if not sig or not isinstance(sig, str): return ""
        parts = sig.split("|")
        return "|".join(parts[::-1])

    trips_merged['reverse_signature'] = trips_merged['stop_sequence_signature'].apply(reverse_signature)



    trips_merged = trips_merged.sort_values('trip_id')

    kept_signatures = set()
    indices_to_keep = []


    for index, row in trips_merged.iterrows():
        sig = row['stop_sequence_signature']
        rev_sig = row['reverse_signature']


        if sig not in kept_signatures and rev_sig not in kept_signatures:
            kept_signatures.add(sig)
            indices_to_keep.append(index)

    unique_trips = trips_merged.loc[indices_to_keep].copy()


    unique_trips = unique_trips.drop(columns=['stop_sequence_signature', 'reverse_signature'])

    logger.info(f"Réduction de {len(trips_df)} trajets à {len(unique_trips)} trajets uniques (1 sens unique).")

    valid_trip_ids = unique_trips['trip_id'].unique()
    simplified_stop_times = stop_times_df[stop_times_df['trip_id'].isin(valid_trip_ids)]

    return unique_trips, simplified_stop_times



def main():
    logger.info("=== DÉBUT DU PROCESSUS (Suppression Aller-Retours) ===")

    os.makedirs(UNIFIED_DIR, exist_ok=True)
    os.makedirs(MAPPING_DIR, exist_ok=True)

    all_data = {}


    start_window = datetime(2026, 2, 1)
    end_window = datetime(2026, 12, 31)


    for key, config in SOURCES.items():
        temp_dir = download_and_extract(config['url'], key)
        if temp_dir:
            trips = load_gtfs_file(temp_dir, 'trips.txt', config['prefix'])
            routes = load_gtfs_file(temp_dir, 'routes.txt', config['prefix'])
            stops = load_gtfs_file(temp_dir, 'stops.txt', config['prefix'])
            stop_times = load_gtfs_file(temp_dir, 'stop_times.txt', config['prefix'])
            shapes = load_gtfs_file(temp_dir, 'shapes.txt', config['prefix'])
            agency = load_gtfs_file(temp_dir, 'agency.txt', config['prefix'])

            calendar = load_gtfs_file(temp_dir, 'calendar.txt', config['prefix'])
            calendar_dates = load_gtfs_file(temp_dir, 'calendar_dates.txt', config['prefix'])

            valid_services = get_valid_services(calendar, calendar_dates, start_window, end_window)

            initial_count = len(trips)
            if not trips.empty and valid_services:
                trips = trips[trips['service_id'].isin(valid_services)]
                logger.info(f"{key}: {len(trips)} trajets valides sur {initial_count}.")
                valid_trip_ids = trips['trip_id'].unique()
                stop_times = stop_times[stop_times['trip_id'].isin(valid_trip_ids)]
            else:
                logger.warning(f"{key}: Conservation de tous les trajets (pas de filtre date applicable).")

            all_data[key] = {
                'stops': stops,
                'trips': trips,
                'routes': routes,
                'stop_times': stop_times,
                'shapes': shapes,
                'agency': agency
            }

    if "flixbus" not in all_data or "blablacar" not in all_data:
        logger.error("Données manquantes. Arrêt.")
        return
    unified_stops = pd.concat([all_data['flixbus']['stops'], all_data['blablacar']['stops']], ignore_index=True)
    unified_stop_times = pd.concat([all_data['flixbus']['stop_times'], all_data['blablacar']['stop_times']], ignore_index=True)

    city_stops, city_mapping = aggregate_by_city_select_flixbus(unified_stops)

    unified_trips = pd.concat([all_data['flixbus']['trips'], all_data['blablacar']['trips']], ignore_index=True)
    unified_routes = pd.concat([all_data['flixbus']['routes'], all_data['blablacar']['routes']], ignore_index=True)
    unified_shapes = pd.concat([all_data['flixbus']['shapes'], all_data['blablacar']['shapes']], ignore_index=True)


    logger.info("Nettoyage des noms de trajets...")
    bla_trips = unified_trips[unified_trips['trip_id'].str.startswith('BLA_')]
    bla_merge = pd.merge(bla_trips, unified_routes[['route_id', 'route_long_name']], on='route_id', how='left')
    bla_merge['trip_headsign'] = bla_merge['route_long_name'].apply(clean_display_name)
    bla_merge = bla_merge.drop(columns=['route_long_name'])

    flix_trips = unified_trips[unified_trips['trip_id'].str.startswith('FLX_')]
    flix_merge = pd.merge(flix_trips, unified_routes[['route_id', 'route_long_name']], on='route_id', how='left')
    flix_merge['trip_headsign'] = flix_merge.apply(lambda r: r['trip_headsign'] if len(str(r['trip_headsign']))>3 else clean_display_name(r['route_long_name']), axis=1)
    flix_merge = flix_merge.drop(columns=['route_long_name'])

    unified_trips = pd.concat([flix_merge, bla_merge], ignore_index=True)


    final_stop_times = clean_stop_sequences(unified_stop_times, city_mapping)


    final_trips, final_stop_times = simplify_trips(unified_trips, final_stop_times)


    valid_routes = final_trips['route_id'].unique()
    final_routes = unified_routes[unified_routes['route_id'].isin(valid_routes)]

    final_shapes = pd.DataFrame()
    if 'shape_id' in final_trips.columns and not final_trips['shape_id'].dropna().empty:
        valid_shapes = final_trips['shape_id'].dropna().unique()
        final_shapes = unified_shapes[unified_shapes['shape_id'].isin(valid_shapes)]

    final_agency = pd.concat([all_data['flixbus']['agency'].head(1), all_data['blablacar']['agency'].head(1)], ignore_index=True)


    logger.info(f"Écriture finale...")

    files_to_save = {
        'agency': final_agency,
        'stops': city_stops,
        'routes': final_routes,
        'trips': final_trips,
        'stop_times': final_stop_times,
        'shapes': final_shapes
    }

    import sqlite3
    db_path = os.path.join(UNIFIED_DIR, "gtfs.sqlite")

    try:
        logger.info(f"Création de la base SQLite {db_path}...")
        with sqlite3.connect(db_path) as conn:
            for table_name, df in files_to_save.items():
                if not df.empty:
                    logger.info(f"Sauvegarde de {table_name} dans SQLite...")
                    df.to_sql(table_name, conn, if_exists='replace', index=False)

                    if table_name == 'stops':
                        conn.execute('CREATE INDEX IF NOT EXISTS idx_stops_id ON stops (stop_id)')
                        conn.execute('CREATE INDEX IF NOT EXISTS idx_stops_name ON stops (stop_name)')
                    elif table_name == 'stop_times':
                        conn.execute('CREATE INDEX IF NOT EXISTS idx_st_stop_id ON stop_times (stop_id)')
                        conn.execute('CREATE INDEX IF NOT EXISTS idx_st_trip_id ON stop_times (trip_id)')
                    elif table_name == 'trips':
                        conn.execute('CREATE INDEX IF NOT EXISTS idx_trips_id ON trips (trip_id)')
                        conn.execute('CREATE INDEX IF NOT EXISTS idx_trips_route ON trips (route_id)')
                    elif table_name == 'routes':
                        conn.execute('CREATE INDEX IF NOT EXISTS idx_routes_id ON routes (route_id)')
                    elif table_name == 'shapes':
                        conn.execute('CREATE INDEX IF NOT EXISTS idx_shapes_id ON shapes (shape_id)')

        logger.info("Base de données SQLite GTFS créée avec succès avec index.")
    except Exception as e:
        logger.error(f"Erreur lors de la sauvegarde SQLite: {e}")

    for table_name, df in files_to_save.items():
        path = os.path.join(UNIFIED_DIR, f"{table_name}.txt")
        df.to_csv(path, index=False)

    logger.info("=== TERMINÉ ===")

    logger.info("Création de l'archive ZIP pour le téléchargement...")
    try:

        static_downloads_dir = os.path.join("static", "downloads")
        os.makedirs(static_downloads_dir, exist_ok=True)
        zip_path = os.path.join(static_downloads_dir, "gtfs_unifie")


        if os.path.exists(zip_path + ".zip"):
            os.remove(zip_path + ".zip")


        shutil.make_archive(zip_path, 'zip', UNIFIED_DIR)
        logger.info(f"Archive créée : {zip_path}.zip")

    except Exception as e:
        logger.error(f"Erreur lors de la création du ZIP : {e}")

if __name__ == "__main__":
    main()

--- FIN FICHIER ---

--- DÉBUT FICHIER : config_data.py ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\config_data.py ---

TOP_HUBS = {
    "paris": {
        "id": "FLX_dcc0b0b8-9603-11e6-9066-549f350fcb0c",
        "name": "Paris",
        "slugs": {
            "fr": "paris",
            "en": "paris",
            "de": "paris",
            "it": "parigi",
            "es": "paris",
            "default": "paris"
        }
    },
    "marseille": {
        "id": "FLX_dcc2e206-9603-11e6-9066-549f350fcb0c",
        "name": "Marseille",
        "slugs": {
            "fr": "marseille",
            "en": "marseille",
            "de": "marseille",
            "it": "marsiglia",
            "es": "marsella",
            "default": "marseille"
        }
    },
    "lyon": {
        "id": "FLX_a546c464-28ec-42a2-a6dc-1fa708f0fe89",
        "name": "Lyon",
        "slugs": {
            "fr": "lyon",
            "en": "lyon",
            "de": "lyon",
            "it": "lione",
            "es": "lyon",
            "default": "lyon"
        }
    },
    "toulouse": {
        "id": "FLX_dcc0e74b-9603-11e6-9066-549f350fcb0c",
        "name": "Toulouse",
        "slugs": {
            "fr": "toulouse",
            "en": "toulouse",
            "default": "toulouse"
        }
    },
    "nice": {
        "id": "FLX_c3996d55-4fc0-40ae-8fe2-62b3d07fd0d7",
        "name": "Nice",
        "slugs": {
            "fr": "nice",
            "en": "nice",
            "de": "nizza",
            "it": "nizza",
            "default": "nice"
        }
    },
    "nantes": {
        "id": "FLX_6c33811e-9f58-457f-a112-44620ebba523",
        "name": "Nantes",
        "slugs": {"default": "nantes"}
    },
    "montpellier": {
        "id": "FLX_dcc0b9bc-9603-11e6-9066-549f350fcb0c",
        "name": "Montpellier",
        "slugs": {"default": "montpellier"}
    },
    "strasbourg": {
        "id": "FLX_dcbac843-9603-11e6-9066-549f350fcb0c",
        "name": "Strasbourg",
        "slugs": {
            "fr": "strasbourg",
            "en": "strasbourg",
            "de": "strassburg",
            "it": "strasburgo",
            "es": "estrasburgo",
            "default": "strasbourg"
        }
    },
    "bordeaux": {
        "id": "FLX_dcc06cc2-9603-11e6-9066-549f350fcb0c",
        "name": "Bordeaux",
        "slugs": {
            "fr": "bordeaux",
            "it": "bordeaux",
            "es": "burdeos",
            "default": "bordeaux"
        }
    },
    "lille": {
        "id": "FLX_dcbf8aeb-9603-11e6-9066-549f350fcb0c",
        "name": "Lille",
        "slugs": {
            "fr": "lille",
            "nl": "rijsel",
            "default": "lille"
        }
    },
    "rennes": {
        "id": "FLX_dcc0cced-9603-11e6-9066-549f350fcb0c",
        "name": "Rennes",
        "slugs": {"default": "rennes"}
    },
    "reims": {
        "id": "FLX_dcbfeac0-9603-11e6-9066-549f350fcb0c",
        "name": "Reims",
        "slugs": {"default": "reims"}
    },
    "toulon": {
        "id": "FLX_dcc21600-9603-11e6-9066-549f350fcb0c",
        "name": "Toulon",
        "slugs": {"default": "toulon"}
    },
    "saint_etienne": {
        "id": "FLX_dcc19252-9603-11e6-9066-549f350fcb0c",
        "name": "Saint-Étienne",
        "slugs": {"default": "saint-etienne"}
    },
    "le_havre": {
        "id": "FLX_dcc14569-9603-11e6-9066-549f350fcb0c",
        "name": "Le Havre",
        "slugs": {"default": "le-havre"}
    },
    "grenoble": {
        "id": "FLX_dcc5ad12-9603-11e6-9066-549f350fcb0c",
        "name": "Grenoble",
        "slugs": {"default": "grenoble"}
    },
    "angers": {
        "id": "FLX_dcc1007f-9603-11e6-9066-549f350fcb0c",
        "name": "Angers",
        "slugs": {"default": "angers"}
    },
    "nimes": {
        "id": "FLX_dcc0c16d-9603-11e6-9066-549f350fcb0c",
        "name": "Nîmes",
        "slugs": {"default": "nimes"}
    },
    "villeurbanne": {
        "id": "FLX_a546c464-28ec-42a2-a6dc-1fa708f0fe89",
        "name": "Villeurbanne",
        "slugs": {"default": "lyon-villeurbanne"}
    },
    "berlin": {
        "id": "FLX_dcbc32c3-9603-11e6-9066-549f350fcb0c",
        "name": "Berlin",
        "slugs": {
            "fr": "berlin",
            "en": "berlin",
            "de": "berlin",
            "it": "berlino",
            "pl": "berlin",
            "default": "berlin"
        }
    },
    "hamburg": {
        "id": "FLX_dcbada9a-9603-11e6-9066-549f350fcb0c",
        "name": "Hambourg",
        "slugs": {
            "fr": "hambourg",
            "en": "hamburg",
            "de": "hamburg",
            "it": "amburgo",
            "es": "hamburgo",
            "default": "hamburg"
        }
    },
    "munich": {
        "id": "FLX_dcbbb2f5-9603-11e6-9066-549f350fcb0c",
        "name": "Munich",
        "slugs": {
            "fr": "munich",
            "de": "muenchen",
            "en": "munich",
            "it": "monaco-di-baviera",
            "es": "munich",
            "default": "munich"
        }
    },
    "cologne": {
        "id": "FLX_dcc54142-9603-11e6-9066-549f350fcb0c",
        "name": "Cologne",
        "slugs": {
            "fr": "cologne",
            "de": "koeln",
            "en": "cologne",
            "nl": "keulen",
            "it": "colonia",
            "default": "cologne"
        }
    },
    "frankfurt": {
        "id": "FLX_dcbadca1-9603-11e6-9066-549f350fcb0c",
        "name": "Francfort",
        "slugs": {
            "fr": "francfort",
            "de": "frankfurt-am-main",
            "en": "frankfurt",
            "it": "francoforte-sul-meno",
            "default": "frankfurt"
        }
    },
    "stuttgart": {
        "id": "FLX_dcbc0c97-9603-11e6-9066-549f350fcb0c",
        "name": "Stuttgart",
        "slugs": {
            "de": "stuttgart",
            "it": "stoccarda",
            "default": "stuttgart"
        }
    },
    "dusseldorf": {
        "id": "FLX_dcbaca96-9603-11e6-9066-549f350fcb0c",
        "name": "Düsseldorf",
        "slugs": {
            "de": "duesseldorf",
            "default": "duesseldorf"
        }
    },
    "dortmund": {
        "id": "FLX_dcbaeef4-9603-11e6-9066-549f350fcb0c",
        "name": "Dortmund",
        "slugs": {"default": "dortmund"}
    },
    "essen": {
        "id": "FLX_dcbaf468-9603-11e6-9066-549f350fcb0c",
        "name": "Essen",
        "slugs": {"default": "essen"}
    },
    "leipzig": {
        "id": "FLX_dcbc3656-9603-11e6-9066-549f350fcb0c",
        "name": "Leipzig",
        "slugs": {
            "pl": "lipsk",
            "default": "leipzig"
        }
    },
    "bremen": {
        "id": "FLX_dcbb3fe6-9603-11e6-9066-549f350fcb0c",
        "name": "Brême",
        "slugs": {
            "fr": "breme",
            "de": "bremen",
            "en": "bremen",
            "default": "bremen"
        }
    },
    "dresden": {
        "id": "FLX_dcbb7a42-9603-11e6-9066-549f350fcb0c",
        "name": "Dresde",
        "slugs": {
            "fr": "dresde",
            "de": "dresden",
            "en": "dresden",
            "pl": "drezno",
            "default": "dresden"
        }
    },
    "hannover": {
        "id": "FLX_dcbb2109-9603-11e6-9066-549f350fcb0c",
        "name": "Hanovre",
        "slugs": {
            "fr": "hanovre",
            "de": "hannover",
            "en": "hanover",
            "default": "hannover"
        }
    },
    "nuremberg": {
        "id": "FLX_dcbac661-9603-11e6-9066-549f350fcb0c",
        "name": "Nuremberg",
        "slugs": {
            "fr": "nuremberg",
            "de": "nuernberg",
            "it": "norimberga",
            "default": "nuernberg"
        }
    },
    "duisburg": {
        "id": "FLX_dcbbe873-9603-11e6-9066-549f350fcb0c",
        "name": "Duisbourg",
        "slugs": {
            "fr": "duisbourg",
            "de": "duisburg",
            "default": "duisburg"
        }
    },
    "bochum": {
        "id": "FLX_dcbaefef-9603-11e6-9066-549f350fcb0c",
        "name": "Bochum",
        "slugs": {"default": "bochum"}
    },
    "wuppertal": {
        "id": "FLX_dcbb4379-9603-11e6-9066-549f350fcb0c",
        "name": "Wuppertal",
        "slugs": {"default": "wuppertal"}
    },
    "bielefeld": {
        "id": "FLX_dcbc5a46-9603-11e6-9066-549f350fcb0c",
        "name": "Bielefeld",
        "slugs": {"default": "bielefeld"}
    },
    "bonn": {
        "id": "FLX_dcbb9d17-9603-11e6-9066-549f350fcb0c",
        "name": "Bonn",
        "slugs": {"default": "bonn"}
    },
    "munster": {
        "id": "FLX_dcbb7817-9603-11e6-9066-549f350fcb0c",
        "name": "Münster",
        "slugs": {
            "de": "muenster",
            "default": "muenster"
        }
    },

    "rome": {
        "id": "FLX_dcbd9538-9603-11e6-9066-549f350fcb0c",
        "name": "Rome",
        "slugs": {
            "fr": "rome",
            "it": "roma",
            "en": "rome",
            "de": "rom",
            "es": "roma",
            "default": "roma"
        }
    },
    "milan": {
        "id": "FLX_dcbc484a-9603-11e6-9066-549f350fcb0c",
        "name": "Milan",
        "slugs": {
            "fr": "milan",
            "it": "milano",
            "en": "milan",
            "de": "mailand",
            "default": "milano"
        }
    },
    "naples": {
        "id": "FLX_c284728f-da61-43f5-aff7-6f942f088419",
        "name": "Naples",
        "slugs": {
            "fr": "naples",
            "it": "napoli",
            "en": "naples",
            "de": "neapel",
            "es": "napoles",
            "default": "napoli"
        }
    },
    "turin": {
        "id": "FLX_dcbfe731-9603-11e6-9066-549f350fcb0c",
        "name": "Turin",
        "slugs": {
            "fr": "turin",
            "it": "torino",
            "en": "turin",
            "de": "turin",
            "default": "torino"
        }
    },
    "palermo": {
        "id": "FLX_4be19091-966b-41e8-9c0d-ee8945cfa8d6",
        "name": "Palerme",
        "slugs": {
            "fr": "palerme",
            "it": "palermo",
            "default": "palermo"
        }
    },
    "genoa": {
        "id": "FLX_dcc02ea8-9603-11e6-9066-549f350fcb0c",
        "name": "Gênes",
        "slugs": {
            "fr": "genes",
            "it": "genova",
            "en": "genoa",
            "de": "genua",
            "default": "genova"
        }
    },
    "bologna": {
        "id": "FLX_dcc03216-9603-11e6-9066-549f350fcb0c",
        "name": "Bologne",
        "slugs": {
            "fr": "bologne",
            "it": "bologna",
            "default": "bologna"
        }
    },
    "florence": {
        "id": "FLX_dcbcdfc1-9603-11e6-9066-549f350fcb0c",
        "name": "Florence",
        "slugs": {
            "fr": "florence",
            "it": "firenze",
            "en": "florence",
            "de": "florenz",
            "default": "firenze"
        }
    },
    "bari": {
        "id": "FLX_dcc51e2-9603-11e6-9066-549f350fcb0c",
        "name": "Bari",
        "slugs": {"default": "bari"}
    },
    "catania": {
        "id": "FLX_b96dd294-8dcf-42f3-bdfc-b8351ff9324f",
        "name": "Catane",
        "slugs": {
            "fr": "catane",
            "it": "catania",
            "default": "catania"
        }
    },
    "venice": {
        "id": "FLX_dcbdacd2-9603-11e6-9066-549f350fcb0c",
        "name": "Venise",
        "slugs": {
            "fr": "venise",
            "it": "venezia",
            "en": "venice",
            "de": "venedig",
            "default": "venezia"
        }
    },
    "verona": {
        "id": "FLX_dcbdb0fa-9603-11e6-9066-549f350fcb0c",
        "name": "Vérone",
        "slugs": {
            "fr": "verone",
            "it": "verona",
            "default": "verona"
        }
    },
    "messina": {
        "id": "FLX_682f1f0b-ebbd-424b-8e95-58f88bb23901",
        "name": "Messine",
        "slugs": {
            "fr": "messine",
            "it": "messina",
            "default": "messina"
        }
    },
    "padua": {
        "id": "FLX_dcbd8a4d-9603-11e6-9066-549f350fcb0c",
        "name": "Padoue",
        "slugs": {
            "fr": "padoue",
            "it": "padova",
            "en": "padua",
            "default": "padova"
        }
    },
    "trieste": {
        "id": "FLX_dcbda963-9603-11e6-9066-549f350fcb0c",
        "name": "Trieste",
        "slugs": {"default": "trieste"}
    },
    "brescia": {
        "id": "FLX_dcc0221c-9603-11e6-9066-549f350fcb0c",
        "name": "Brescia",
        "slugs": {"default": "brescia"}
    },
    "taranto": {
        "id": "FLX_9070422c-d126-4b9d-998c-4c35796ef809",
        "name": "Tarente",
        "slugs": {
            "fr": "tarente",
            "it": "taranto",
            "default": "taranto"
        }
    },
    "prato": {
        "id": "FLX_dcc2de9d-9603-11e6-9066-549f350fcb0c",
        "name": "Prato",
        "slugs": {"default": "prato"}
    },
    "parma": {
        "id": "FLX_dcc277af-9603-11e6-9066-549f350fcb0c",
        "name": "Parme",
        "slugs": {
            "fr": "parme",
            "it": "parma",
            "default": "parma"
        }
    },
    "modena": {
        "id": "FLX_dcc1a55b-9603-11e6-9066-549f350fcb0c",
        "name": "Modène",
        "slugs": {
            "fr": "modene",
            "it": "modena",
            "default": "modena"
        }
    },

    "madrid": {
        "id": "FLX_1b8eaa11-e4a2-4a88-a059-403181c2eb8c",
        "name": "Madrid",
        "slugs": {
            "fr": "madrid",
            "es": "madrid",
            "en": "madrid",
            "default": "madrid"
        }
    },
    "barcelona": {
        "id": "FLX_eb5dfc25-d6c6-4feb-b562-ce82c9972cd6",
        "name": "Barcelone",
        "slugs": {
            "fr": "barcelone",
            "es": "barcelona",
            "en": "barcelona",
            "it": "barcellona",
            "de": "barcelona",
            "default": "barcelona"
        }
    },
    "valencia": {
        "id": "FLX_65bc658e-3c84-4f8a-8879-fc56c2e567c5",
        "name": "Valence",
        "slugs": {
            "fr": "valence",
            "es": "valencia",
            "en": "valencia",
            "default": "valencia"
        }
    },
    "seville": {
        "id": "FLX_4763b0c9-cd32-4764-acfb-b68f6a2bee21",
        "name": "Séville",
        "slugs": {
            "fr": "seville",
            "es": "sevilla",
            "en": "seville",
            "default": "sevilla"
        }
    },
    "zaragoza": {
        "id": "FLX_07597a10-0f4c-49d5-84c8-abf615bd5956",
        "name": "Saragosse",
        "slugs": {
            "fr": "saragosse",
            "es": "zaragoza",
            "en": "zaragoza",
            "default": "zaragoza"
        }
    },
    "malaga": {
        "id": "FLX_5e27bb0b-8dfe-4399-be62-b23800957ce7",
        "name": "Malaga",
        "slugs": {"default": "malaga"}
    },
    "murcia": {
        "id": "FLX_e3227df6-e27b-436c-8207-b77746251a53",
        "name": "Murcie",
        "slugs": {
            "fr": "murcie",
            "es": "murcia",
            "default": "murcia"
        }
    },
    "palma": {
        "id": "FLX_eb5dfc25-d6c6-4feb-b562-ce82c9972cd6",
        "name": "Palma",
        "slugs": {"default": "palma-de-mallorca"}
    },
    "bilbao": {
        "id": "FLX_3314645f-7903-4bc9-b9ef-74ff161feca2",
        "name": "Bilbao",
        "slugs": {"default": "bilbao"}
    },
    "alicante": {
        "id": "FLX_687eb82b-bc6a-45c5-93cc-3c186b7ecc06",
        "name": "Alicante",
        "slugs": {
            "es": "alicante",
            "default": "alicante"
        }
    },
    "cordoba": {
        "id": "FLX_1979f5ae-9e90-4ca5-bc29-58e6d0020e73",
        "name": "Cordoue",
        "slugs": {
            "fr": "cordoue",
            "es": "cordoba",
            "en": "cordoba",
            "default": "cordoba"
        }
    },
    "valladolid": {
        "id": "FLX_0667ba34-c22c-40a2-a1b0-3b248c37dccf",
        "name": "Valladolid",
        "slugs": {"default": "valladolid"}
    },
    "vigo": {
        "id": "FLX_458311c9-b193-4c10-b409-b7c832ecb1b4",
        "name": "Vigo",
        "slugs": {"default": "vigo"}
    },
    "gijon": {
        "id": "FLX_eb5dfc25-d6c6-4feb-b562-ce82c9972cd6",
        "name": "Gijon",
        "slugs": {"default": "gijon"}
    },
    "hospitalet": {
        "id": "FLX_eb5dfc25-d6c6-4feb-b562-ce82c9972cd6",
        "name": "L'Hospitalet",
        "slugs": {"default": "barcelona"}
    },
    "vitoria": {
        "id": "FLX_ec29a70c-933d-4056-a35b-0adc69b554aa",
        "name": "Vitoria",
        "slugs": {
            "es": "vitoria-gasteiz",
            "default": "vitoria-gasteiz"
        }
    },
    "a_coruna": {
        "id": "FLX_779481dc-ec1a-4651-9771-f0e97a5cacc9",
        "name": "La Corogne",
        "slugs": {
            "fr": "la-corogne",
            "es": "a-coruna",
            "en": "a-coruna",
            "default": "a-coruna"
        }
    },
    "elche": {
        "id": "FLX_65bc658e-3c84-4f8a-8879-fc56c2e567c5",
        "name": "Elche",
        "slugs": {
            "es": "elche",
            "default": "elche"
        }
    },
    "granada": {
        "id": "FLX_cdf5aee6-9a78-468c-84c7-8d395c6ac70f",
        "name": "Grenade",
        "slugs": {
            "fr": "grenade",
            "es": "granada",
            "en": "granada",
            "default": "granada"
        }
    },
    "badalona": {
        "id": "FLX_eb5dfc25-d6c6-4feb-b562-ce82c9972cd6",
        "name": "Badalone",
        "slugs": {"default": "barcelona"}
    },

    "warsaw": {
        "id": "FLX_bff2a20d-e42b-4166-a06e-b9083c56b6b3",
        "name": "Varsovie",
        "slugs": {
            "fr": "varsovie",
            "pl": "warszawa",
            "en": "warsaw",
            "de": "warschau",
            "default": "warszawa"
        }
    },
    "krakow": {
        "id": "FLX_dcbd0e26-9603-11e6-9066-549f350fcb0c",
        "name": "Cracovie",
        "slugs": {
            "fr": "cracovie",
            "pl": "krakow",
            "en": "krakow",
            "de": "krakau",
            "default": "krakow"
        }
    },
    "lodz": {
        "id": "FLX_e1b6a242-54f8-4108-8e51-21c195ac77d4",
        "name": "Łódź",
        "slugs": {
            "pl": "lodz",
            "default": "lodz"
        }
    },
    "wroclaw": {
        "id": "FLX_dcbcc787-9603-11e6-9066-549f350fcb0c",
        "name": "Wrocław",
        "slugs": {
            "de": "breslau",
            "pl": "wroclaw",
            "default": "wroclaw"
        }
    },
    "poznan": {
        "id": "FLX_dcc3dad0-9603-11e6-9066-549f350fcb0c",
        "name": "Poznań",
        "slugs": {
            "pl": "poznan",
            "de": "posen",
            "default": "poznan"
        }
    },
    "gdansk": {
        "id": "FLX_dcbcd754-9603-11e6-9066-549f350fcb0c",
        "name": "Gdańsk",
        "slugs": {
            "pl": "gdansk",
            "de": "danzig",
            "default": "gdansk"
        }
    },
    "szczecin": {
        "id": "FLX_9b6801c7-3ecb-11ea-8017-02437075395e",
        "name": "Szczecin",
        "slugs": {
            "de": "stettin",
            "default": "szczecin"
        }
    },
    "bydgoszcz": {
        "id": "FLX_dcbccbe5-9603-11e6-9066-549f350fcb0c",
        "name": "Bydgoszcz",
        "slugs": {"default": "bydgoszcz"}
    },
    "lublin": {
        "id": "FLX_deff7f45-3d10-4bb0-a5bd-7ddc327d9f41",
        "name": "Lublin",
        "slugs": {"default": "lublin"}
    },
    "bialystok": {
        "id": "FLX_e383decd-d064-423a-ab3b-600e6023edde",
        "name": "Białystok",
        "slugs": {"default": "bialystok"}
    },
    "katowice": {
        "id": "FLX_dcbd04b6-9603-11e6-9066-549f350fcb0c",
        "name": "Katowice",
        "slugs": {"default": "katowice"}
    },
    "gdynia": {
        "id": "FLX_e9642e51-d7b3-4a35-be40-78dc9749a922",
        "name": "Gdynia",
        "slugs": {"default": "gdynia"}
    },
    "czestochowa": {
        "id": "FLX_dcc595c6-9603-11e6-9066-549f350fcb0c",
        "name": "Częstochowa",
        "slugs": {"default": "czestochowa"}
    },
    "radom": {
        "id": "FLX_6caf963e-0be6-4925-abab-6a5931666154",
        "name": "Radom",
        "slugs": {"default": "radom"}
    },
    "sosnowiec": {
        "id": "FLX_427efa4a-627a-40f2-bbcd-0dbaa06e14c9",
        "name": "Sosnowiec",
        "slugs": {"default": "sosnowiec"}
    },
    "torun": {
        "id": "FLX_5404247b-9239-4c05-b4e8-479383d7c584",
        "name": "Toruń",
        "slugs": {
            "de": "thorn",
            "default": "torun"
        }
    },
    "kielce": {
        "id": "FLX_9563e4ca-0972-4805-a7b0-62d52b86793c",
        "name": "Kielce",
        "slugs": {"default": "kielce"}
    },
    "rzeszow": {
        "id": "FLX_dcc3ea96-9603-11e6-9066-549f350fcb0c",
        "name": "Rzeszów",
        "slugs": {"default": "rzeszow"}
    },
    "gliwice": {
        "id": "FLX_55bd2ce7-265f-433e-a9ed-ec1789f5f3ed",
        "name": "Gliwice",
        "slugs": {"default": "gliwice"}
    },
    "zabrze": {
        "id": "FLX_161bc8e8-a659-4aad-b0fd-adce57501554",
        "name": "Zabrze",
        "slugs": {"default": "zabrze"}
    },

    "london": {
        "id": "FLX_cab329fd-7882-4cc0-a292-d796d45b7036",
        "name": "Londres",
        "slugs": {
            "fr": "londres",
            "en": "london",
            "de": "london",
            "it": "londra",
            "es": "londres",
            "default": "london"
        }
    },
    "vienna": {
        "id": "FLX_dcbca3fc-9603-11e6-9066-549f350fcb0c",
        "name": "Vienne",
        "slugs": {
            "fr": "vienne",
            "de": "wien",
            "en": "vienna",
            "it": "vienna",
            "default": "wien"
        }
    },
    "prague": {
        "id": "FLX_dcbc6452-9603-11e6-9066-549f350fcb0c",
        "name": "Prague",
        "slugs": {
            "fr": "prague",
            "cs": "praha",
            "de": "prag",
            "en": "prague",
            "default": "praha"
        }
    },
    "amsterdam": {
        "id": "FLX_dcbc54e2-9603-11e6-9066-549f350fcb0c",
        "name": "Amsterdam",
        "slugs": {"default": "amsterdam"}
    },
    "brussels": {
        "id": "FLX_dcbfd126-9603-11e6-9066-549f350fcb0c",
        "name": "Bruxelles",
        "slugs": {
            "fr": "bruxelles",
            "nl": "brussel",
            "en": "brussels",
            "de": "bruessel",
            "default": "brussels"
        }
    },
    "lisbon": {
        "id": "FLX_301c577a-9c96-4bdf-95a1-a380cabdd28b",
        "name": "Lisbonne",
        "slugs": {
            "fr": "lisbonne",
            "pt": "lisboa",
            "en": "lisbon",
            "default": "lisboa"
        }
    },
    "budapest": {
        "id": "FLX_dcbcd0d8-9603-11e6-9066-549f350fcb0c",
        "name": "Budapest",
        "slugs": {"default": "budapest"}
    },
    "copenhagen": {
        "id": "FLX_dcbd0b4b-9603-11e6-9066-549f350fcb0c",
        "name": "Copenhague",
        "slugs": {
            "fr": "copenhague",
            "da": "koebenhavn",
            "en": "copenhagen",
            "de": "kopenhagen",
            "default": "koebenhavn"
        }
    },
    "stockholm": {
        "id": "FLX_dcc03476-9603-11e6-9066-549f350fcb0c",
        "name": "Stockholm",
        "slugs": {"default": "stockholm"}
    },
    "oslo": {
        "id": "FLX_dcc38945-9603-11e6-9066-549f350fcb0c",
        "name": "Oslo",
        "slugs": {"default": "oslo"}
    },
    "helsinki": {
        "id": "FLX_f11061e0-b4b4-4a2c-8337-519d3eeca976",
        "name": "Helsinki",
        "slugs": {"default": "helsinki"}
    },
    "zurich": {
        "id": "FLX_dcbab299-9603-11e6-9066-549f350fcb0c",
        "name": "Zurich",
        "slugs": {
            "de": "zuerich",
            "it": "zurigo",
            "default": "zuerich"
        }
    },
    "geneva": {
        "id": "FLX_dcc0627e-9603-11e6-9066-549f350fcb0c",
        "name": "Genève",
        "slugs": {
            "fr": "geneve",
            "en": "geneva",
            "de": "genf",
            "it": "ginevra",
            "default": "geneve"
        }
    },
    "istanbul": {
        "id": "FLX_9b6a8316-3ecb-11ea-8017-02437075395e",
        "name": "Istanbul",
        "slugs": {"default": "istanbul"}
    },
    "athens": {
        "id": "FLX_cab329fd-7882-4cc0-a292-d796d45b7036",
        "name": "Athènes",
        "slugs": {
            "fr": "athenes",
            "en": "athens",
            "el": "athina",
            "default": "athens"
        }
    },
    "bucharest": {
        "id": "FLX_54c7a569-1af8-4252-aa35-eba0ff50b89b",
        "name": "Bucarest",
        "slugs": {
            "fr": "bucarest",
            "ro": "bucuresti",
            "en": "bucharest",
            "default": "bucuresti"
        }
    },
    "kyiv": {
        "id": "FLX_394088d2-0c06-4dea-9fc1-5b70c8d50f9c",
        "name": "Kyiv",
        "slugs": {
            "en": "kyiv",
            "uk": "kyiv",
            "default": "kyiv"
        }
    },
    "belgrade": {
        "id": "FLX_c17eed68-17b3-421f-a8f4-3f3786cb4fca",
        "name": "Belgrade",
        "slugs": {
            "sr": "beograd",
            "default": "beograd"
        }
    },
    "zagreb": {
        "id": "FLX_dcbdbe76-9603-11e6-9066-549f350fcb0c",
        "name": "Zagreb",
        "slugs": {"default": "zagreb"}
    },
    "bratislava": {
        "id": "FLX_dcbcc605-9603-11e6-9066-549f350fcb0c",
        "name": "Bratislava",
        "slugs": {"default": "bratislava"}
    },
    "ljubljana": {
        "id": "FLX_dcbd21fc-9603-11e6-9066-549f350fcb0c",
        "name": "Ljubljana",
        "slugs": {"default": "ljubljana"}
    },
    "luxembourg": {
        "id": "FLX_dcc5d357-9603-11e6-9066-549f350fcb0c",
        "name": "Luxembourg",
        "slugs": {
            "fr": "luxembourg",
            "de": "luxemburg",
            "default": "luxembourg"
        }
    },
    "tirana": {
        "id": "FLX_c17eed68-17b3-421f-a8f4-3f3786cb4fca",
        "name": "Tirana",
        "slugs": {"default": "tirana"}
    }
}


BASE_URL = "https://liniabus.eu"
SUPPORTED_LANGS = [
    "fr", "en", "de", "es", "pt", "nl", "sq", "ca", "hr", "bg", "da", "et", "fi",
    "el", "hu", "hi", "lv", "lt", "lb", "mk", "ro", "pl", "cs", "sk", "sl", "sv",
    "tr", "uk", "ru", "be",
]
DEFAULT_LANG = "fr"

OG_LOCALES = {
    "fr": "fr_FR", "en": "en_GB", "de": "de_DE", "es": "es_ES", "it": "it_IT",
    "nl": "nl_NL", "pt": "pt_PT", "pl": "pl_PL", "sq": "sq_AL", "ca": "ca_ES",
    "hr": "hr_HR", "bg": "bg_BG", "da": "da_DK", "et": "et_EE", "fi": "fi_FI",
    "el": "el_GR", "hu": "hu_HU", "hi": "hi_IN", "lv": "lv_LV", "lt": "lt_LT",
    "lb": "lb_LU", "mk": "mk_MK", "ro": "ro_RO", "cs": "cs_CZ", "sk": "sk_SK",
    "sl": "sl_SI", "sv": "sv_SE", "tr": "tr_TR", "uk": "uk_UA", "ru": "ru_RU",
    "be": "be_BY",
}

URL_SLUGS = {
    "map": {
        "fr": "carte", "en": "map", "de": "karte", "es": "mapa", "pt": "mapa",
        "nl": "kaart", "sq": "harta", "ca": "mapa", "hr": "karta", "bg": "karta",
        "da": "kort", "et": "kaart", "fi": "kartta", "el": "chartis", "hu": "terkep",
        "hi": "naksha", "lv": "karte", "lt": "zemelapis", "lb": "kaart", "mk": "karta",
        "ro": "harta", "pl": "mapa", "cs": "mapa", "sk": "mapa", "sl": "zemljevid",
        "sv": "karta", "tr": "harita", "uk": "karta", "ru": "karta", "be": "karta"
    },
    "planner": {
        "fr": "planificateur", "en": "planner", "de": "reiseplaner", "es": "planificador",
        "pt": "planeador", "nl": "planner", "sq": "planifikues", "ca": "planificador",
        "hr": "planer", "bg": "planirovchik", "da": "planlaegger", "et": "planeerija",
        "fi": "reittiopas", "el": "schediastis", "hu": "tervezo", "hi": "planner",
        "lv": "planotajs", "lt": "planuoklis", "lb": "planner", "mk": "planer",
        "ro": "planificator", "pl": "planer", "cs": "planovac", "sk": "planovac",
        "sl": "nacrtovalec", "sv": "planerare", "tr": "planlayici", "uk": "planuvalnyk",
        "ru": "planirovshchik", "be": "planirouschyk"
    },
    "about": {
        "fr": "a-propos", "en": "about", "de": "ueber", "es": "acerca-de",
        "pt": "sobre", "nl": "over", "sq": "rreth", "ca": "sobre",
        "hr": "o-nama", "bg": "za-nas", "da": "om", "et": "meist",
        "fi": "tietoa", "el": "schetika", "hu": "rolunk", "hi": "bare-mein",
        "lv": "par", "lt": "apie", "lb": "iwwer", "mk": "za-nas",
        "ro": "despre", "pl": "o-nas", "cs": "o-nas", "sk": "o-nas",
        "sl": "o-nas", "sv": "om", "tr": "hakkinda", "uk": "pro-nas",
        "ru": "o-nas", "be": "pra-nas"
    },
    "legal": {
        "fr": "mentions-legales", "en": "legal", "de": "impressum", "es": "aviso-legal",
        "pt": "aviso-legal", "nl": "juridisch", "sq": "kushtet-ligjore", "ca": "avis-legal",
        "hr": "pravne-informacije", "bg": "pravni-usloviya", "da": "juridisk", "et": "oiguslik",
        "fi": "oikeudelliset-tiedot", "el": "nomika", "hu": "jogi-nyilatkozat", "hi": "kanooni",
        "lv": "juridiska-informacija", "lt": "teisine-informacija", "lb": "impressum", "mk": "pravni-informacii",
        "ro": "informatii-legale", "pl": "informacje-prawne", "cs": "pravni-informace", "sk": "pravne-informacie",
        "sl": "pravno-obvestilo", "sv": "juridisk-information", "tr": "yasal", "uk": "yurydychna-informatsiya",
        "ru": "pravovaya-informatsiya", "be": "yurydychnaya-infarmatsyya"
    }
}

SEARCH_SYNONYMS = {
    "köln": "Cologne",
    "koln": "Cologne",
    "keulen": "Cologne",
    "colonia": "Cologne",
    "münchen": "Munich",
    "munchen": "Munich",
    "muenchen": "Munich",
    "monaco di baviera": "Munich",
    "nürnberg": "Nuremberg",
    "nurnberg": "Nuremberg",
    "nuernberg": "Nuremberg",
    "norimberga": "Nuremberg",
    "frankfurt am main": "Frankfurt",
    "frankfurt": "Frankfurt",
    "francfort": "Frankfurt",
    "francoforte": "Frankfurt",
    "hambourg": "Hamburg",
    "amburgo": "Hamburg",
    "münster": "Munster",
    "muenster": "Munster",
    "berlin": "Berlin",
    "berlino": "Berlin",
    "dresde": "Dresden",
    "dresden": "Dresden",
    "dresda": "Dresden",
    "leipzig": "Leipzig",
    "lipsia": "Leipzig",
    "stuttgart": "Stuttgart",
    "stoccarda": "Stuttgart",
    "düsseldorf": "Dusseldorf",
    "dusseldorf": "Dusseldorf",
    "düsseldorfo": "Dusseldorf",
    "essen": "Essen",
    "bremen": "Bremen",
    "brême": "Bremen",
    "brema": "Bremen",
    "hannover": "Hannover",
    "hanover": "Hannover",
    "hanovre": "Hannover",
    "hannovre": "Hannover",
    "bonn": "Bonn",
    "bielefeld": "Bielefeld",
    "karlsruhe": "Karlsruhe",
    "carlesruhe": "Karlsruhe",
    "wiesbaden": "Wiesbaden",
    "augsburg": "Augsburg",
    "augsbourg": "Augsburg",
    "augusta": "Augsburg",
    "aachen": "Aachen",
    "aix-la-chapelle": "Aachen",
    "aquisgrana": "Aachen",
    "chemnitz": "Chemnitz",
    "chemnitz": "Chemnitz",
    "kiel": "Kiel",
    "magdeburg": "Magdeburg",
    "fribourg": "Freiburg",
    "freiburg": "Freiburg",
    "friburgo": "Freiburg",
    "lübeck": "Lubeck",
    "lubeck": "Lubeck",
    "lubeca": "Lubeck",
    "erfurt": "Erfurt",
    "rostock": "Rostock",
    "potsdam": "Potsdam",
    "saarbrücken": "Saarbrücken",
    "saarbruecken": "Saarbrücken",
    "saarbrucken": "Saarbrücken",
    "kassel": "Kassel",
    "cassel": "Kassel",
    "oberhausen": "Oberhausen",
    "münchengladbach": "Mönchengladbach",
    "moenchengladbach": "Mönchengladbach",
    "monchengladbach": "Mönchengladbach",
    "bremerhaven": "Bremerhaven",
    "hagen": "Hagen",
    "hamm": "Hamm",
    "mainz": "Mainz",
    "mayence": "Mainz",
    "magonza": "Mainz",
    "heidelberg": "Heidelberg",
    "darmstadt": "Darmstadt",
    "würzburg": "Würzburg",
    "wuerzburg": "Würzburg",
    "wurzburg": "Würzburg",
    "ingolstadt": "Ingolstadt",
    "ulm": "Ulm",
    "heilbronn": "Heilbronn",
    "pforzheim": "Pforzheim",
    "reutlingen": "Reutlingen",
    "göttingen": "Göttingen",
    "goettingen": "Göttingen",
    "gottingen": "Göttingen",
    "coblenz": "Koblenz",
    "koblenz": "Koblenz",
    "coblenza": "Koblenz",
    "trier": "Trier",
    "trèves": "Trier",
    "treviri": "Trier",
    "jena": "Jena",
    "gera": "Gera",
    "hildesheim": "Hildesheim",
    "zwickau": "Zwickau",
    "flensburg": "Flensburg",
    "flensbourg": "Flensburg",
    "flensburgo": "Flensburg",
    "cuxhaven": "Cuxhaven",
    "wilhelmshaven": "Wilhelmshaven",
    "baden-baden": "Baden-Baden",
    "badenbaden": "Baden-Baden",
    "wiesloch": "Wiesloch",
    "neustadt": "Neustadt",
    "neumünster": "Neumünster",
    "neumuenster": "Neumünster",
    "neumunster": "Neumünster",
    "radebeul": "Radebeul",
    "meissen": "Meissen",
    "meißen": "Meissen",
    "freiberg": "Freiberg",
    "freiberg": "Freiberg",
    "bautzen": "Bautzen",
    "bautzen": "Bautzen",
    "gorlitz": "Görlitz",
    "goerlitz": "Görlitz",
    "carlsbad": "Karlsbad",
    "karlsbad": "Karlsbad",

    "warszawa": "Warsaw",
    "varsovie": "Warsaw",
    "warschau": "Warsaw",
    "kraków": "Krakow",
    "krakow": "Krakow",
    "cracovie": "Krakow",
    "krakau": "Krakow",
    "wrocław": "Wroclaw",
    "wroclaw": "Wroclaw",
    "breslau": "Wroclaw",
    "łódź": "Lodz",
    "lodz": "Lodz",
    "poznan": "Poznan",
    "poznań": "Poznan",
    "posen": "Poznan",
    "gdańsk": "Gdansk",
    "gdansk": "Gdansk",
    "danzig": "Gdansk",
    "szczecin": "Szczecin",
    "stettin": "Szczecin",
    "bydgoszcz": "Bydgoszcz",
    "bromberg": "Bydgoszcz",
    "lublin": "Lublin",
    "katowice": "Katowice",
    "kattowitz": "Katowice",
    "bialystok": "Bialystok",
    "białystok": "Bialystok",
    "gdynia": "Gdynia",
    "gdingen": "Gdynia",
    "częstochowa": "Czestochowa",
    "czestochowa": "Czestochowa",
    "radom": "Radom",
    "sosnowiec": "Sosnowiec",
    "toruń": "Torun",
    "torun": "Torun",
    "thorn": "Torun",
    "kielce": "Kielce",
    "rzeszów": "Rzeszow",
    "rzeszow": "Rzeszow",
    "opole": "Opole",
    "oppeln": "Opole",
    "zielona góra": "Zielona Gora",
    "zielona gora": "Zielona Gora",
    "gorzów wielkopolski": "Gorzow Wielkopolski",
    "gorzow wielkopolski": "Gorzow Wielkopolski",
    "wałbrzych": "Walbrzych",
    "walbrzych": "Walbrzych",
    "włocławek": "Wloclawek",
    "wloclawek": "Wloclawek",
    "tarnów": "Tarnow",
    "tarnow": "Tarnow",
    "plock": "Plock",
    "płock": "Plock",
    "chorzów": "Chorzow",
    "chorzow": "Chorzow",
    "kalisz": "Kalisz",
    "kalisz": "Kalisz",
    "koszalin": "Koszalin",
    "köslin": "Koszalin",
    "legnica": "Legnica",
    "liegnitz": "Legnica",
    "grudziądz": "Grudziadz",
    "grudziadz": "Grudziadz",
    "graudenz": "Grudziadz",
    "slupsk": "Slupsk",
    "słupsk": "Slupsk",
    "stolp": "Slupsk",
    "bielsko-biała": "Bielsko-Biala",
    "bielsko-biala": "Bielsko-Biala",

    "milano": "Milan",
    "roma": "Rome",
    "rom": "Rome",
    "firenze": "Florence",
    "florenz": "Florence",
    "venezia": "Venice",
    "venise": "Venice",
    "venedig": "Venice",
    "napoli": "Naples",
    "neapel": "Naples",
    "torino": "Turin",
    "genova": "Genoa",
    "gênes": "Genoa",
    "genua": "Genoa",
    "padova": "Padua",
    "padoue": "Padua",
    "bologna": "Bologna",
    "bologne": "Bologna",
    "palermo": "Palermo",
    "palerme": "Palermo",
    "catania": "Catania",
    "catane": "Catania",
    "messina": "Messina",
    "messine": "Messina",
    "bari": "Bari",
    "taranto": "Taranto",
    "tarente": "Taranto",
    "cagliari": "Cagliari",
    "trieste": "Trieste",
    "verona": "Verona",
    "vérone": "Verona",
    "brescia": "Brescia",
    "parma": "Parma",
    "parme": "Parma",
    "modena": "Modena",
    "modène": "Modena",
    "ravenna": "Ravenna",
    "ravenne": "Ravenna",
    "rimini": "Rimini",
    "perugia": "Perugia",
    "pérouse": "Perugia",
    "ancona": "Ancona",
    "ancône": "Ancona",
    "trento": "Trento",
    "trente": "Trento",
    "bolzano": "Bolzano",
    "bozen": "Bolzano",
    "siena": "Siena",
    "sienne": "Siena",
    "lucca": "Lucca",
    "lucques": "Lucca",
    "pisa": "Pisa",
    "pise": "Pisa",
    "livorno": "Livorno",
    "livourne": "Livorno",
    "arezzo": "Arezzo",
    "como": "Como",
    "côme": "Como",
    "varese": "Varese",
    "bergamo": "Bergamo",
    "bergame": "Bergamo",
    "cuneo": "Cuneo",
    "asti": "Asti",
    "alessandria": "Alessandria",
    "novara": "Novara",
    "vercelli": "Vercelli",
    "biella": "Biella",
    "verbania": "Verbania",
    "aosta": "Aosta",
    "aoste": "Aosta",
    "sondrio": "Sondrio",
    "lecco": "Lecco",
    "lodi": "Lodi",
    "cremona": "Cremona",
    "crémone": "Cremona",
    "mantova": "Mantua",
    "mantoue": "Mantua",
    "rovigo": "Rovigo",
    "vicenza": "Vicenza",
    "vicence": "Vicenza",
    "belluno": "Belluno",
    "treviso": "Treviso",
    "trévise": "Treviso",
    "udine": "Udine",
    "pordenone": "Pordenone",
    "gorizia": "Gorizia",
    "imperia": "Imperia",
    "savona": "Savona",
    "savone": "Savona",
    "la spezia": "La Spezia",
    "massa": "Massa",
    "pistoia": "Pistoia",
    "prato": "Prato",
    "grosseto": "Grosseto",
    "terni": "Terni",
    "foligno": "Foligno",
    "spoleto": "Spoleto",
    "spolète": "Spoleto",
    "ascoli piceno": "Ascoli Piceno",
    "macerata": "Macerata",
    "fermo": "Fermo",
    "pesaro": "Pesaro",
    "urbino": "Urbino",
    "fano": "Fano",
    "jesi": "Jesi",
    "camerino": "Camerino",
    "san benedetto del tronto": "San Benedetto del Tronto",
    "laquila": "L'Aquila",
    "l'aquila": "L'Aquila",
    "teramo": "Teramo",
    "pescara": "Pescara",
    "chieti": "Chieti",
    "campobasso": "Campobasso",
    "isernia": "Isernia",
    "caserta": "Caserta",
    "caserte": "Caserta",
    "benevento": "Benevento",
    "bénévent": "Benevento",
    "avellino": "Avellino",
    "salerno": "Salerno",
    "salerne": "Salerno",
    "foggia": "Foggia",
    "brindisi": "Brindisi",
    "lecce": "Lecce",
    "barletta": "Barletta",
    "andria": "Andria",
    "trani": "Trani",
    "catanzaro": "Catanzaro",
    "cosenza": "Cosenza",
    "crotone": "Crotone",
    "reggio calabria": "Reggio Calabria",
    "vibo valentia": "Vibo Valentia",
    "potenza": "Potenza",
    "matera": "Matera",
    "siracusa": "Syracuse",
    "syracuse": "Syracuse",
    "ragusa": "Ragusa",
    "enna": "Enna",
    "caltanissetta": "Caltanissetta",
    "agrigento": "Agrigento",
    "agrigente": "Agrigento",
    "trapani": "Trapani",
    "sassari": "Sassari",
    "nuoro": "Nuoro",
    "oristano": "Oristano",
    "olbia": "Olbia",
    "tempio pausania": "Tempio Pausania",
    "carbonia": "Carbonia",
    "iglesias": "Iglesias",

    "sevilla": "Seville",
    "séville": "Seville",
    "zaragoza": "Zaragoza",
    "saragosse": "Zaragoza",
    "barcellona": "Barcelona",
    "barcelone": "Barcelona",
    "madrid": "Madrid",
    "valencia": "Valencia",
    "valence": "Valencia",
    "valenza": "Valencia",
    "malaga": "Malaga",
    "málaga": "Malaga",
    "murcia": "Murcia",
    "murcie": "Murcia",
    "palma": "Palma de Mallorca",
    "palma de mallorca": "Palma de Mallorca",
    "las palmas": "Las Palmas de Gran Canaria",
    "las palmas de gran canaria": "Las Palmas de Gran Canaria",
    "bilbao": "Bilbao",
    "alicante": "Alicante",
    "cordoba": "Cordoba",
    "cordoue": "Cordoba",
    "valladolid": "Valladolid",
    "vigo": "Vigo",
    "gijon": "Gijón",
    "gijón": "Gijón",
    "coruna": "A Coruña",
    "a coruña": "A Coruña",
    "la coruña": "A Coruña",
    "vitoria": "Vitoria-Gasteiz",
    "vitoria-gasteiz": "Vitoria-Gasteiz",
    "granada": "Granada",
    "grenade": "Granada",
    "elche": "Elche",
    "oviedo": "Oviedo",
    "santa cruz de tenerife": "Santa Cruz de Tenerife",
    "badalona": "Badalona",
    "terrassa": "Terrassa",
    "sabadell": "Sabadell",
    "cartagena": "Cartagena",
    "carthagène": "Cartagena",
    "jerez": "Jerez de la Frontera",
    "jerez de la frontera": "Jerez de la Frontera",
    "pamplona": "Pamplona",
    "pampelune": "Pamplona",
    "donostia": "San Sebastián",
    "san sebastian": "San Sebastián",
    "san sebastián": "San Sebastián",
    "logroño": "Logroño",
    "logrono": "Logroño",
    "salamanca": "Salamanca",
    "salamanque": "Salamanca",
    "huelva": "Huelva",
    "lleida": "Lleida",
    "lerida": "Lleida",
    "marbella": "Marbella",
    "cadiz": "Cádiz",
    "cadix": "Cádiz",
    "algeciras": "Algeciras",
    "santander": "Santander",
    "burgos": "Burgos",
    "albacete": "Albacete",
    "almeria": "Almería",
    "almería": "Almería",
    "soria": "Soria",
    "cuenca": "Cuenca",
    "toledo": "Toledo",
    "tolède": "Toledo",
    "ciudad real": "Ciudad Real",
    "caceres": "Cáceres",
    "cáceres": "Cáceres",
    "badajoz": "Badajoz",
    "leon": "León",
    "león": "León",
    "zamora": "Zamora",
    "palencia": "Palencia",
    "avila": "Ávila",
    "ávila": "Ávila",
    "segovia": "Segovia",
    "ségovie": "Segovia",
    "guadalajara": "Guadalajara",
    "tarragona": "Tarragona",
    "tarragone": "Tarragona",
    "girona": "Girona",
    "gerone": "Girona",
    "figueres": "Figueres",
    "reus": "Reus",
    "tortosa": "Tortosa",
    "huesca": "Huesca",
    "teruel": "Teruel",
    "castellon": "Castellón de la Plana",
    "castellón de la plana": "Castellón de la Plana",
    "ourense": "Ourense",
    "pontevedra": "Pontevedra",
    "lugo": "Lugo",
    "santiago de compostela": "Santiago de Compostela",
    "compostela": "Santiago de Compostela",
    "ferrol": "Ferrol",
    "jaen": "Jaén",
    "jaén": "Jaén",

    "praha": "Prague",
    "prag": "Prague",
    "wien": "Vienna",
    "vienne": "Vienna",
    "genève": "Geneva",
    "geneve": "Geneva",
    "genf": "Geneva",
    "ginevra": "Geneva",
    "zürich": "Zurich",
    "zurich": "Zurich",
    "zuerich": "Zurich",
    "brüssel": "Brussels",
    "brussel": "Brussels",
    "bruxelles": "Brussels",
    "lisboa": "Lisbon",
    "lisbonne": "Lisbon",
    "koebenhavn": "Copenhagen",
    "kopenhagen": "Copenhagen",
    "copenhague": "Copenhagen",
    "bucuresti": "Bucharest",
    "bucarest": "Bucharest",
    "athenes": "Athens",
    "athina": "Athens",
    "kyiv": "Kyiv",
    "kiev": "Kyiv",
    "beograd": "Belgrade",
    "luxemburg": "Luxembourg",

    "london": "London",
    "londres": "London",
    "londen": "London",
    "londra": "London",
    "paris": "Paris",
    "parigi": "Paris",
    "amsterdam": "Amsterdam",
    "stockholm": "Stockholm",
    "stoccolma": "Stockholm",
    "oslo": "Oslo",
    "helsinki": "Helsinki",
    "helsingfors": "Helsinki",
    "reykjavik": "Reykjavik",
    "reykjavík": "Reykjavik",
    "dublin": "Dublin",
    "dublino": "Dublin",
    "edinburgh": "Edinburgh",
    "edimbourg": "Edinburgh",
    "edimburgo": "Edinburgh",
    "glasgow": "Glasgow",
    "manchester": "Manchester",
    "birmingham": "Birmingham",
    "liverpool": "Liverpool",
    "bristol": "Bristol",
    "sheffield": "Sheffield",
    "leeds": "Leeds",
    "newcastle": "Newcastle upon Tyne",
    "newcastle upon tyne": "Newcastle upon Tyne",
    "bradford": "Bradford",
    "nottingham": "Nottingham",
    "hull": "Kingston upon Hull",
    "kingston upon hull": "Kingston upon Hull",
    "plymouth": "Plymouth",
    "southampton": "Southampton",
    "portsmouth": "Portsmouth",
    "aberdeen": "Aberdeen",
    "dundee": "Dundee",
    "belfast": "Belfast",
    "cardiff": "Cardiff",
    "swansea": "Swansea",
    "newport": "Newport",
    "stoke on trent": "Stoke-on-Trent",
    "coventry": "Coventry",
    "leicester": "Leicester",
    "brighton": "Brighton",
    "oxford": "Oxford",
    "cambridge": "Cambridge",
    "york": "York",
    "bath": "Bath",
    "winchester": "Winchester",
    "salisbury": "Salisbury",
    "canterbury": "Canterbury",
    "belfast": "Belfast",

    "marseille": "Marseille",
    "marsiglia": "Marseille",
    "lyon": "Lyon",
    "lione": "Lyon",
    "toulouse": "Toulouse",
    "nice": "Nice",
    "nizza": "Nice",
    "nantes": "Nantes",
    "montpellier": "Montpellier",
    "strasbourg": "Strasbourg",
    "strasburgo": "Strasbourg",
    "strassburg": "Strasbourg",
    "bordeaux": "Bordeaux",
    "lille": "Lille",
    "rennes": "Rennes",
    "reims": "Reims",
    "le havre": "Le Havre",
    "saint-etienne": "Saint-Étienne",
    "saint etienne": "Saint-Étienne",
    "toulon": "Toulon",
    "grenoble": "Grenoble",
    "dijon": "Dijon",
    "angers": "Angers",
    "nîmes": "Nîmes",
    "nimes": "Nîmes",
    "aix-en-provence": "Aix-en-Provence",
    "aix en provence": "Aix-en-Provence",
    "clermont-ferrand": "Clermont-Ferrand",
    "clermont ferrand": "Clermont-Ferrand",
    "tours": "Tours",
    "limoges": "Limoges",
    "metz": "Metz",
    "besançon": "Besançon",
    "besancon": "Besançon",
    "orléans": "Orléans",
    "orleans": "Orléans",
    "rouen": "Rouen",
    "caen": "Caen",
    "nancy": "Nancy",
    "mulhouse": "Mulhouse",
    "perpignan": "Perpignan",
    "avignon": "Avignon",
    "poitiers": "Poitiers",
    "la rochelle": "La Rochelle",
    "brest": "Brest",
    "lorient": "Lorient",
    "annecy": "Annecy",
    "chambéry": "Chambéry",
    "chambery": "Chambéry",
    "bayonne": "Bayonne",
    "biarritz": "Biarritz",
    "carcassonne": "Carcassonne",
    "arles": "Arles",
    "antibes": "Antibes",
    "cannes": "Cannes",
    "saint-tropez": "Saint-Tropez",
    "saint tropez": "Saint-Tropez",
    "monaco": "Monaco",

    "lausanne": "Lausanne",
    "bern": "Bern",
    "berne": "Bern",
    "basel": "Basel",
    "bâle": "Basel",
    "basilea": "Basel",
    "luzern": "Lucerne",
    "lucerne": "Lucerne",
    "lugano": "Lugano",
    "interlaken": "Interlaken",
    "st. gallen": "St. Gallen",
    "sankt gallen": "St. Gallen",
    "saint-gall": "St. Gallen",
    "chur": "Chur",
    "coire": "Chur",
    "fribourg": "Fribourg",
    "freiburg": "Fribourg",
    "neuchâtel": "Neuchâtel",
    "neuchatel": "Neuchâtel",

    "salzburg": "Salzburg",
    "salzbourg": "Salzburg",
    "innsbruck": "Innsbruck",
    "graz": "Graz",
    "linz": "Linz",
    "klagenfurt": "Klagenfurt",
    "villach": "Villach",
    "wels": "Wels",
    "st. pölten": "St. Pölten",
    "sankt pölten": "St. Pölten",

    "rotterdam": "Rotterdam",
    "den haag": "The Hague",
    "the hague": "The Hague",
    "la haye": "The Hague",
    "utrecht": "Utrecht",
    "eindhoven": "Eindhoven",
    "maastricht": "Maastricht",
    "groningen": "Groningen",
    "tilburg": "Tilburg",
    "almere": "Almere",
    "breda": "Breda",
    "nijmegen": "Nijmegen",
    "enschede": "Enschede",
    "haarlem": "Haarlem",
    "arnhem": "Arnhem",
    "zaanstad": "Zaanstad",
    "amersfoort": "Amersfoort",
    "den bosch": "Den Bosch",
    "s-hertogenbosch": "Den Bosch",
    "zwolle": "Zwolle",
    "leiden": "Leiden",
    "leyden": "Leiden",
    "dordrecht": "Dordrecht",

    "antwerpen": "Antwerp",
    "anvers": "Antwerp",
    "anversa": "Antwerp",
    "gent": "Ghent",
    "gand": "Ghent",
    "brugge": "Bruges",
    "bruges": "Bruges",
    "liège": "Liège",
    "liege": "Liège",
    "lüttich": "Liège",
    "charleroi": "Charleroi",
    "namur": "Namur",
    "namen": "Namur",
    "mons": "Mons",
    "bergen": "Mons",
    "mechelen": "Mechelen",
    "malines": "Mechelen",
    "leuven": "Leuven",
    "louvain": "Leuven",
    "kortrijk": "Kortrijk",
    "courtrai": "Kortrijk",
    "ostend": "Ostend",
    "oostende": "Ostend",
    "ostende": "Ostend",
    "sint-niklaas": "Sint-Niklaas",
    "genk": "Genk",
    "roeselare": "Roeselare",
    "roulers": "Roeselare",
    "verviers": "Verviers",

    "luxembourg": "Luxembourg",
    "luxemburg": "Luxembourg",

    "aarhus": "Aarhus",
    "arhus": "Aarhus",
    "odense": "Odense",
    "aalborg": "Aalborg",
    "ålborg": "Aalborg",
    "esbjerg": "Esbjerg",
    "randers": "Randers",
    "kolding": "Kolding",
    "horsens": "Horsens",
    "vejle": "Vejle",
    "roskilde": "Roskilde",

    "gothenburg": "Gothenburg",
    "göteborg": "Gothenburg",
    "gotembourg": "Gothenburg",
    "malmö": "Malmö",
    "malmo": "Malmö",
    "uppsala": "Uppsala",
    "västerås": "Västerås",
    "vasteras": "Västerås",
    "örebro": "Örebro",
    "orebro": "Örebro",
    "linköping": "Linköping",
    "linkoping": "Linköping",
    "helsingborg": "Helsingborg",
    "jönköping": "Jönköping",
    "jonkoping": "Jönköping",
    "norrköping": "Norrköping",
    "norrkoping": "Norrköping",
    "lund": "Lund",
    "umeå": "Umeå",
    "umea": "Umeå",
    "gävle": "Gävle",
    "gavle": "Gävle",
    "södertälje": "Södertälje",
    "sodertalje": "Södertälje",
    "borås": "Borås",
    "boras": "Borås",
    "halmstad": "Halmstad",
    "växjö": "Växjö",
    "vaxjo": "Växjö",
    "eskilstuna": "Eskilstuna",
    "karlstad": "Karlstad",

    "bergen": "Bergen",
    "trondheim": "Trondheim",
    "nidaros": "Trondheim",
    "stavanger": "Stavanger",
    "drammen": "Drammen",
    "fredrikstad": "Fredrikstad",
    "kristiansand": "Kristiansand",
    "sandnes": "Sandnes",
    "tromsø": "Tromsø",
    "tromso": "Tromsø",
    "sarpsborg": "Sarpsborg",
    "skien": "Skien",
    "ålesund": "Ålesund",
    "alesund": "Ålesund",
    "bodø": "Bodø",
    "bodo": "Bodø",

    "espoo": "Espoo",
    "tampere": "Tampere",
    "tammerfors": "Tampere",
    "vantaa": "Vantaa",
    "turku": "Turku",
    "åbo": "Turku",
    "oulu": "Oulu",
    "jyväskylä": "Jyväskylä",
    "jyvaskyla": "Jyväskylä",
    "lahti": "Lahti",
    "kuopio": "Kuopio",

    "akureyri": "Akureyri",
    "keflavik": "Keflavík",
    "keflavík": "Keflavík",

    "cork": "Cork",
    "limerick": "Limerick",
    "galway": "Galway",
    "waterford": "Waterford",

    "porto": "Porto",
    "oporto": "Porto",
    "braga": "Braga",
    "coimbra": "Coimbra",
    "funchal": "Funchal",
    "setúbal": "Setúbal",
    "setubal": "Setúbal",
    "faro": "Faro",
    "évora": "Évora",
    "evora": "Évora",
    "portimão": "Portimão",
    "portimao": "Portimão",
    "viseu": "Viseu",
    "aveiro": "Aveiro",
    "guimarães": "Guimarães",
    "guimaraes": "Guimarães",
    "leiria": "Leiria",
    "sintra": "Sintra",
    "cascais": "Cascais",

    "andorra la vella": "Andorra la Vella",
    "andorre": "Andorra la Vella",

    "valletta": "Valletta",
    "la valette": "Valletta",
    "mdina": "Mdina",
    "rabat": "Rabat",
    "sliema": "Sliema",
    "st julians": "St. Julian's",
    "saint julian's": "St. Julian's",

    "nicosia": "Nicosia",
    "lefkosia": "Nicosia",
    "limassol": "Limassol",
    "lemesos": "Limassol",
    "larnaca": "Larnaca",
    "paphos": "Paphos",
    "famagusta": "Famagusta",
    "gazimağusa": "Famagusta",
    "kyrenia": "Kyrenia",
    "girne": "Kyrenia",

    "vaduz": "Vaduz",

    "san marino": "San Marino",

    "vatican city": "Vatican City",
    "vaticano": "Vatican City",
    "cité du vatican": "Vatican City",

    "istanbul": "Istanbul",
    "constantinople": "Istanbul",
    "stamboul": "Istanbul",
    "ankara": "Ankara",
    "izmir": "Izmir",
    "smyrne": "Izmir",
    "bursa": "Bursa",
    "antalya": "Antalya",
    "adana": "Adana",
    "konya": "Konya",
    "gaziantep": "Gaziantep",
    "diyarbakir": "Diyarbakır",
    "mersin": "Mersin",
    "kayseri": "Kayseri",
    "eskisehir": "Eskişehir",
    "denizli": "Denizli",
    "samsun": "Samsun",
    "kahramanmaras": "Kahramanmaraş",
    "van": "Van",
    "aydin": "Aydın",
    "tekirdag": "Tekirdağ",
    "isparta": "Isparta",
    "afyon": "Afyonkarahisar",
    "malatya": "Malatya",
    "elazig": "Elazığ",
    "erzurum": "Erzurum",
    "trabzon": "Trabzon",
    "rize": "Rize",
    "ordu": "Ordu",
    "giresun": "Giresun",
    "zonguldak": "Zonguldak",
    "bolu": "Bolu",
    "duzce": "Düzce",
    "sakarya": "Sakarya",
    "kocaeli": "Kocaeli",
    "yalova": "Yalova",
    "bilecik": "Bilecik",
    "kutahya": "Kütahya",
    "manisa": "Manisa",
    "usak": "Uşak",
    "burdur": "Burdur",
    "mugla": "Muğla",
    "balikesir": "Balıkesir",
    "canakkale": "Çanakkale",
    "edirne": "Edirne",
    "kirklareli": "Kırklareli",
    "bartin": "Bartın",
    "karabuk": "Karabük",
    "kastamonu": "Kastamonu",
    "sinop": "Sinop",
    "artvin": "Artvin",
    "ardahan": "Ardahan",
    "kars": "Kars",
    "igdir": "Iğdır",
    "agri": "Ağrı",
    "bitlis": "Bitlis",
    "mus": "Muş",
    "bingol": "Bingöl",
    "tunceli": "Tunceli",
    "erzincan": "Erzincan",
    "bayburt": "Bayburt",
    "gumushane": "Gümüşhane",
    "corum": "Çorum",
    "amasya": "Amasya",
    "tokat": "Tokat",
    "sivas": "Sivas",
    "yozgat": "Yozgat",
    "nevsehir": "Nevşehir",
    "nigde": "Niğde",
    "aksaray": "Aksaray",
    "kirsehir": "Kırşehir",
    "kirikkale": "Kırıkkale",
    "cankiri": "Çankırı",
    "karaman": "Karaman",
    "hatay": "Hatay",
    "osmaniye": "Osmaniye",
    "kilis": "Kilis",
    "sanliurfa": "Şanlıurfa",
    "adiyaman": "Adıyaman",
    "batman": "Batman",
    "siirt": "Siirt",
    "sirnak": "Şırnak",
    "mardin": "Mardin",
    "hakkari": "Hakkari",

    "kharkiv": "Kharkiv",
    "kharkov": "Kharkiv",
    "odessa": "Odesa",
    "odesa": "Odesa",
    "lviv": "Lviv",
    "lvov": "Lviv",
    "lemberg": "Lviv",
    "dnipro": "Dnipro",
    "dnipropetrovsk": "Dnipro",
    "donetsk": "Donetsk",
    "zaporizhzhia": "Zaporizhzhia",
    "zaporijjia": "Zaporizhzhia",
    "kryvyi rih": "Kryvyi Rih",
    "mykolaiv": "Mykolaiv",
    "mariupol": "Mariupol",
    "luhansk": "Luhansk",
    "vinnytsia": "Vinnytsia",
    "chernihiv": "Chernihiv",
    "poltava": "Poltava",
    "cherkasy": "Cherkasy",
    "sumy": "Sumy",
    "zhytomyr": "Zhytomyr",
    "khmelnytskyi": "Khmelnytskyi",
    "rivne": "Rivne",
    "ivano-frankivsk": "Ivano-Frankivsk",
    "ternopil": "Ternopil",
    "lutsk": "Lutsk",
    "uzhhorod": "Uzhhorod",

    "minsk": "Minsk",
    "gomel": "Gomel",
    "homiel": "Gomel",
    "mogilev": "Mogilev",
    "mahilyow": "Mogilev",
    "vitebsk": "Vitebsk",
    "grodno": "Grodno",
    "hrodna": "Grodno",
    "brest": "Brest",
    "babruysk": "Babruysk",
    "bobruisk": "Babruysk",

    "vilnius": "Vilnius",
    "wilna": "Vilnius",
    "kaunas": "Kaunas",
    "kauen": "Kaunas",
    "klaipeda": "Klaipėda",
    "memel": "Klaipėda",
    "siauliai": "Šiauliai",
    "panevezys": "Panevėžys",

    "riga": "Riga",
    "daugavpils": "Daugavpils",
    "liepaja": "Liepāja",
    "libau": "Liepāja",
    "jelgava": "Jelgava",
    "mitau": "Jelgava",

    "tallinn": "Tallinn",
    "revel": "Tallinn",
    "tartu": "Tartu",
    "dorpat": "Tartu",
    "narva": "Narva",
    "parnu": "Pärnu",

    "budapest": "Budapest",
    "debrecen": "Debrecen",
    "szeged": "Szeged",
    "miskolc": "Miskolc",
    "pecs": "Pécs",
    "győr": "Győr",
    "gyor": "Győr",
    "nyiregyhaza": "Nyíregyháza",
    "kecskemet": "Kecskemét",
    "székesfehérvár": "Székesfehérvár",
    "szekesfehervar": "Székesfehérvár",

    "bratislava": "Bratislava",
    "presbourg": "Bratislava",
    "kosice": "Košice",
    "kaschau": "Košice",
    "presov": "Prešov",
    "zilina": "Žilina",
    "banska bystrica": "Banská Bystrica",
    "nove zamky": "Nové Zámky",

    "ljubljana": "Ljubljana",
    "laibach": "Ljubljana",
    "maribor": "Maribor",
    "celje": "Celje",
    "kranj": "Kranj",
    "velenje": "Velenje",
    "koper": "Koper",

    "zagreb": "Zagreb",
    "split": "Split",
    "spalato": "Split",
    "dubrovnik": "Dubrovnik",
    "raguse": "Dubrovnik",
    "rijeka": "Rijeka",
    "fiume": "Rijeka",
    "zadar": "Zadar",
    "pula": "Pula",
    "sibenik": "Šibenik",
    "osijek": "Osijek",
    "slavonski brod": "Slavonski Brod",
    "varazdin": "Varaždin",

    "sarajevo": "Sarajevo",
    "banja luka": "Banja Luka",
    "mostar": "Mostar",
    "tuzla": "Tuzla",
    "zenica": "Zenica",
    "bihać": "Bihać",
    "bihac": "Bihać",

    "belgrade": "Belgrade",
    "novi sad": "Novi Sad",
    "nis": "Niš",
    "niš": "Niš",
    "kragujevac": "Kragujevac",
    "subotica": "Subotica",
    "zrenjanin": "Zrenjanin",
    "pančevo": "Pančevo",
    "pancevo": "Pančevo",
    "čačak": "Čačak",
    "cacak": "Čačak",
    "kraljevo": "Kraljevo",

    "podgorica": "Podgorica",
    "kotor": "Kotor",
    "budva": "Budva",
    "herceg novi": "Herceg Novi",
    "bar": "Bar",
    "nikšić": "Nikšić",
    "niksic": "Nikšić",

    "skopje": "Skopje",
    "bitola": "Bitola",
    "kumanovo": "Kumanovo",
    "prilep": "Prilep",
    "tetovo": "Tetovo",

    "tirana": "Tirana",
    "durrës": "Durrës",
    "durres": "Durrës",
    "vlorë": "Vlorë",
    "vlore": "Vlorë",
    "shkodër": "Shkodër",
    "shkoder": "Shkodër",
    "elbasan": "Elbasan",

    "thessaloniki": "Thessaloniki",
    "salonique": "Thessaloniki",
    "salonica": "Thessaloniki",
    "patras": "Patras",
    "heraklion": "Heraklion",
    "iráklio": "Heraklion",
    "rhodes": "Rhodes",
    "rodos": "Rhodes",
    "larissa": "Larissa",
    "volos": "Volos",
    "ioannina": "Ioannina",
    "chania": "Chania",
    "khania": "Chania",
    "kavala": "Kavala",
    "corfu": "Corfu",
    "kerkyra": "Corfu",

    "sofia": "Sofia",
    "plovdiv": "Plovdiv",
    "varna": "Varna",
    "burgas": "Burgas",
    "broussas": "Burgas",
    "ruse": "Ruse",
    "stara zagora": "Stara Zagora",
    "pleven": "Pleven",
    "sliven": "Sliven",
    "dobrich": "Dobrich",
    "shumen": "Shumen",

    "cluj": "Cluj-Napoca",
    "cluj-napoca": "Cluj-Napoca",
    "klausenburg": "Cluj-Napoca",
    "timisoara": "Timișoara",
    "temeswar": "Timișoara",
    "iasi": "Iași",
    "jassy": "Iași",
    "constanta": "Constanța",
    "brasov": "Brașov",
    "kronstadt": "Brașov",
    "craiova": "Craiova",
    "galati": "Galați",
    "ploiesti": "Ploiești",
    "oradea": "Oradea",
    "sibiu": "Sibiu",
    "hermannstadt": "Sibiu",
    "arad": "Arad",
    "targu mures": "Târgu Mureș",
    "baia mare": "Baia Mare",
    "buzau": "Buzău",
    "satu mare": "Satu Mare",
    "botoșani": "Botoșani",
    "botosani": "Botoșani",
    "suceava": "Suceava",

    "chisinau": "Chișinău",
    "kishinev": "Chișinău",
    "tiraspol": "Tiraspol",
    "bălți": "Bălți",
    "balți": "Bălți",
    "balti": "Bălți",
}
SEO_CONFIG = {
    "home": {
        "fr": {"title": "Linia - Planificateur d'Itinéraire Bus | FlixBus BlaBlaCar", "description": "Planifiez votre voyage en bus avec Linia. Visualisez les lignes FlixBus et BlaBlaCar Bus sur une carte interactive, comparez les connexions et créez vos itinéraires personnalisés."},
        "en": {"title": "Linia - Bus Route Planner | FlixBus and BlaBlaCar Routes", "description": "Plan your European bus journey with Linia. Visualize FlixBus and BlaBlaCar routes on an interactive map and create custom itineraries across 30+ countries."},
        "de": {"title": "Linia - Fernbus Routenplaner | FlixBus und BlaBlaCar", "description": "Planen Sie Ihre Busreise mit Linia. Visualisieren Sie FlixBus- und BlaBlaCar-Buslinien auf einer interaktiven Karte und erstellen Sie individuelle Routen."},
        "es": {"title": "Linia - Planificador de Rutas de Autobús | FlixBus y BlaBlaCar", "description": "Planifica tu viaje en autobús por Europa con Linia. Visualiza las rutas de FlixBus y BlaBlaCar en un mapa interactivo y crea itinerarios personalizados."},
        "it": {"title": "Linia - Pianificatore di Percorsi Autobus | FlixBus e BlaBlaCar", "description": "Pianifica il tuo viaggio in autobus con Linia. Visualizza le rotte FlixBus e BlaBlaCar su una mappa interattiva e crea itinerari personalizzati."},
        "nl": {"title": "Linia - Busroute Planner | FlixBus en BlaBlaCar", "description": "Plan je busreis door Europa met Linia. Visualiseer FlixBus- en BlaBlaCar-routes op een interactieve kaart en stel je eigen busroute samen."},
        "pt": {"title": "Linia - Planeador de Rotas de Autocarro | FlixBus e BlaBlaCar", "description": "Planeie a sua viagem de autocarro com a Linia. Visualize as rotas FlixBus e BlaBlaCar num mapa interativo e crie itinerários personalizados."},
        "pl": {"title": "Linia - Planer Tras Autobusowych | FlixBus i BlaBlaCar", "description": "Planuj podróże autobusem po Europie z Linia. Wyświetlaj trasy FlixBus i BlaBlaCar na interaktywnej mapie i twórz własne itineraria."},
        "sq": {"title": "Linia - Planifikues Rrugësh Autobusi | FlixBus dhe BlaBlaCar", "description": "Planifikoni udhëtimin tuaj me autobus në Evropë me Linia. Vizualizoni linjat FlixBus dhe BlaBlaCar në një hartë interaktive."},
        "ca": {"title": "Linia - Planificador de Rutes d'Autobús | FlixBus i BlaBlaCar", "description": "Planifica el teu viatge en autobús per Europa amb Linia. Visualitza les rutes de FlixBus i BlaBlaCar en un mapa interactiu."},
        "hr": {"title": "Linia - Planer Autobusnih Ruta | FlixBus i BlaBlaCar", "description": "Planirajte svoje putovanje autobusom s Linia. Vizualizirajte linije FlixBus i BlaBlaCar na interaktivnoj karti."},
        "bg": {"title": "Linia - Планировчик на Автобусни Маршрути | FlixBus и BlaBlaCar", "description": "Планирайте пътуването си с автобус с Linia. Визуализирайте линиите на FlixBus и BlaBlaCar на интерактивна карта."},
        "da": {"title": "Linia - Busrute Planlægger | FlixBus og BlaBlaCar", "description": "Planlæg din busrejse gennem Europa med Linia. Visualiser FlixBus- og BlaBlaCar-ruter på et interaktivt kort."},
        "et": {"title": "Linia - Bussiliinide Planeerija | FlixBus ja BlaBlaCar", "description": "Planeeri oma bussireis läbi Euroopa Linia abiga. Visualiseeri FlixBus ja BlaBlaCar liine interaktiivsel kaardil."},
        "fi": {"title": "Linia - Bussireitti-Suunnittelija | FlixBus ja BlaBlaCar", "description": "Suunnittele bussimatkasi Euroopassa Linian avulla. Visualisoi FlixBus- ja BlaBlaCar-reitit interaktiivisella kartalla."},
        "el": {"title": "Linia - Σχεδιασμός Διαδρομών Λεωφορείων | FlixBus και BlaBlaCar", "description": "Σχεδιάστε το ταξίδι σας με λεωφορείο στην Ευρώπη με το Linia. Οπτικοποιήστε τις διαδρομές FlixBus και BlaBlaCar."},
        "hu": {"title": "Linia - Buszútvonal Tervező | FlixBus és BlaBlaCar", "description": "Tervezze meg buszos útját Európában a Linia segítségével. Vizualizálja a FlixBus és BlaBlaCar útvonalakat interaktív térképen."},
        "hi": {"title": "Linia - बस रूट प्लानर | FlixBus और BlaBlaCar", "description": "Linia के साथ यूरोप में अपनी बस यात्रा की योजना बनाएं। इंटरैक्टिव मानचित्र पर FlixBus और BlaBlaCar मार्गों को देखें।"},
        "lv": {"title": "Linia - Autobusu Maršrutu Plānotājs | FlixBus un BlaBlaCar", "description": "Plānojiet savu autobusa ceļojumu caur Eiropu ar Linia. Vizualizējiet FlixBus un BlaBlaCar maršrutus interaktīvā kartē."},
        "lt": {"title": "Linia - Autobusų Maršrutų Planuoklis | FlixBus ir BlaBlaCar", "description": "Suplanuokite savo autobuso kelionę per Europą su Linia. Vizualizuokite FlixBus ir BlaBlaCar maršrutus interaktyviame žemėlapyje."},
        "lb": {"title": "Linia - Busroute Planner | FlixBus a BlaBlaCar", "description": "Plangt Äre Busparcours duerch Europa mat Linia. Visualiséiert d'FlixBus- a BlaBlaCar-Routen op enger interaktiver Kaart."},
        "mk": {"title": "Linia - Планер на Автобуски Рути | FlixBus и BlaBlaCar", "description": "Планирајте го вашето патување со автобус низ Европа со Linia. Визуелизирајте ги линиите на FlixBus и BlaBlaCar на интерактивна карта."},
        "ro": {"title": "Linia - Planificator Rute Autobuz | FlixBus și BlaBlaCar", "description": "Planificați călătoria cu autobuzul prin Europa cu Linia. Vizualizați rutele FlixBus și BlaBlaCar pe o hartă interactivă."},
        "cs": {"title": "Linia - Plánovač Autobusových Tras | FlixBus a BlaBlaCar", "description": "Naplánujte si cestu autobusem po Evropě s Linia. Vizualizujte linky FlixBus a BlaBlaCar na interaktivní mapě."},
        "sk": {"title": "Linia - Plánovač Autobusových Trás | FlixBus a BlaBlaCar", "description": "Naplánujte si cestu autobusom po Európe s Linia. Vizualizujte linky FlixBus a BlaBlaCar na interaktívnej mape."},
        "sl": {"title": "Linia - Načrtovalec Avtobusnih Poti | FlixBus in BlaBlaCar", "description": "Načrtujte svoje avtobusno potovanje po Evropi z Linia. Vizualizirajte linije FlixBus in BlaBlaCar na interaktivnem zemljevidu."},
        "sv": {"title": "Linia - Bussruteplanerare | FlixBus och BlaBlaCar", "description": "Planera din busresa genom Europa med Linia. Visualisera FlixBus- och BlaBlaCar-rutter på en interaktiv karta."},
        "tr": {"title": "Linia - Otobüs Güzergah Planlayıcısı | FlixBus ve BlaBlaCar", "description": "Linia ile Avrupa'daki otobüs yolculuğunuzu planlayın. FlixBus ve BlaBlaCar güzergahlarını interaktif haritada görüntüleyin."},
        "uk": {"title": "Linia - Планувальник Автобусних Маршрутів | FlixBus і BlaBlaCar", "description": "Сплануйте свою подорож автобусом Європою з Linia. Візуалізуйте маршрути FlixBus і BlaBlaCar на інтерактивній карті."},
        "ru": {"title": "Linia - Планировщик Автобусных Маршрутов | FlixBus и BlaBlaCar", "description": "Спланируйте поездку на автобусе по Европе с Linia. Визуализируйте маршруты FlixBus и BlaBlaCar на интерактивной карте."},
        "be": {"title": "Linia - Планіроўшчык Аўтобусных Маршрутаў | FlixBus і BlaBlaCar", "description": "Сплануйце сваю паездку на аўтобусе па Еўропе з Linia. Візуалізуйце маршруты FlixBus і BlaBlaCar на інтэрактыўнай карце."},
    },
    "map": {
        "fr": {"title": "Linia - Carte des Lignes de Bus | Réseau Europe", "description": "Explorez le réseau de bus FlixBus et BlaBlaCar sur une carte interactive. Trouvez tous les arrêts et lignes disponibles en Europe."},
        "en": {"title": "Linia - Bus Network Map | European Routes", "description": "Explore the FlixBus and BlaBlaCar bus network on an interactive map. Find all stops and routes available across Europe."},
        "de": {"title": "Linia - Busnetz Karte | Routen in Europa", "description": "Erkunden Sie das Busnetz von FlixBus und BlaBlaCar auf einer interaktiven Karte. Finden Sie alle Haltestellen und Linien in Europa."},
        "es": {"title": "Linia - Mapa de Rutas de Autobús | Red Europea", "description": "Explora la red de autobuses FlixBus y BlaBlaCar en un mapa interactivo. Encuentra todas las paradas y rutas disponibles en Europa."},
        "it": {"title": "Linia - Mappa della Rete Autobus | Rotte Europee", "description": "Esplora la rete di autobus FlixBus e BlaBlaCar su una mappa interattiva. Trova tutte le fermate e le rotte disponibili in Europa."},
        "nl": {"title": "Linia - Kaart Busnetwerk | Europese Routes", "description": "Verken het busnetwerk van FlixBus en BlaBlaCar op een interactieve kaart. Vind alle haltes en routes in Europa."},
        "pt": {"title": "Linia - Mapa de Rotas de Autocarro | Rede Europeia", "description": "Explore a rede de autocarros FlixBus e BlaBlaCar num mapa interativo. Encontre todas as paragens e rotas disponíveis na Europa."},
        "pl": {"title": "Linia - Mapa Połączeń Autobusowych | Trasy Europejskie", "description": "Odkryj sieć autobusową FlixBus i BlaBlaCar na interaktywnej mapie. Znajdź wszystkie przystanki i trasy dostępne w Europie."},
        "sq": {"title": "Linia - Harta e Rrjetit të Autobusëve | Rrugët Evropiane", "description": "Eksploroni rrjetin e autobusëve FlixBus dhe BlaBlaCar në një hartë interaktive. Gjeni të gjitha ndalesat dhe rrugët në Evropë."},
        "ca": {"title": "Linia - Mapa de Rutes d'Autobús | Xarxa Europea", "description": "Explora la xarxa d'autobusos FlixBus i BlaBlaCar en un mapa interactiu. Troba totes les parades i rutes disponibles a Europa."},
        "hr": {"title": "Linia - Karta Autobusne Mreže | Europske Rute", "description": "Istražite mrežu autobusa FlixBus i BlaBlaCar na interaktivnoj karti. Pronađite sva stajališta i rute dostupne u Europi."},
        "bg": {"title": "Linia - Карта на Автобусната Мрежа | Европейски Маршрути", "description": "Разгледайте автобусната мрежа на FlixBus и BlaBlaCar на интерактивна карта. Намерете всички спирки и маршрути."},
        "da": {"title": "Linia - Busnetværkskort | Europæiske Ruter", "description": "Udforsk FlixBus og BlaBlaCar busnetværket på et interaktivt kort. Find alle stoppesteder og ruter i Europa."},
        "et": {"title": "Linia - Bussivõrgu Kaart | Euroopa Marsruudid", "description": "Avasta FlixBusi ja BlaBlaCari bussivõrk interaktiivsel kaardil. Leia kõik peatused ja marsruudid Euroopas."},
        "fi": {"title": "Linia - Bussiverkostokartta | Euroopan Reitit", "description": "Tutki FlixBusin ja BlaBlaCarin bussiverkostoa interaktiivisella kartalla. Löydä kaikki pysäkit ja reitit Euroopassa."},
        "el": {"title": "Linia - Χάρτης Δικτύου Λεωφορείων | Ευρωπαϊκές Διαδρομές", "description": "Εξερευνήστε το δίκτυο λεωφορείων FlixBus και BlaBlaCar σε διαδραστικό χάρτη. Βρείτε όλες τις στάσεις και διαδρομές στην Ευρώπη."},
        "hu": {"title": "Linia - Buszhálózat Térkép | Európai Útvonalak", "description": "Fedezze fel a FlixBus és BlaBlaCar buszhálózatot interaktív térképen. Találja meg az összes megállót és útvonalat Európában."},
        "hi": {"title": "Linia - बस नेटवर्क मानचित्र | यूरोपीय मार्ग", "description": "इंटरैक्टिव मानचित्र पर FlixBus और BlaBlaCar बस नेटवर्क का अन्वेषण करें। यूरोप में उपलब्ध सभी स्टॉप और मार्ग खोजें।"},
        "lv": {"title": "Linia - Autobusu Tīkla Karte | Eiropas Maršruti", "description": "Izpētiet FlixBus un BlaBlaCar autobusu tīklu interaktīvā kartē. Atrodiet visas pieturas un maršrutus Eiropā."},
        "lt": {"title": "Linia - Autobusų Tinklo Žemėlapis | Europos Maršrutai", "description": "Tyrinėkite FlixBus ir BlaBlaCar autobusų tinklą interaktyviame žemėlapyje. Raskite visas stoteles ir maršrutus Europoje."},
        "lb": {"title": "Linia - Busnetzwierk Kaart | Europäesch Routen", "description": "Entdeckt de FlixBus a BlaBlaCar Busnetzwierk op enger interaktiver Kaart. Fannt all Arrêten a Routen an Europa."},
        "mk": {"title": "Linia - Карта на Автобуска Мрежа | Европски Рути", "description": "Истражете ја мрежата на автобуси FlixBus и BlaBlaCar на интерактивна карта. Најдете ги сите постојки и рути во Европа."},
        "ro": {"title": "Linia - Harta Rețelei de Autobuze | Rute Europene", "description": "Explorați rețeaua de autobuze FlixBus și BlaBlaCar pe o hartă interactivă. Găsiți toate stațiile și rutele disponibile în Europa."},
        "cs": {"title": "Linia - Mapa Autobusové Sítě | Evropské Trasy", "description": "Prozkoumejte autobusovou síť FlixBus a BlaBlaCar na interaktivní mapě. Najděte všechny zastávky a trasy v Evropě."},
        "sk": {"title": "Linia - Mapa Autobusovej Siete | Európske Trasy", "description": "Preskúmajte autobusovú sieť FlixBus a BlaBlaCar na interaktívnej mape. Nájdite všetky zastávky a trasy v Európe."},
        "sl": {"title": "Linia - Zemljevid Avtobusnega Omrežja | Evropske Poti", "description": "Raziščite omrežje avtobusov FlixBus in BlaBlaCar na interaktivnem zemljevidu. Poiščite vsa postajališča in poti v Evropi."},
        "sv": {"title": "Linia - Bussnätskarta | Europeiska Rutter", "description": "Utforska bussnätet för FlixBus och BlaBlaCar på en interaktiv karta. Hitta alla hållplatser och rutter i Europa."},
        "tr": {"title": "Linia - Otobüs Ağı Haritası | Avrupa Rotaları", "description": "FlixBus ve BlaBlaCar otobüs ağını interaktif haritada keşfedin. Avrupa'daki tüm durakları ve rotaları bulun."},
        "uk": {"title": "Linia - Карта Автобусної Мережі | Європейські Маршрути", "description": "Досліджуйте мережу автобусів FlixBus і BlaBlaCar на інтерактивній карті. Знайдіть усі зупинки та маршрути в Європі."},
        "ru": {"title": "Linia - Карта Автобусной Сети | Европейские Маршруты", "description": "Изучите сеть автобусов FlixBus и BlaBlaCar на интерактивной карте. Найдите все остановки и маршруты в Европе."},
        "be": {"title": "Linia - Карта Аўтобуснай Сеткі | Еўрапейскія Маршруты", "description": "Даследуйце сетку аўтобусаў FlixBus і BlaBlaCar на інтэрактыўнай карце. Знайдзіце ўсе прыпынкі і маршруты ў Еўропе."},
    },
    "planner": {
        "fr": {"title": "Linia - Créateur d'Itinéraire Bus | Comparateur", "description": "Créez votre itinéraire bus étape par étape. Sélectionnez vos villes et découvrez les connexions directes FlixBus et BlaBlaCar."},
        "en": {"title": "Linia - Bus Itinerary Builder | Route Planner", "description": "Build your bus itinerary step by step. Choose cities, see direct FlixBus and BlaBlaCar connections and export your route."},
        "de": {"title": "Linia - Busreiseplaner | Route Erstellen", "description": "Erstellen Sie Ihren Busreiseplan Schritt für Schritt. Wählen Sie Städte und entdecken Sie direkte Verbindungen mit FlixBus und BlaBlaCar."},
        "es": {"title": "Linia - Creador de Itinerarios de Autobús | Planificador", "description": "Construye tu itinerario de autobús paso a paso. Elige ciudades, ve conexiones directas de FlixBus y BlaBlaCar y exporta tu ruta."},
        "it": {"title": "Linia - Creatore di Itinerari Autobus | Pianificatore", "description": "Costruisci il tuo itinerario in autobus passo dopo passo. Scegli le città, vedi le connessioni dirette e crea il tuo viaggio."},
        "nl": {"title": "Linia - Busreisplanner | Route Samenstellen", "description": "Bouw je busreis stap voor stap. Kies steden, bekijk directe FlixBus- en BlaBlaCar-verbindingen en exporteer je route."},
        "pt": {"title": "Linia - Criador de Itinerários de Autocarro | Planeador", "description": "Construa o seu itinerário de autocarro passo a passo. Escolha cidades, veja ligações diretas da FlixBus e BlaBlaCar."},
        "pl": {"title": "Linia - Kreator Planu Podróży | Planer Autobusowy", "description": "Zbuduj swój plan podróży autobusem krok po kroku. Wybierz miasta, sprawdź bezpośrednie połączenia FlixBus i BlaBlaCar."},
        "sq": {"title": "Linia - Krijuesi i Itinerarit të Autobusit | Planifikues", "description": "Ndërtoni itinerarin tuaj të autobusit hap pas hapi. Zgjidhni qytetet, shihni lidhjet direkte dhe eksportoni rrugën tuaj."},
        "ca": {"title": "Linia - Creador d'Itineraris d'Autobús | Planificador", "description": "Construeix el teu itinerari d'autobús pas a pas. Tria ciutats, veuràs connexions directes i podràs exportar la teva ruta."},
        "hr": {"title": "Linia - Kreator Plana Puta Autobusom | Planer", "description": "Izradite svoj plan puta autobusom korak po korak. Odaberite gradove, pogledajte izravne veze FlixBusa i BlaBlaCara."},
        "bg": {"title": "Linia - Създател на Автобусни Маршрути | Планировчик", "description": "Изградете своя автобусен маршрут стъпка по стъпка. Изберете градове и вижте директните връзки."},
        "da": {"title": "Linia - Busrejseplanlægger | Rutebygger", "description": "Byg din busrejse trin for trin. Vælg byer, se direkte forbindelser med FlixBus og BlaBlaCar og eksporter din rute."},
        "et": {"title": "Linia - Bussireisi Planeerija | Marsruudi Koostaja", "description": "Koosta oma bussireis samm-sammult. Vali linnad, vaata otseseid ühendusi ja loo oma marsruut."},
        "fi": {"title": "Linia - Bussimatkan Suunnittelija | Reittiopas", "description": "Rakenna bussimatkasi vaihe vaiheelta. Valitse kaupungit, katso suorat yhteydet ja vie reittisi."},
        "el": {"title": "Linia - Δημιουργός Διαδρομών Λεωφορείων | Σχεδιαστής", "description": "Δημιουργήστε το δρομολόγιο του λεωφορείου σας βήμα προς βήμα. Επιλέξτε πόλεις και δείτε απευθείας συνδέσεις."},
        "hu": {"title": "Linia - Buszos Útvonaltervező | Utazásszervező", "description": "Építse fel buszos útitervét lépésről lépésre. Válasszon városokat, és tekintse meg a közvetlen FlixBus és BlaBlaCar csatlakozásokat."},
        "hi": {"title": "Linia - बस यात्रा कार्यक्रम निर्माता | रूट प्लानर", "description": "चरण-दर-चरण अपनी बस यात्रा कार्यक्रम बनाएं। शहर चुनें, सीधे FlixBus और BlaBlaCar कनेक्शन देखें।"},
        "lv": {"title": "Linia - Autobusu Maršrutu Veidotājs | Plānotājs", "description": "Veidojiet savu autobusa maršrutu soli pa solim. Izvēlieties pilsētas un skatiet tiešos savienojumus."},
        "lt": {"title": "Linia - Autobusų Maršrutų Kūrėjas | Planuoklis", "description": "Kurkite savo autobuso maršrutą žingsnis po žingsnio. Pasirinkite miestus ir matykite tiesioginius ryšius."},
        "lb": {"title": "Linia - Busrees Planner | Rees Creator", "description": "Baut Är Busrees Schrëtt fir Schrëtt. Wielt Stied, kuckt direkt Verbindungen an exportéiert Är Route."},
        "mk": {"title": "Linia - Креатор на Автобуски Итинерар | Планер", "description": "Изградете го вашиот план за патување со автобус чекор по чекор. Изберете градове и видете директни врски."},
        "ro": {"title": "Linia - Creator de Itinerarii Autobuz | Planificator", "description": "Construiți-vă itinerariul de autobuz pas cu pas. Alegeți orașe, vedeți conexiunile directe și exportați ruta."},
        "cs": {"title": "Linia - Tvůrce Autobusových Itinerářů | Plánovač", "description": "Sestavte si svůj autobusový itinerář krok za krokem. Vyberte města, podívejte se na přímá spojení a exportujte trasu."},
        "sk": {"title": "Linia - Tvorca Autobusových Itinerárov | Plánovač", "description": "Zostavte si svoj autobusový itinerár krok za krokom. Vyberte mestá, pozrite si priame spojenia a exportujte trasu."},
        "sl": {"title": "Linia - Ustvarjalec Avtobusnih Poti | Načrtovalec", "description": "Sestavite svoj načrt poti z avtobusom korak za korakom. Izberite mesta in si oglejte neposredne povezave."},
        "sv": {"title": "Linia - Bussreseplanerare | Ruttbyggare", "description": "Bygg din bussresa steg för steg. Välj städer, se direkta FlixBus- och BlaBlaCar-förbindelser och exportera din rutt."},
        "tr": {"title": "Linia - Otobüs Güzergah Oluşturucu | Planlayıcı", "description": "Otobüs güzergahınızı adım adım oluşturun. Şehirleri seçin, doğrudan bağlantıları görün ve rotanızı dışa aktarın."},
        "uk": {"title": "Linia - Конструктор Маршрутів | Планувальник", "description": "Створіть свій автобусний маршрут крок за кроком. Обирайте міста, дивіться прямі сполучення та експортуйте маршрут."},
        "ru": {"title": "Linia - Конструктор Маршрутов | Планировщик", "description": "Постройте свой автобусный маршрут шаг за шагом. Выбирайте города, смотрите прямые рейсы и экспортируйте маршрут."},
        "be": {"title": "Linia - Канструктар Маршрутаў | Планіроўшчык", "description": "Стварыце свой аўтобусны маршрут крок за крокам. Выбірайце гарады, глядзіце прамыя злучэнні і экспартуйце маршрут."},
    },
    "about": {
        "fr": {"title": "À Propos de Linia | Données Bus Europe", "description": "Découvrez le projet Linia, un outil open-data pour visualiser les réseaux de transport longue distance en Europe."},
        "en": {"title": "About Linia | European Bus Data Project", "description": "Learn about the Linia project, an open-data tool to visualize long-distance transport networks across Europe."},
        "de": {"title": "Über Linia | Busdaten Projekt Europa", "description": "Erfahren Sie mehr über das Projekt Linia, ein Open-Data-Tool zur Visualisierung von Fernverkehrsnetzen in Europa."},
        "es": {"title": "Sobre Linia | Proyecto de Datos de Autobús", "description": "Conoce el proyecto Linia, una herramienta de datos abiertos para visualizar redes de transporte de larga distancia en Europa."},
        "it": {"title": "Informazioni su Linia | Dati Autobus Europa", "description": "Scopri il progetto Linia, uno strumento open-data per visualizzare le reti di trasporto a lunga percorrenza in Europa."},
        "nl": {"title": "Over Linia | Europees Bus Data Project", "description": "Leer meer over het Linia-project, een open-data tool om langeafstandstransportnetwerken in Europa te visualiseren."},
        "pt": {"title": "Sobre a Linia | Dados de Autocarro Europa", "description": "Saiba mais sobre o projeto Linia, uma ferramenta de dados abertos para visualizar redes de transporte de longa distância."},
        "pl": {"title": "O Linia | Dane Autobusowe Europa", "description": "Poznaj projekt Linia, narzędzie open-data do wizualizacji sieci transportu dalekobieżnego w Europie."},
        "sq": {"title": "Rreth Linia | Të dhënat e Autobusëve Evropë", "description": "Mësoni rreth projektit Linia, një mjet me të dhëna të hapura për vizualizimin e rrjeteve të transportit."},
        "ca": {"title": "Sobre Linia | Projecte de Dades d'Autobús", "description": "Coneix el projecte Linia, una eina de dades obertes per visualitzar xarxes de transport de llarga distància a Europa."},
        "hr": {"title": "O Linia | Podaci o Autobusima Europa", "description": "Saznajte više o projektu Linia, alatu otvorenih podataka za vizualizaciju mreža dugolinijskog prijevoza."},
        "bg": {"title": "За Linia | Данни за Автобуси Европа", "description": "Научете за проекта Linia, инструмент с отворени данни за визуализация на транспортни мрежи в Европа."},
        "da": {"title": "Om Linia | Europæisk Busdata Projekt", "description": "Lær om Linia-projektet, et open data-værktøj til visualisering af langdistancetransportnetværk i Europa."},
        "et": {"title": "Linia Kohta | Euroopa Bussiandmed", "description": "Lisateave Linia projekti kohta, mis on avatud andmete tööriist pikamaatranspordivõrkude visualiseerimiseks."},
        "fi": {"title": "Tietoa Liniasta | Euroopan Bussidata", "description": "Lue lisää Linia-projektista, avoimen datan työkalusta kaukoliikenneverkkojen visualisointiin Euroopassa."},
        "el": {"title": "Σχετικά με το Linia | Δεδομένα Λεωφορείων", "description": "Μάθετε για το έργο Linia, ένα εργαλείο ανοιχτών δεδομένων για την οπτικοποίηση δικτύων μεταφορών μεγάλων αποστάσεων."},
        "hu": {"title": "A Linia-ról | Európai Buszadatok", "description": "Ismerje meg a Linia projektet, egy nyílt adatforrású eszközt az európai távolsági közlekedési hálózatok vizualizálására."},
        "hi": {"title": "Linia के बारे में | यूरोपीय बस डेटा", "description": "Linia प्रोजेक्ट के बारे में जानें, जो यूरोप में लंबी दूरी के परिवहन नेटवर्क की कल्पना करने के लिए एक ओपन-डेटा टूल है।"},
        "lv": {"title": "Par Linia | Eiropas Autobusu Dati", "description": "Uzziniet par Linia projektu, atvērto datu rīku tālsatiksmes transporta tīklu vizualizēšanai Eiropā."},
        "lt": {"title": "Apie Linia | Europos Autobusų Duomenys", "description": "Sužinokite apie Linia projektą, atvirų duomenų įrankį tolimojo susisiekimo tinklams vizualizuoti."},
        "lb": {"title": "Iwwer Linia | Busdaten Projet Europa", "description": "Léiert méi iwwer de Projet Linia, en Open-Data-Tool fir d'Visualiséierung vu laangstrecke Transportnetzer."},
        "mk": {"title": "За Linia | Податоци за Автобуси Европа", "description": "Дознајте за проектот Linia, алатка со отворени податоци за визуелизација на мрежи за транспорт на долги релации."},
        "ro": {"title": "Despre Linia | Date Autobuz Europa", "description": "Aflați despre proiectul Linia, un instrument open-data pentru vizualizarea rețelelor de transport pe distanțe lungi."},
        "cs": {"title": "O Linii | Data o Autobusech Evropa", "description": "Zjistěte více o projektu Linia, nástroji s otevřenými daty pro vizualizaci dálkových dopravních sítí v Evropě."},
        "sk": {"title": "O Linii | Údaje o Autobusoch Európa", "description": "Zistite viac o projekte Linia, nástroji s otvorenými údajmi na vizualizáciu diaľkových dopravných sietí."},
        "sl": {"title": "O Linii | Podatki o Avtobusih Evropa", "description": "Spoznajte projekt Linia, orodje odprtih podatkov za vizualizacijo omrežij dolgega prometa v Evropi."},
        "sv": {"title": "Om Linia | Europeiska Bussdata", "description": "Läs om Linia-projektet, ett verktyg med öppna data för att visualisera långdistansnätverk i Europa."},
        "tr": {"title": "Linia Hakkında | Avrupa Otobüs Verileri", "description": "Avrupa'daki uzun mesafe ulaşım ağlarını görselleştirmek için açık veri aracı olan Linia projesi hakkında bilgi edinin."},
        "uk": {"title": "Про Linia | Дані про Автобуси Європа", "description": "Дізнайтеся про проект Linia, інструмент відкритих даних для візуалізації мереж далекого сполучення в Європі."},
        "ru": {"title": "О Linia | Данные об Автобусах Европа", "description": "Узнайте о проекте Linia, инструменте открытых данных для визуализации сетей дальнего транспорта в Европе."},
        "be": {"title": "Пра Linia | Дадзеныя пра Аўтобусы Еўропа", "description": "Даведайцеся пра праект Linia, інструмент адкрытых дадзеных для візуалізацыі сетак далёкага транспарту ў Еўропе."},
    },
    "legal": {
        "fr": {"title": "Mentions Légales - Linia", "description": "Informations légales, éditeur, hébergement et conditions d'utilisation des données GTFS sur Linia."},
        "en": {"title": "Legal Notice - Linia", "description": "Legal information, publisher, hosting, and terms of use for GTFS data on Linia."},
        "de": {"title": "Impressum - Linia", "description": "Rechtliche Informationen, Herausgeber, Hosting und Nutzungsbedingungen für GTFS-Daten auf Linia."},
        "es": {"title": "Aviso Legal - Linia", "description": "Información legal, editor, alojamiento y condiciones de uso de los datos GTFS en Linia."},
        "it": {"title": "Note Legali - Linia", "description": "Informazioni legali, editore, hosting e condizioni d'uso dei dati GTFS su Linia."},
        "nl": {"title": "Juridische Informatie - Linia", "description": "Juridische informatie, uitgever, hosting en gebruiksvoorwaarden voor GTFS-gegevens op Linia."},
        "pt": {"title": "Aviso Legal - Linia", "description": "Informações legais, editor, alojamento e termos de uso dos dados GTFS na Linia."},
        "pl": {"title": "Informacje Prawne - Linia", "description": "Informacje prawne, wydawca, hosting i warunki korzystania z danych GTFS w serwisie Linia."},
        "sq": {"title": "Njoftim Ligjor - Linia", "description": "Informacion ligjor, botuesi, pritja dhe kushtet e përdorimit për të dhënat GTFS në Linia."},
        "ca": {"title": "Avís Legal - Linia", "description": "Informació legal, editor, allotjament i condicions d'ús de les dades GTFS a Linia."},
        "hr": {"title": "Pravna Obavijest - Linia", "description": "Pravne informacije, izdavač, hosting i uvjeti korištenja GTFS podataka na Linia."},
        "bg": {"title": "Правна Информация - Linia", "description": "Правна информация, издател, хостинг и условия за ползване на GTFS данни в Linia."},
        "da": {"title": "Juridisk Meddelelse - Linia", "description": "Juridiske oplysninger, udgiver, hosting og vilkår for brug af GTFS-data på Linia."},
        "et": {"title": "Õigusalane Teave - Linia", "description": "Õiguslik teave, väljaandja, majutus ja GTFS-andmete kasutustingimused Linias."},
        "fi": {"title": "Oikeudellinen Huomautus - Linia", "description": "Oikeudelliset tiedot, julkaisija, isännöinti ja GTFS-tietojen käyttöehdot Liniassa."},
        "el": {"title": "Νομική Σημείωση - Linia", "description": "Νομικές πληροφορίες, εκδότης, φιλοξενία και όροι χρήσης δεδομένων GTFS στο Linia."},
        "hu": {"title": "Jogi Nyilatkozat - Linia", "description": "Jogi információk, kiadó, tárhely és a GTFS adatok felhasználási feltételei a Linia-n."},
        "hi": {"title": "कानूनी नोटिस - Linia", "description": "कानूनी जानकारी, प्रकाशक, होस्टिंग, और Linia पर GTFS डेटा के उपयोग की शर्तें।"},
        "lv": {"title": "Juridiskais Paziņojums - Linia", "description": "Juridiskā informācija, izdevējs, hostings un GTFS datu lietošanas noteikumi vietnē Linia."},
        "lt": {"title": "Teisinė Informacija - Linia", "description": "Teisinė informacija, leidėjas, priegloba ir GTFS duomenų naudojimo sąlygos Linia."},
        "lb": {"title": "Impressum - Linia", "description": "Juristesch Informatiounen, Editeur, Hosting an Notzungsbedéngunge fir GTFS-Daten op Linia."},
        "mk": {"title": "Правна Напомена - Linia", "description": "Правни информации, издавач, хостинг и услови за користење на податоците GTFS на Linia."},
        "ro": {"title": "Notă Legală - Linia", "description": "Informații legale, editor, găzduire și termeni de utilizare a datelor GTFS pe Linia."},
        "cs": {"title": "Právní Upozornění - Linia", "description": "Právní informace, vydavatel, hosting a podmínky použití dat GTFS na Linii."},
        "sk": {"title": "Právne Oznámenie - Linia", "description": "Právne informácie, vydavateľ, hosting a podmienky používania údajov GTFS na Linii."},
        "sl": {"title": "Pravno Obvestilo - Linia", "description": "Pravne informacije, založnik, gostovanje in pogoji uporabe podatkov GTFS na Linia."},
        "sv": {"title": "Juridiskt Meddelande - Linia", "description": "Juridisk information, utgivare, hosting och användarvillkor för GTFS-data på Linia."},
        "tr": {"title": "Yasal Uyarı - Linia", "description": "Yasal bilgiler, yayıncı, barındırma ve Linia üzerindeki GTFS verilerinin kullanım koşulları."},
        "uk": {"title": "Юридичне Повідомлення - Linia", "description": "Юридична інформація, видавець, хостинг та умови використання даних GTFS на Linia."},
        "ru": {"title": "Правовая Информация - Linia", "description": "Юридическая информация, издатель, хостинг и условия использования данных GTFS на Linia."},
        "be": {"title": "Юрыдычнае Паведамленне - Linia", "description": "Юрыдычная інфармацыя, выдавец, хостынг і ўмовы выкарыстання дадзеных GTFS на Linia."},
    }
}

--- FIN FICHIER ---

--- DÉBUT FICHIER : extract.py ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\extract.py ---

import pathlib

def generer_conglomerat(dossier_racine, fichier_sortie):
    racine = pathlib.Path(dossier_racine)
    extensions_cibles = {'.js', '.html', '.css', '.py'}
    
    with open(fichier_sortie, 'w', encoding='utf-8') as f_out:
        # 1. Génération de l'architecture (Tree view)
        f_out.write("### ARCHITECTURE DU PROJET ###\n\n")
        for chemin in sorted(racine.rglob('*')):
            # On ignore les dossiers cachés (comme .git ou .venv)
            if any(part.startswith('.') for part in chemin.parts):
                continue
                
            profondeur = len(chemin.relative_to(racine).parts) - 1
            indentation = '    ' * profondeur
            symbole = '|-- ' if chemin.is_file() else '[D] '
            f_out.write(f"{indentation}{symbole}{chemin.name}\n")
        
        f_out.write("\n" + "="*50 + "\n\n")

        # 2. Extraction du contenu des fichiers
        f_out.write("### CONTENU DES FICHIERS ###\n\n")
        for chemin in racine.rglob('*'):
            # Filtres : extension autorisée, pas de dossiers cachés, et on ne s'auto-lit pas
            if (chemin.suffix in extensions_cibles and 
                not any(part.startswith('.') for part in chemin.parts) and
                chemin.name != fichier_sortie):
                
                f_out.write(f"--- DÉBUT FICHIER : {chemin.relative_to(racine)} ---\n")
                f_out.write(f"--- POSITION : {chemin.absolute()} ---\n\n")
                
                try:
                    contenu = chemin.read_text(encoding='utf-8')
                    f_out.write(contenu)
                except Exception as e:
                    f_out.write(f"[ERREUR DE LECTURE : {e}]")
                
                f_out.write("\n\n--- FIN FICHIER ---\n\n")

if __name__ == "__main__":
    # Configuration
    NOM_DOSSIER = "."  # Le dossier actuel, ou mettez le chemin complet
    SORTIE = "code_complet.txt"
    
    print(f"Extraction en cours depuis {pathlib.Path(NOM_DOSSIER).absolute()}...")
    generer_conglomerat(NOM_DOSSIER, SORTIE)
    print(f"Terminé ! Tout a été copié dans : {SORTIE}")

--- FIN FICHIER ---

--- DÉBUT FICHIER : static\i18n.js ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\static\i18n.js ---

const i18n = {
    currentLang: (function () {
        try {
            const path = window.location.pathname || '/';
            const segments = path.split('/').filter(Boolean);
            const candidate = segments.length > 0 ? segments[0].toLowerCase() : null;
            const supported = [
                'fr', 'en', 'de', 'es', 'pt', 'nl', 'sq', 'ca', 'hr', 'bg', 'da', 'et', 'fi',
                'el', 'hu', 'hi', 'lv', 'lt', 'lb', 'mk', 'ro', 'pl', 'cs', 'sk', 'sl', 'sv',
                'tr', 'uk', 'ru', 'be'
            ];
            if (candidate && supported.includes(candidate)) {
                return candidate;
            }
        } catch (e) {
            console.warn('i18n: unable to infer lang from URL', e);
        }

        const storedLang = localStorage.getItem('linia_lang');
        if (storedLang) return storedLang;

        try {
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang) {
                const shortLang = browserLang.substring(0, 2).toLowerCase();
                const supported = [
                    'fr', 'en', 'de', 'es', 'pt', 'nl', 'sq', 'ca', 'hr', 'bg', 'da', 'et', 'fi',
                    'el', 'hu', 'hi', 'lv', 'lt', 'lb', 'mk', 'ro', 'pl', 'cs', 'sk', 'sl', 'sv',
                    'tr', 'uk', 'ru', 'be'
                ];
                if (supported.includes(shortLang)) {
                    return shortLang;
                }
            }
        } catch (e) {
            console.warn('i18n: unable to infer lang from Browser', e);
        }

        return 'fr';
    })(),
    SUPPORTED_LANGS: [
        'fr', 'en', 'de', 'es', 'pt', 'nl', 'sq', 'ca', 'hr', 'bg', 'da', 'et', 'fi',
        'el', 'hu', 'hi', 'lv', 'lt', 'lb', 'mk', 'ro', 'pl', 'cs', 'sk', 'sl', 'sv',
        'tr', 'uk', 'ru', 'be'
    ],
    t(key, params = {}) {
        const dict = window.TRANSLATIONS || {};
        let text = dict[key];
        if (params.count !== undefined && typeof params.count === 'number') {
            try {
                const pluralRules = new Intl.PluralRules(this.currentLang);
                const rule = pluralRules.select(params.count);
                const pluralKey = `${key}_${rule}`;
                if (dict[pluralKey]) {
                    text = dict[pluralKey];
                } else if (rule !== 'other' && dict[`${key}_other`]) {
                    text = dict[`${key}_other`];
                }
            } catch (e) {
                console.warn('i18n pluralization error:', e);
            }
        }
        if (!text) text = dict[key] || key;
        Object.keys(params).forEach(p => {
            const regex = new RegExp(`{${p}}`, 'g');
            text = text.replace(regex, params[p]);
        });
        return text;
    },
    setLang(lang) {
        if (!this.SUPPORTED_LANGS.includes(lang)) {
            console.error('Linia i18n: Unknown language', lang);
            lang = 'fr';
        }
        const path = window.location.pathname || '/';
        const segments = path.split('/').filter(Boolean);
        const supported = [
            'fr', 'en', 'de', 'es', 'pt', 'nl', 'sq', 'ca', 'hr', 'bg', 'da', 'et', 'fi',
            'el', 'hu', 'hi', 'lv', 'lt', 'lb', 'mk', 'ro', 'pl', 'cs', 'sk', 'sl', 'sv',
            'tr', 'uk', 'ru', 'be'
        ];
        let slugParts = segments;
        if (segments.length > 0 && supported.includes(segments[0])) {
            slugParts = segments.slice(1);
        }
        const slug = slugParts.join('/');
        let newPath;
        if (lang === 'fr') {
            newPath = slug ? `/${slug}` : '/';
        } else {
            newPath = slug ? `/${lang}/${slug}` : `/${lang}/`;
        }
        localStorage.setItem('linia_lang', lang);
        if (newPath !== path) {
            window.location.pathname = newPath;
        } else {
            this.currentLang = lang;
            this.translatePage();
            document.dispatchEvent(new CustomEvent('linia-lang-changed', { detail: lang }));
        }
    },
    translatePage() {
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            el.textContent = this.t(key);
        });
        document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
            const key = el.getAttribute('data-i18n-placeholder');
            el.placeholder = this.t(key);
        });
        document.querySelectorAll('[data-i18n-title]').forEach(el => {
            const key = el.getAttribute('data-i18n-title');
            el.title = this.t(key);
        });
        document.documentElement.lang = this.currentLang;
    },
    init() {
        if (window.CURRENT_LANG && window.CURRENT_LANG !== this.currentLang) {
            this.currentLang = window.CURRENT_LANG;
            localStorage.setItem("linia_lang", window.CURRENT_LANG);
        } else if (!this.SUPPORTED_LANGS.includes(this.currentLang)) {
            this.currentLang = 'fr';
            localStorage.setItem('linia_lang', 'fr');
        }
        this.addSwitcher();
        this.translatePage();
    },
    addSwitcher() {
        document.addEventListener('click', (e) => {
            const btn = e.target.closest('.lang-switcher-btn');
            if (btn) {
                e.preventDefault();
                e.stopPropagation();
                this.toggleMenu(btn);
                return;
            }
            if (!e.target.closest('.lang-menu')) {
                this.closeMenu();
            }
        }, true);
    },
    toggleMenu(btn) {
        let menu = document.getElementById('langMenu');
        let overlay = document.getElementById('langOverlay');
        if (menu) {
            this.closeMenu();
            return;
        }
        overlay = document.createElement('div');
        overlay.id = 'langOverlay';
        overlay.className = 'lang-modal-overlay';
        overlay.onclick = () => this.closeMenu();
        document.body.appendChild(overlay);
        menu = document.createElement('div');
        menu.id = 'langMenu';
        menu.className = 'lang-menu lang-modal';
        this.SUPPORTED_LANGS.forEach(lang => {
            const option = document.createElement('button');
            option.className = `lang-option ${lang === this.currentLang ? 'active' : ''}`;
            option.innerHTML = `<span>${lang.toUpperCase()}</span>`;
            option.onclick = (e) => {
                e.stopPropagation();
                this.setLang(lang);
                this.closeMenu();
            };
            menu.appendChild(option);
        });
        document.body.appendChild(menu);
        requestAnimationFrame(() => {
            overlay.classList.add('show');
            menu.classList.add('show');
        });
    },
    closeMenu() {
        const menu = document.getElementById('langMenu');
        const overlay = document.getElementById('langOverlay');
        if (menu) menu.classList.remove('show');
        if (overlay) overlay.classList.remove('show');
        setTimeout(() => {
            if (menu) menu.remove();
            if (overlay) overlay.remove();
        }, 300);
    }
};
document.addEventListener('DOMContentLoaded', () => i18n.init());

--- FIN FICHIER ---

--- DÉBUT FICHIER : static\map.js ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\static\map.js ---

document.addEventListener('DOMContentLoaded', function () {
    const map = L.map('map', {
        center: [50.0516, 14.2514],
        zoom: 4.5,
        zoomControl: false,
        attributionControl: true
    });
    L.control.zoom({ position: 'topleft' }).addTo(map);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        subdomains: 'abcd',
        maxZoom: 20,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
    }).addTo(map);
    let currentStopMarker = null;
    let stopMarkers = [];
    let hasRouteData = false;
    let cachedRoutes = [];
    let cachedStopInfo = null;
    let activeOperatorFilter = 'all';
    let activeSearchQuery = '';
    const searchInput = document.getElementById('mapSearchInput');
    const suggestionsDiv = document.getElementById('mapSuggestions');
    const searchSpinner = document.getElementById('mapSearchSpinner');
    const searchIcon = document.getElementById('mapSearchIcon');
    const routePanel = document.getElementById('routePanel');
    const routePanelBody = document.getElementById('routePanelBody');
    const routePanelTitle = document.getElementById('routePanelTitle');
    const routePanelClose = document.getElementById('routePanelClose');
    const operatorLegend = document.getElementById('operatorLegend');
    const routeLocalSearch = document.getElementById('routeLocalSearch');
    const filterPills = document.querySelectorAll('.filter-pill');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const loadingText = document.getElementById('loadingText');
    const toastContainer = document.getElementById('toastContainer');
    const reopenPanelBtn = document.getElementById('reopenPanelBtn');
    const tripDetailsPanel = document.getElementById('tripDetailsPanel');
    const tripPanelBody = document.getElementById('tripPanelBody');
    const tripPanelTitle = document.getElementById('tripPanelTitle');
    const tripPanelSubtitle = document.getElementById('tripPanelSubtitle');
    const tripPanelClose = document.getElementById('tripPanelClose');
    function showToast(message, type = 'info', duration = 3500) {
        if (!toastContainer) return;
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.textContent = message;
        toastContainer.appendChild(toast);
        requestAnimationFrame(() => toast.classList.add('show'));
        setTimeout(() => {
            toast.classList.remove('show');
            toast.addEventListener('transitionend', () => {
                if (toast.parentNode) toast.parentNode.removeChild(toast);
            }, { once: true });
        }, duration);
    }
    function showLoading(msg) {
        if (loadingText) loadingText.textContent = msg || 'Chargement...';
        if (loadingOverlay) loadingOverlay.classList.add('visible');
    }
    function hideLoading() {
        if (loadingOverlay) loadingOverlay.classList.remove('visible');
    }
    function openRoutePanel() {
        routePanel.classList.add('visible');
        reopenPanelBtn.style.display = 'none';
    }
    function closeRoutePanel() {
        routePanel.classList.remove('visible');
        if (hasRouteData) {
            reopenPanelBtn.style.display = 'flex';
        }
    }
    routePanelClose.addEventListener('click', closeRoutePanel);
    reopenPanelBtn.addEventListener('click', openRoutePanel);
    filterPills.forEach(pill => {
        pill.addEventListener('click', () => {
            filterPills.forEach(p => p.classList.remove('active'));
            pill.classList.add('active');
            activeOperatorFilter = pill.dataset.filter;
            renderFilteredRoutes();
        });
    });
    routeLocalSearch.addEventListener('input', (e) => {
        activeSearchQuery = e.target.value.toLowerCase().trim();
        renderFilteredRoutes();
    });
    function openTripPanel() {
        tripDetailsPanel.classList.add('visible');
    }
    function closeTripPanel() {
        tripDetailsPanel.classList.remove('visible');
    }
    tripPanelClose.addEventListener('click', closeTripPanel);
    let searchTimeout = null;
    searchInput.addEventListener('input', function () {
        const query = this.value.trim();
        clearTimeout(searchTimeout);
        if (query.length < 2) {
            suggestionsDiv.innerHTML = '';
            suggestionsDiv.classList.remove('visible');
            return;
        }
        searchTimeout = setTimeout(() => fetchSuggestions(query), 300);
    });
    document.addEventListener('click', function (e) {
        if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
            suggestionsDiv.classList.remove('visible');
        }
    });
    searchInput.addEventListener('focus', function () {
        if (suggestionsDiv.children.length > 0 && searchInput.value.trim().length >= 2) {
            suggestionsDiv.classList.add('visible');
        }
    });
    async function fetchSuggestions(query) {
        searchSpinner.style.display = 'inline-block';
        searchIcon.style.display = 'none';
        try {
            const response = await fetch(`/api/search_stops?query=${encodeURIComponent(query)}`);
            const data = await response.json();
            if (response.ok) {
                renderSuggestions(data);
            } else {
                showToast(i18n.t('err_search'), 'error');
            }
        } catch (err) {
            showToast(i18n.t('err_connection'), 'error');
        } finally {
            searchSpinner.style.display = 'none';
            searchIcon.style.display = '';
        }
    }
    function renderSuggestions(suggestions) {
        suggestionsDiv.innerHTML = '';
        if (suggestions.length === 0) {
            suggestionsDiv.innerHTML = `<div class="suggestion-empty" style="padding:12px;text-align:center;color:#9aa0a6;font-size:13px;">${i18n.t('no_stop_found')}</div>`;
            suggestionsDiv.classList.add('visible');
            setTimeout(() => {
                if (suggestionsDiv.querySelector('.suggestion-empty')) {
                    suggestionsDiv.classList.remove('visible');
                }
            }, 2000);
            return;
        }
        suggestions.forEach(stop => {
            const item = document.createElement('div');
            item.className = 'suggestion-item';
            item.textContent = stop.stop_name;
            item.addEventListener('click', function () {
                searchInput.value = stop.stop_name;
                suggestionsDiv.innerHTML = '';
                suggestionsDiv.classList.remove('visible');
                handleStopSelect(stop.stop_id, stop.stop_name);
            });
            suggestionsDiv.appendChild(item);
        });
        suggestionsDiv.classList.add('visible');
    }
    let tripLinePolyline = null;
    let highlightPolyline = null;
    function clearTripLayers() {
        if (tripLinePolyline) {
            map.removeLayer(tripLinePolyline);
            tripLinePolyline = null;
        }
        stopMarkers.forEach(m => map.removeLayer(m));
        stopMarkers = [];
        closeTripPanel();
        tripPanelBody.innerHTML = '';
    }
    function clearCurrentStopMarker() {
        if (currentStopMarker) {
            map.removeLayer(currentStopMarker);
            currentStopMarker = null;
        }
    }
    async function handleStopSelect(stopId, stopName) {
        if (!stopId) { showToast('ID arrêt manquant.', 'warning'); return; }
        clearPreviousData();
        showLoading("Chargement de l'arrêt...");
        const url = new URL(window.location);
        url.searchParams.set('stop_id', stopId);
        if (stopName) url.searchParams.set('stop_name', stopName);
        window.history.replaceState({}, '', url);
        try {
            const response = await fetch(`/api/stop_info/${encodeURIComponent(stopId)}`);
            const data = await response.json();
            if (response.ok) {
                updateMapForStop(data.stop_info);
                cachedRoutes = data.routes || [];
                cachedStopInfo = data.stop_info;
                renderFilteredRoutes();
            } else {
                showToast(data.error || "Arrêt non trouvé.", 'error');
            }
        } catch (err) {
            showToast('Erreur de connexion.', 'error');
        } finally {
            hideLoading();
        }
    }
    function clearPreviousData() {
        routePanelBody.innerHTML = '';
        closeRoutePanel();
        hasRouteData = false;
        reopenPanelBtn.style.display = 'none';
        operatorLegend.style.display = 'none';
        clearTripLayers();
        clearCurrentStopMarker();
        cachedRoutes = [];
        routeLocalSearch.value = '';
        activeSearchQuery = '';
        activeOperatorFilter = 'all';
        filterPills.forEach((p, i) => i === 0 ? p.classList.add('active') : p.classList.remove('active'));
    }
    function updateMapForStop(stopData) {
        if (!stopData) return;
        clearCurrentStopMarker();
        const el = document.createElement('div');
        el.className = 'planner-map-marker';
        const icon = L.divIcon({
            html: el,
            className: '',
            iconSize: [28, 28],
            iconAnchor: [14, 14]
        });
        currentStopMarker = L.marker([stopData.stop_lat, stopData.stop_lon], { icon: icon })
            .bindPopup(stopData.stop_name)
            .addTo(map);
        currentStopMarker.openPopup();
        map.flyTo([stopData.stop_lat, stopData.stop_lon], 12, { duration: 1.25 });
    }
    function renderFilteredRoutes() {
        if (!cachedRoutes || cachedRoutes.length === 0) {
            routePanelBody.innerHTML = '<div class="route-empty-msg">Aucune ligne ne dessert cet arrêt.</div>';
            routePanelTitle.textContent = `Lignes — ${cachedStopInfo ? cachedStopInfo.stop_name : ''}`;
            operatorLegend.style.display = 'none';
            hasRouteData = false;
            openRoutePanel();
            return;
        }
        const stopName = cachedStopInfo ? cachedStopInfo.stop_name : i18n.t('this_stop');
        routePanelTitle.innerHTML = i18n.t('lines_from_stop_html', { stopName: stopName });
        operatorLegend.style.display = 'flex';
        hasRouteData = true;
        let filtered = cachedRoutes.filter(route => {
            const matchesOperator = activeOperatorFilter === 'all' || route.operator === activeOperatorFilter;
            const name = (route.display_name || '').toLowerCase();
            const matchesSearch = name.includes(activeSearchQuery);
            return matchesOperator && matchesSearch;
        }).sort((a, b) => {
            if (a.operator === 'flixbus' && b.operator !== 'flixbus') return -1;
            if (a.operator !== 'flixbus' && b.operator === 'flixbus') return 1;
            return 0;
        });
        if (filtered.length === 0) {
            routePanelBody.innerHTML = `<div class="route-empty-msg">${i18n.t('no_search_result')}</div>`;
            return;
        }
        let html = '<ul class="route-list">';
        filtered.forEach(route => {
            const opClass = route.operator
                ? `route-item--${route.operator.toLowerCase().replace(/_/g, '-')}`
                : 'route-item--unknown';
            const name = route.display_name || i18n.t('unnamed_line');
            html += `<li class="route-item ${opClass}" data-trip-id="${route.trip_id}">
                        <strong>${name}</strong>
                     </li>`;
        });
        html += '</ul>';
        routePanelBody.innerHTML = html;
        openRoutePanel();
        routePanelBody.querySelectorAll('.route-item').forEach(item => {
            item.addEventListener('click', handleRouteClick);
        });
    }
    async function highlightRouteOnMap(tripId) {
        try {
            const response = await fetch(`/api/trip_details/${encodeURIComponent(tripId)}`);
            const tripData = await response.json();
            if (!response.ok) return;
            let lineColor = tripData.operator === 'flixbus' ? '#73d700' : '#0070d2';
            let latlngs = [];
            if (tripData.stops && tripData.stops.length >= 2) {
                const geometry = await getRoadGeometry(tripData.stops);
                if (geometry && geometry.coordinates) {
                    latlngs = geometry.coordinates.map(c => [c[1], c[0]]);
                }
            }
            if (latlngs.length === 0 && tripData.shape_points && tripData.shape_points.length > 0) {
                latlngs = tripData.shape_points.map(p => [p[0], p[1]]);
            }
            if (latlngs.length === 0 && tripData.stops && tripData.stops.length >= 2) {
                latlngs = tripData.stops.map(s => [s.stop_lat, s.stop_lon]);
            }
            if (latlngs.length > 0) {
                clearHighlightLayer();
                highlightPolyline = L.polyline(latlngs, {
                    color: lineColor,
                    weight: 6,
                    opacity: 0.3,
                    lineJoin: 'round',
                    lineCap: 'round'
                }).addTo(map);
            }
        } catch (e) {
            console.error('Hover highlight error:', e);
        }
    }
    function clearHighlightLayer() {
        if (highlightPolyline) {
            map.removeLayer(highlightPolyline);
            highlightPolyline = null;
        }
    }
    function populateTripPanel(tripData) {
        const opName = tripData.operator === 'flixbus' ? 'Flixbus' :
            tripData.operator === 'blablacar_bus' ? 'BlaBlaCar Bus' : i18n.t('unknown_operator');
        const routeName = tripData.display_name || tripData.route_long_name || tripData.trip_headsign || '';
        tripPanelTitle.textContent = i18n.t('trip_proposed_by', { operatorName: opName });
        tripPanelSubtitle.textContent = routeName;
        if (!tripData.stops || tripData.stops.length === 0) {
            tripPanelBody.innerHTML = `<div style="color:var(--text-muted);text-align:center;">${i18n.t('no_stop_available')}</div>`;
            return;
        }
        const params = new URLSearchParams(window.location.search);
        const currentStopId = params.get('stop_id');
        let html = '<ul class="timeline-list">';
        tripData.stops.forEach((stop, index) => {
            const isActive = currentStopId && (String(stop.stop_id) === String(currentStopId));
            let activeClass = '';
            if (isActive) {
                const isFlix = tripData.operator === 'flixbus';
                activeClass = isFlix ? 'active-flix' : 'active-blabla';
            }
            html += `<li class="timeline-item ${activeClass}" data-stop-id="${stop.stop_id || ''}" data-stop-name="${stop.stop_name}" style="cursor:pointer;">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <span class="timeline-city-name">${stop.stop_name}</span>
                        </div>
                     </li>`;
        });
        html += '</ul>';
        tripPanelBody.innerHTML = html;
        openTripPanel();
        const items = tripPanelBody.querySelectorAll('.timeline-item');
        items.forEach(item => {
            item.addEventListener('click', (e) => {
                const sId = item.dataset.stopId;
                const sName = item.dataset.stopName;
                if (sId) {
                    handleStopSelect(sId, sName);
                }
            });
            item.addEventListener('mouseenter', () => {
                item.style.backgroundColor = 'var(--bg-hover)';
                const sId = item.dataset.stopId;
                if (!sId) return;
                const markerEl = document.querySelector(`.linia-map-marker[data-stop-id="${sId}"]`);
                if (markerEl) markerEl.classList.add('hovered');
            });
            item.addEventListener('mouseleave', () => {
                item.style.backgroundColor = '';
                const sId = item.dataset.stopId;
                if (!sId) return;
                const markerEl = document.querySelector(`.linia-map-marker[data-stop-id="${sId}"]`);
                if (markerEl) markerEl.classList.remove('hovered');
            });
        });
    }
    async function getRoadGeometry(stops) {
        if (!stops || stops.length < 2) return null;
        const coords = stops.map(s => `${s.stop_lon},${s.stop_lat}`).join(';');
        const url = `https://router.project-osrm.org/route/v1/driving/${coords}?geometries=geojson&overview=full`;
        try {
            const response = await fetch(url);
            const data = await response.json();
            if (data.code === 'Ok' && data.routes && data.routes.length > 0) {
                return data.routes[0].geometry;
            }
        } catch (e) {
            console.error('OSRM Routing API error:', e);
        }
        return null;
    }
    async function handleRouteClick(event) {
        const tripId = event.currentTarget.dataset.tripId;
        if (!tripId) { showToast('ID trajet manquant.', 'error'); return; }
        showLoading('Chargement du trajet...');
        clearTripLayers();
        closeRoutePanel();
        try {
            const response = await fetch(`/api/trip_details/${encodeURIComponent(tripId)}`);
            const tripData = await response.json();
            if (!response.ok) {
                showToast(tripData.error || 'Erreur inconnue.', 'error');
                return;
            }
            populateTripPanel(tripData);
            let lineColor = tripData.operator === 'flixbus' ? '#73d700' : '#0070d2';
            let latlngs = [];
            const routeMarkersBounds = L.latLngBounds();
            if (tripData.stops && tripData.stops.length > 0) {
                tripData.stops.forEach(stop => {
                    const el = document.createElement('div');
                    el.className = 'linia-map-marker';
                    if (tripData.operator === 'flixbus') el.classList.add('op-flixbus');
                    else if (tripData.operator === 'blablacar_bus') el.classList.add('op-blablacar-bus');
                    el.dataset.stopId = stop.stop_id;
                    const icon = L.divIcon({
                        html: el,
                        className: '',
                        iconSize: [14, 14],
                        iconAnchor: [7, 7]
                    });
                    const marker = L.marker([stop.stop_lat, stop.stop_lon], { icon: icon })
                        .bindPopup(stop.stop_name)
                        .addTo(map);
                    stopMarkers.push(marker);
                    routeMarkersBounds.extend([stop.stop_lat, stop.stop_lon]);
                });
            }
            if (currentStopMarker) {
                routeMarkersBounds.extend(currentStopMarker.getLatLng());
            }
            if (tripData.stops && tripData.stops.length >= 2) {
                showLoading('Calcul de l\'itinéraire par la route...');
                const geometry = await getRoadGeometry(tripData.stops);
                if (geometry && geometry.coordinates) {
                    latlngs = geometry.coordinates.map(c => [c[1], c[0]]);
                }
            }
            if (latlngs.length === 0 && tripData.shape_points && tripData.shape_points.length > 0) {
                latlngs = tripData.shape_points.map(p => [p[0], p[1]]);
            }
            if (latlngs.length === 0 && tripData.stops && tripData.stops.length >= 2) {
                latlngs = tripData.stops.map(s => [s.stop_lat, s.stop_lon]);
            }
            if (latlngs.length > 0) {
                tripLinePolyline = L.polyline(latlngs, {
                    color: lineColor,
                    weight: 5,
                    opacity: 0.8,
                    lineJoin: 'round',
                    lineCap: 'round'
                }).addTo(map);
                tripLinePolyline.on('click', () => openTripPanel());
                tripLinePolyline.on('mouseover', (e) => {
                    e.target.setStyle({ weight: 7 });
                    L.DomUtil.addClass(map.getContainer(), 'pointer-cursor');
                });
                tripLinePolyline.on('mouseout', (e) => {
                    e.target.setStyle({ weight: 5 });
                    L.DomUtil.removeClass(map.getContainer(), 'pointer-cursor');
                });
                latlngs.forEach(ll => routeMarkersBounds.extend(ll));
            }
            if (routeMarkersBounds.isValid()) {
                map.fitBounds(routeMarkersBounds, { padding: [40, 40], duration: 1 });
            }
        } catch (err) {
            console.error('Route interaction error:', err);
            showToast('Erreur lors du chargement du trajet.', 'error');
        } finally {
            hideLoading();
        }
    }
    async function drawPreloadedRoute(startId, endId, nameA, nameB) {
        showLoading("Chargement du trajet...");
        try {
            const [resA, resB] = await Promise.all([
                fetch(`/api/stop_info/${encodeURIComponent(startId)}`),
                fetch(`/api/stop_info/${encodeURIComponent(endId)}`)
            ]);

            if (!resA.ok || !resB.ok) {
                showToast("Erreur lors du chargement des villes.", "error");
                hideLoading();
                return;
            }
            const dataA = await resA.json();
            const dataB = await resB.json();
            const stopA = dataA.stop_info;
            const stopB = dataB.stop_info;

            const bounds = L.latLngBounds();

            [stopA, stopB].forEach((stop) => {
                const el = document.createElement('div');
                el.className = 'linia-map-marker';
                const icon = L.divIcon({ html: el, className: '', iconSize: [14, 14], iconAnchor: [7, 7] });
                const marker = L.marker([stop.stop_lat, stop.stop_lon], { icon: icon }).bindPopup(stop.stop_name).addTo(map);
                stopMarkers.push(marker);
                bounds.extend([stop.stop_lat, stop.stop_lon]);
            });

            const geometry = await getRoadGeometry([stopA, stopB]);
            if (geometry && geometry.coordinates) {
                const latlngs = geometry.coordinates.map(c => [c[1], c[0]]);
                tripLinePolyline = L.polyline(latlngs, {
                    color: '#73d700',
                    weight: 6,
                    opacity: 0.8,
                    lineJoin: 'round',
                    lineCap: 'round'
                }).addTo(map);
            } else {
                tripLinePolyline = L.polyline([[stopA.stop_lat, stopA.stop_lon], [stopB.stop_lat, stopB.stop_lon]], {
                    color: '#73d700',
                    weight: 6,
                    dashArray: '5, 10',
                    opacity: 0.8
                }).addTo(map);
            }

            if (bounds.isValid()) {
                map.fitBounds(bounds, { padding: [50, 50], duration: 1.2 });
            }
        } catch (e) {
            console.error('Route interaction error:', e);
            showToast('Erreur lors du chargement du trajet.', 'error');
        } finally {
            hideLoading();
        }
    }

    const initialParams = new URLSearchParams(window.location.search);
    const stopIdParam = initialParams.get('stop_id') || window.PRELOADED_STOP_ID;
    const stopNameParam = initialParams.get('stop_name') || window.PRELOADED_STOP_NAME;

    if (window.PRELOADED_START_ID && window.PRELOADED_END_ID) {
        drawPreloadedRoute(window.PRELOADED_START_ID, window.PRELOADED_END_ID, window.CITY_A_NAME, window.CITY_B_NAME);
    } else if (stopIdParam) {
        if (stopNameParam) searchInput.value = stopNameParam;
        handleStopSelect(stopIdParam, stopNameParam || '');
    }
});

--- FIN FICHIER ---

--- DÉBUT FICHIER : static\mobile-panels.js ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\static\mobile-panels.js ---

// mobile-panels.js
function makePanelDraggable(panelId, headerId) {
    const panel = document.getElementById(panelId);
    const header = document.getElementById(headerId);

    if (!panel || !header) return;

    let startY = 0;
    let currentY = 0;
    let initialHeight = 0;
    let isDragging = false;
    let maxVH = 87; // Allow the panel to go to 87% of screen height

    const getVH = () => window.innerHeight || document.documentElement.clientHeight;
    const snapPoints = [30, 50, 87]; // Updated snap point to 87%



    header.addEventListener('touchstart', (e) => {
        if (window.innerWidth > 768) return;
        if (panel.classList.contains('drag-disabled')) return;
        if (e.target.closest('button') || e.target.tagName === 'INPUT') return;

        startY = e.touches[0].clientY;
        initialHeight = (panel.offsetHeight / getVH()) * 100;
        isDragging = true;

        panel.style.transition = 'none'; // Remove transition while dragging
    }, { passive: true });

    document.addEventListener('touchmove', (e) => {
        if (!isDragging) return;

        // Empêche le comportement par défaut du navigateur (comme le pull-to-refresh)
        if (e.cancelable) {
            e.preventDefault();
        }

        currentY = e.touches[0].clientY;
        const deltaY = startY - currentY; // positive if moving up
        const deltaVH = (deltaY / getVH()) * 100;

        let newHeight = initialHeight + deltaVH;

        if (newHeight < 20) newHeight = 20;
        if (newHeight > maxVH) newHeight = maxVH;

        panel.style.height = `${newHeight}vh`;
    }, { passive: false });

    document.addEventListener('touchend', () => {
        if (!isDragging) return;
        isDragging = false;

        panel.style.transition = 'height 0.3s cubic-bezier(0.16, 1, 0.3, 1), transform 0.4s cubic-bezier(0.16, 1, 0.3, 1)';

        const currentHeightVH = (panel.offsetHeight / getVH()) * 100;

        let closestSnap = snapPoints[0];
        let minDiff = Math.abs(currentHeightVH - snapPoints[0]);

        for (let i = 1; i < snapPoints.length; i++) {
            const diff = Math.abs(currentHeightVH - snapPoints[i]);
            if (diff < minDiff) {
                minDiff = diff;
                closestSnap = snapPoints[i];
            }
        }

        panel.style.height = `${closestSnap}vh`;
    });
}


--- FIN FICHIER ---

--- DÉBUT FICHIER : static\planner.js ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\static\planner.js ---

document.addEventListener('DOMContentLoaded', function () {
    const map = L.map('plannerMap', {
        center: [50.0, 10.0],
        zoom: 4,
        zoomControl: false,
        attributionControl: true,
        renderer: L.canvas()
    });
    L.control.zoom({ position: 'topleft' }).addTo(map);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        subdomains: 'abcd',
        maxZoom: 20,
        crossOrigin: true,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
    }).addTo(map);
    const OP_COLORS = {
        flixbus: { main: '#73d700', hover: '#5cb800', label: 'Flixbus' },
        blablacar_bus: { main: '#0070d2', hover: '#0056a3', label: 'BlaBlaCar' },
        unknown: { main: '#9aa0a6', hover: '#6b7280', label: 'Inconnu' }
    };
    let itinerary = [];
    let markers = [];
    let suggestionMarkers = [];
    let connectedCities = [];
    let connectedFilterQuery = '';
    const searchInput = document.getElementById('plannerSearchInput');
    const suggestionsDiv = document.getElementById('plannerSuggestions');
    const searchSpinner = document.getElementById('plannerSearchSpinner');
    const searchIcon = document.getElementById('plannerSearchIcon');
    const timeline = document.getElementById('plannerTimeline');
    const undoBtn = document.getElementById('undoBtn');
    const resetBtn = document.getElementById('resetBtn');
    const shareBtn = document.getElementById('shareBtn');
    const generatePdfBtn = document.getElementById('generatePdfBtn');
    const saveBtn = document.getElementById('saveBtn');
    const loadBtn = document.getElementById('loadBtn');
    const loadInput = document.getElementById('loadItineraryInput');
    const connectedPanel = document.getElementById('connectedPanel');
    const connectedBody = document.getElementById('connectedBody');
    const connectedTitle = document.getElementById('connectedTitle');
    const connectedSubtitle = document.getElementById('connectedSubtitle');
    const connectedClose = document.getElementById('connectedClose');
    const connectedSearchInput = document.getElementById('connectedSearchInput');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const loadingText = document.getElementById('loadingText');
    const toastContainer = document.getElementById('toastContainer');
    const plannerBubble = document.getElementById('plannerBubble');
    const plannerBubbleContent = document.getElementById('plannerBubbleContent');
    const plannerBubbleText = document.getElementById('plannerBubbleText');
    const reopenConnectedBtn = document.getElementById('reopenConnectedBtn');
    const minimizeSidebarBtn = document.getElementById('minimizeSidebarBtn');
    const plannerSidebar = document.getElementById('plannerSidebar');
    function showToast(message, type = 'info', duration = 3500) {
        if (!toastContainer) return;
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.textContent = message;
        toastContainer.appendChild(toast);
        requestAnimationFrame(() => toast.classList.add('show'));
        setTimeout(() => {
            toast.classList.remove('show');
            toast.addEventListener('transitionend', () => {
                if (toast.parentNode) toast.parentNode.removeChild(toast);
            }, { once: true });
        }, duration);
    }
    function showLoading(msg) {
        if (loadingText) loadingText.textContent = msg || i18n.t('loading');
        if (loadingOverlay) loadingOverlay.classList.add('visible');
    }
    function hideLoading() {
        if (loadingOverlay) loadingOverlay.classList.remove('visible');
    }
    let searchTimeout = null;
    searchInput.addEventListener('input', function () {
        const query = this.value.trim();
        clearTimeout(searchTimeout);
        if (query.length < 2) {
            suggestionsDiv.innerHTML = '';
            suggestionsDiv.classList.remove('visible');
            return;
        }
        searchTimeout = setTimeout(() => fetchSuggestions(query), 300);
    });
    document.addEventListener('click', function (e) {
        if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
            suggestionsDiv.classList.remove('visible');
        }
    });
    searchInput.addEventListener('focus', function () {
        if (suggestionsDiv.children.length > 0 && searchInput.value.trim().length >= 2) {
            suggestionsDiv.classList.add('visible');
        }
    });
    async function fetchSuggestions(query) {
        searchSpinner.style.display = 'inline-block';
        searchIcon.style.display = 'none';
        try {
            const response = await fetch(`/api/search_stops?query=${encodeURIComponent(query)}`);
            const data = await response.json();
            if (response.ok) renderSuggestions(data);
            else showToast(i18n.t('err_search'), 'error');
        } catch (err) {
            showToast(i18n.t('err_connection'), 'error');
        } finally {
            searchSpinner.style.display = 'none';
            searchIcon.style.display = '';
        }
    }
    function renderSuggestions(suggestions) {
        suggestionsDiv.innerHTML = '';
        if (!suggestions.length) {
            suggestionsDiv.innerHTML = `<div style="padding:12px;text-align:center;color:#9aa0a6;font-size:13px;">${i18n.t('no_stop_found')}</div>`;
            suggestionsDiv.classList.add('visible');
            return;
        }
        suggestions.forEach(stop => {
            const item = document.createElement('div');
            item.className = 'suggestion-item';
            item.textContent = stop.stop_name;
            item.addEventListener('click', () => {
                searchInput.value = '';
                suggestionsDiv.innerHTML = '';
                suggestionsDiv.classList.remove('visible');
                addStopToItinerary(stop.stop_id, stop.stop_name);
            });
            suggestionsDiv.appendChild(item);
        });
        suggestionsDiv.classList.add('visible');
    }
    async function addStopToItinerary(stopId, stopName) {
        if (itinerary.length > 0 && itinerary[itinerary.length - 1].stop_id === stopId) {
            showToast('Cette ville est déjà la dernière étape.', 'warning');
            return;
        }
        if (itinerary.length > 0) {
            const isConnected = connectedCities.some(c => c.stop_id === stopId);
            if (!isConnected) {
                showToast(i18n.t('not_connected'), 'warning');
                return;
            }
        }
        showLoading('LOADING...');
        try {
            const infoResponse = await fetch(`/api/stop_info/${encodeURIComponent(stopId)}`);
            const infoData = await infoResponse.json();
            if (!infoResponse.ok) {
                showToast(infoData.error || 'Arrêt non trouvé.', 'error');
                hideLoading();
                return;
            }
            const stopInfo = infoData.stop_info;
            itinerary.push({
                stop_id: stopInfo.stop_id,
                stop_name: stopInfo.stop_name,
                stop_lat: parseFloat(stopInfo.stop_lat),
                stop_lon: parseFloat(stopInfo.stop_lon),
                operators: []
            });
            searchInput.placeholder = 'Ajouter une étape...';
            renderTimeline();
            await renderMapItinerary();
            await loadConnectedCities(stopInfo.stop_id, stopInfo.stop_name);
            updateButtons();
        } catch (err) {
            showToast('Erreur de connexion.', 'error');
            console.error(err);
            hideLoading();
        }
    }
    async function loadConnectedCities(stopId, stopName) {
        try {
            const response = await fetch(`/api/connected_stops/${encodeURIComponent(stopId)}`);
            const data = await response.json();
            if (response.ok) {
                connectedCities = data;
                connectedFilterQuery = '';
                if (connectedSearchInput) connectedSearchInput.value = '';
                connectedSubtitle.textContent = `${i18n.t('from')} ${stopName}`;
                connectedTitle.textContent = i18n.t('cities_connected_count', { count: data.length });
                renderConnectedCities();
                renderSuggestionMarkers(data);
                connectedPanel.classList.add('visible');
                if (window.innerWidth <= 768 && reopenConnectedBtn) {
                    reopenConnectedBtn.style.display = 'none';
                }
            } else {
                showToast(i18n.t('err_connection'), 'error');
            }
        } catch (err) {
            showToast(i18n.t('err_connection'), 'error');
            console.error(err);
        }
    }
    function getOperatorBadgesHTML(operators) {
        if (!operators || operators.length === 0) return '';
        return operators.map(op => {
            const info = OP_COLORS[op] || OP_COLORS.unknown;
            return `<span class="planner-op-badge planner-op-${op}" style="background:${info.main};">${info.label}</span>`;
        }).join('');
    }
    function renderConnectedCities() {
        let filtered = connectedCities;
        if (connectedFilterQuery) {
            filtered = connectedCities.filter(c =>
                c.stop_name.toLowerCase().includes(connectedFilterQuery)
            );
        }
        if (filtered.length === 0) {
            connectedBody.innerHTML = `<div class="planner-connected-empty">${i18n.t('no_result')}</div>`;
            return;
        }
        let html = '<ul class="planner-connected-list">';
        filtered.forEach(city => {
            const isInItinerary = itinerary.some(s => s.stop_id === city.stop_id);
            const dimClass = isInItinerary ? 'planner-city-visited' : '';
            const operators = city.operators || [];
            const primaryOp = operators[0] || 'unknown';
            const dotColor = (OP_COLORS[primaryOp] || OP_COLORS.unknown).main;
            html += `<li class="planner-city-item ${dimClass}" data-stop-id="${city.stop_id}" data-stop-name="${city.stop_name}" data-operators='${JSON.stringify(operators)}'>
                        <div class="planner-city-dot" style="background:${dotColor};"></div>
                        <span class="planner-city-name">${city.stop_name}</span>
                        <div class="planner-city-operators">
                            ${isInItinerary ? `<span class="planner-city-badge">${i18n.t('already_added')}</span>` : getOperatorBadgesHTML(operators)}
                        </div>
                     </li>`;
        });
        html += '</ul>';
        connectedBody.innerHTML = html;
        connectedBody.querySelectorAll('.planner-city-item').forEach(item => {
            item.addEventListener('click', () => {
                const sid = item.dataset.stopId;
                const sname = item.dataset.stopName;
                const ops = JSON.parse(item.dataset.operators || '[]');
                if (sid) {
                    addStopWithOperators(sid, sname, ops);
                }
            });
        });
    }
    function clearSuggestionMarkers() {
        suggestionMarkers.forEach(m => map.removeLayer(m));
        suggestionMarkers = [];
    }
    function renderSuggestionMarkers(stops) {
        clearSuggestionMarkers();
        const bounds = L.latLngBounds();
        let validPoints = 0;
        itinerary.forEach(stop => {
            if (stop.stop_lat && stop.stop_lon) {
                bounds.extend([stop.stop_lat, stop.stop_lon]);
                validPoints++;
            }
        });
        stops.forEach(stop => {
            if (!stop.stop_lat || !stop.stop_lon) return;
            const ops = stop.operators || [];
            let opsClass = 'suggestion-marker-unknown';
            if (ops.includes('flixbus') && ops.includes('blablacar_bus')) {
                opsClass = 'suggestion-marker-both';
            } else if (ops.includes('flixbus')) {
                opsClass = 'suggestion-marker-flix';
            } else if (ops.includes('blablacar_bus')) {
                opsClass = 'suggestion-marker-blabla';
            }
            const marker = L.marker([stop.stop_lat, stop.stop_lon], {
                icon: L.divIcon({
                    className: `planner-suggestion-marker ${opsClass}`,
                    iconSize: [12, 12],
                    iconAnchor: [6, 6]
                }),
                title: stop.stop_name
            }).addTo(map);
            marker.on('click', () => {
                addStopWithOperators(stop.stop_id, stop.stop_name, stop.operators);
            });
            suggestionMarkers.push(marker);
            bounds.extend([stop.stop_lat, stop.stop_lon]);
            validPoints++;
        });
        if (validPoints > 0 && bounds.isValid()) {
            map.stop();
        }
    }
    async function addStopWithOperators(stopId, stopName, operators) {
        if (itinerary.length > 0 && itinerary[itinerary.length - 1].stop_id === stopId) {
            showToast('Cette ville est déjà la dernière étape.', 'warning');
            return;
        }
        showLoading('LOADING...');
        try {
            const infoResponse = await fetch(`/api/stop_info/${encodeURIComponent(stopId)}`);
            const infoData = await infoResponse.json();
            if (!infoResponse.ok) {
                showToast(infoData.error || 'Arrêt non trouvé.', 'error');
                hideLoading();
                return;
            }
            const stopInfo = infoData.stop_info;
            itinerary.push({
                stop_id: stopInfo.stop_id,
                stop_name: stopInfo.stop_name,
                stop_lat: parseFloat(stopInfo.stop_lat),
                stop_lon: parseFloat(stopInfo.stop_lon),
                operators: operators
            });
            searchInput.placeholder = 'Ajouter une étape...';
            renderTimeline();
            await renderMapItinerary();
            await loadConnectedCities(stopInfo.stop_id, stopInfo.stop_name);
            updateButtons();
        } catch (err) {
            showToast('Erreur de connexion.', 'error');
            console.error(err);
            hideLoading();
        }
    }
    connectedSearchInput.addEventListener('input', (e) => {
        connectedFilterQuery = e.target.value.toLowerCase().trim();
        renderConnectedCities();
    });
    connectedClose.addEventListener('click', () => {
        connectedPanel.classList.remove('visible');
        if (window.innerWidth <= 768 && reopenConnectedBtn && itinerary.length > 0) {
            reopenConnectedBtn.style.display = 'flex';
        }
    });
    function renderTimeline() {
        if (itinerary.length === 0) {
            timeline.innerHTML = `
                <div class="planner-empty-state">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"
                        stroke-linecap="round" stroke-linejoin="round" style="opacity:0.3; margin-bottom:12px;">
                        <circle cx="12" cy="10" r="3"></circle>
                        <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z"></path>
                    </svg>
                    <p data-i18n="planner_empty">${i18n.t('planner_empty')}</p>
                </div>`;
            return;
        }
        let html = '<ul class="planner-timeline">';
        itinerary.forEach((stop, index) => {
            const isFirst = index === 0;
            const isLast = index === itinerary.length - 1;
            const stepLabel = isFirst ? i18n.t('step_start') : isLast && itinerary.length > 1 ? i18n.t('step_last') : `${i18n.t('step_generic')} ${index}`;
            let dotColorClass = 'planner-dot-default';
            if (isFirst) dotColorClass = 'planner-dot-start';
            else if (stop.operators && stop.operators.length > 0) {
                if (stop.operators.includes('flixbus') && stop.operators.includes('blablacar_bus')) {
                    dotColorClass = 'planner-dot-both';
                } else if (stop.operators.includes('flixbus')) {
                    dotColorClass = 'planner-dot-flix';
                } else if (stop.operators.includes('blablacar_bus')) {
                    dotColorClass = 'planner-dot-blabla';
                }
            }
            const operatorBadges = !isFirst && stop.operators ? getOperatorBadgesHTML(stop.operators) : '';
            html += `<li class="planner-timeline-item ${isFirst ? 'planner-step-first' : ''} ${isLast && itinerary.length > 1 ? 'planner-step-last' : ''}" 
                         data-index="${index}" style="animation-delay: ${index * 0.05}s;">
                        <div class="planner-timeline-dot ${dotColorClass}">
                            <span class="planner-step-number">${index + 1}</span>
                        </div>
                        <div class="planner-timeline-content">
                            <span class="planner-step-label">${stepLabel}</span>
                            <span class="planner-step-city">${stop.stop_name}</span>
                            ${operatorBadges ? `<div class="planner-step-operators">${operatorBadges}</div>` : ''}
                        </div>
                     </li>`;
        });
        html += '</ul>';
        timeline.innerHTML = html;
        timeline.scrollTop = timeline.scrollHeight;
    }
    async function getRoadGeometry(stops) {
        if (!stops || stops.length < 2) return null;
        const coords = stops.map(s => `${s.stop_lon},${s.stop_lat}`).join(';');
        const url = `https://router.project-osrm.org/route/v1/driving/${coords}?geometries=geojson&overview=full`;
        try {
            const response = await fetch(url);
            const data = await response.json();
            if (data.code === 'Ok' && data.routes && data.routes.length > 0) {
                return data.routes[0].geometry;
            }
        } catch (e) {
            console.error('Road routing error:', e);
        }
        return null;
    }
    let mapPolylines = [];
    async function renderMapItinerary() {
        markers.forEach(m => map.removeLayer(m));
        markers = [];
        mapPolylines.forEach(p => map.removeLayer(p));
        mapPolylines = [];
        if (itinerary.length === 0) {
            hideLoading();
            return;
        }
        const bounds = L.latLngBounds();
        itinerary.forEach((stop, index) => {
            const el = document.createElement('div');
            el.className = 'planner-map-marker';
            if (index === 0) {
                el.classList.add('planner-marker-start');
            } else if (stop.operators && stop.operators.length > 0) {
                if (stop.operators.includes('flixbus') && !stop.operators.includes('blablacar_bus')) {
                    el.classList.add('planner-marker-flix');
                } else if (stop.operators.includes('blablacar_bus') && !stop.operators.includes('flixbus')) {
                    el.classList.add('planner-marker-blabla');
                }
            }
            const label = document.createElement('span');
            label.className = 'planner-marker-label';
            label.textContent = index + 1;
            el.appendChild(label);
            const icon = L.divIcon({
                html: el,
                className: '',
                iconSize: [28, 28],
                iconAnchor: [14, 14]
            });
            const marker = L.marker([stop.stop_lat, stop.stop_lon], { icon: icon }).addTo(map);
            markers.push(marker);
            bounds.extend([stop.stop_lat, stop.stop_lon]);
        });
        if (itinerary.length >= 2) {
            for (let i = 0; i < itinerary.length - 1; i++) {
                const startStop = itinerary[i];
                const endStop = itinerary[i + 1];
                const ops = endStop.operators || [];
                let lineColor = '#73d700';
                let polylineClass = '';
                const hasFlix = ops.includes('flixbus');
                const hasBla = ops.includes('blablacar_bus');
                if (hasFlix && hasBla) {
                    polylineClass = 'planner-mixed-polyline';
                } else if (hasBla) {
                    lineColor = '#0070d2';
                }
                const geometry = await getRoadGeometry([startStop, endStop]);
                if (geometry && geometry.coordinates) {
                    const latlngs = geometry.coordinates.map(c => [c[1], c[0]]);
                    const poly = L.polyline(latlngs, {
                        color: lineColor,
                        weight: 6,
                        opacity: 0.7,
                        lineJoin: 'round',
                        lineCap: 'round',
                        className: polylineClass
                    }).addTo(map);
                    mapPolylines.push(poly);
                    latlngs.forEach(ll => bounds.extend(ll));
                } else {
                    const latlngs = [[startStop.stop_lat, startStop.stop_lon], [endStop.stop_lat, endStop.stop_lon]];
                    const poly = L.polyline(latlngs, {
                        color: lineColor,
                        weight: 4,
                        dashArray: '5, 10',
                        opacity: 0.5,
                        className: polylineClass
                    }).addTo(map);
                    mapPolylines.push(poly);
                }
            }
        }
        if (bounds.isValid() && itinerary.length > 1) {
            map.fitBounds(bounds, { padding: [50, 50], duration: 1.2 });
        } else if (bounds.isValid() && itinerary.length === 1) {
            map.setView([itinerary[0].stop_lat, itinerary[0].stop_lon], 11, { animate: true, duration: 1.2 });
        }
        setTimeout(() => {
            hideLoading();
        }, 1500);
    }
    function updateMobileUI() {
        if (!plannerBubble) return;
        const textEl = plannerBubbleText || plannerBubbleContent;
        if (!textEl) return;

        if (itinerary.length === 0) {
            textEl.textContent = i18n.t('mobile_bubble_empty');
        } else {
            textEl.textContent = i18n.t('mobile_bubble_stops', { count: itinerary.length });
        }
    }
    function updateButtons() {
        const hasStops = itinerary.length > 0;
        undoBtn.disabled = !hasStops;
        resetBtn.disabled = !hasStops;
        saveBtn.disabled = !hasStops;
        if (shareBtn) shareBtn.disabled = !hasStops;
        generatePdfBtn.disabled = itinerary.length < 2;
        updateMobileUI();
        if (itinerary.length === 0) {
            connectedPanel.classList.remove('visible');
            if (reopenConnectedBtn) reopenConnectedBtn.style.display = 'none';
            // Block sidebar from being draggable when empty
            if (plannerSidebar) plannerSidebar.classList.add('drag-disabled');
        } else {
            // Show reopen button if panel is closed and we have an itinerary
            if (window.innerWidth <= 768 && reopenConnectedBtn && !connectedPanel.classList.contains('visible')) {
                reopenConnectedBtn.style.display = 'flex';
            }
            if (plannerSidebar) plannerSidebar.classList.remove('drag-disabled');
        }
    }
    undoBtn.addEventListener('click', () => {
        if (itinerary.length === 0) return;
        itinerary.pop();
        renderTimeline();
        renderMapItinerary();
        updateButtons();
        if (itinerary.length > 0) {
            const lastStop = itinerary[itinerary.length - 1];
            loadConnectedCities(lastStop.stop_id, lastStop.stop_name);
        } else {
            connectedPanel.classList.remove('visible');
            clearSuggestionMarkers();
            searchInput.placeholder = i18n.t('search_start');
        }
        showToast(i18n.t('toast_removed'), 'info');
    });
    resetBtn.addEventListener('click', () => {
        itinerary = [];
        renderTimeline();
        renderMapItinerary();
        updateButtons();
        connectedPanel.classList.remove('visible');
        clearSuggestionMarkers();
        searchInput.placeholder = i18n.t('search_start');
        showToast(i18n.t('toast_cleared'), 'info');
    });
    saveBtn.addEventListener('click', () => {
        if (itinerary.length === 0) return;
        const data = JSON.stringify(itinerary, null, 2);
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        const name = itinerary.length > 0 ? itinerary[0].stop_name.replace(/[^a-z0-9]/gi, '-') : 'itinerary';
        a.download = `linia_trip_${name}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showToast(i18n.t('toast_saved'), 'success');
    });
    const SHARE_COPIED_TEXTS = {
        fr: 'Lien copié !', en: 'Link copied!', de: 'Link kopiert!', es: '¡Enlace copiado!',
        pt: 'Link copiado!', nl: 'Link gekopieerd!', sq: 'Lidhja u kopjua!', ca: 'Enllaç copiat!',
        hr: 'Poveznica kopirana!', bg: 'Линкът е копиран!', da: 'Link kopieret!', et: 'Link kopeeritud!',
        fi: 'Linkki kopioitu!', el: 'Ο σύνδεσμος αντιγράφηκε!', hu: 'Link másolva!', hi: 'लिंक कॉपी हो गया!',
        lv: 'Saite nokopēta!', lt: 'Nuoroda nukopijuota!', lb: 'Link kopéiert!', mk: 'Линкот е копиран!',
        ro: 'Link copiat!', pl: 'Link skopiowany!', cs: 'Odkaz zkopírován!', sk: 'Odkaz skopírovaný!',
        sl: 'Povezava kopirana!', sv: 'Länk kopierad!', tr: 'Bağlantı kopyalandı!', uk: 'Посилання скопійовано!',
        ru: 'Ссылка скопирована!', be: 'Спасылка скапіравана!'
    };

    function showConfettiNotification() {
        const existing = document.getElementById('confettiNotification');
        if (existing) existing.remove();
        const lang = i18n.currentLang || 'fr';
        const text = SHARE_COPIED_TEXTS[lang] || SHARE_COPIED_TEXTS['fr'];
        const overlay = document.createElement('div');
        overlay.id = 'confettiNotification';
        overlay.className = 'confetti-overlay';
        const colors = ['var(--linia-orange)', 'var(--linia-purple)', 'var(--linia-teal)'];
        const colorHex = ['#CC5533', '#414288', '#008080'];
        let confettiHTML = '';
        for (let i = 0; i < 40; i++) {
            const color = colorHex[i % 3];
            const left = Math.random() * 100;
            const delay = Math.random() * 0.5;
            const size = 6 + Math.random() * 8;
            const rotation = Math.random() * 360;
            const drift = -50 + Math.random() * 100;
            const type = i % 3 === 0 ? 'circle' : (i % 3 === 1 ? 'rect' : 'diamond');
            confettiHTML += `<div class="confetti-particle confetti-${type}" style="left:${left}%;background:${color};width:${size}px;height:${size * (type === 'rect' ? 0.5 : 1)}px;animation-delay:${delay}s;--drift:${drift}px;--rotation:${rotation}deg;"></div>`;
        }
        overlay.innerHTML = `
            <div class="confetti-container">${confettiHTML}</div>
            <div class="confetti-modal">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="var(--linia-teal)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
                <span class="confetti-text">${text}</span>
            </div>
        `;
        document.body.appendChild(overlay);
        requestAnimationFrame(() => overlay.classList.add('visible'));
        setTimeout(() => {
            overlay.classList.remove('visible');
            overlay.addEventListener('transitionend', () => overlay.remove(), { once: true });
            setTimeout(() => overlay.remove(), 500);
        }, 2500);
    }

    if (shareBtn) {
        shareBtn.addEventListener('click', () => {
            if (itinerary.length === 0) {
                showToast(i18n.t('toast_empty_itinerary') || 'Ajoutez des villes pour partager.', 'warning');
                return;
            }
            const stopIds = itinerary.map(stop => stop.stop_id).join(',');
            const url = new URL(window.location.origin + window.location.pathname);
            url.searchParams.set('route', stopIds);
            const shareUrl = url.toString();
            const shareTitle = 'Linia — ' + itinerary.map(s => s.stop_name).join(' → ');
            function doCopy(text) {
                const ta = document.createElement('textarea');
                ta.value = text;
                ta.style.position = 'fixed';
                ta.style.opacity = '0';
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
            }
            if (navigator.share) {
                navigator.share({ title: shareTitle, text: shareTitle, url: shareUrl }).catch(() => { });
            } else if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    showConfettiNotification();
                }).catch(() => {
                    doCopy(shareUrl);
                    showConfettiNotification();
                });
            } else {
                doCopy(shareUrl);
                showConfettiNotification();
            }
        });
    }
    loadBtn.addEventListener('click', () => {
        loadInput.click();
    });
    loadInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const loadedItinerary = JSON.parse(event.target.result);
                if (Array.isArray(loadedItinerary)) {
                    itinerary = loadedItinerary;
                    renderTimeline();
                    renderMapItinerary();
                    updateButtons();
                    if (itinerary.length > 0) {
                        const last = itinerary[itinerary.length - 1];
                        loadConnectedCities(last.stop_id, last.stop_name);
                        searchInput.placeholder = i18n.t('search_step');
                    }
                    showToast(i18n.t('toast_loaded'), 'success');
                } else {
                    showToast(i18n.t('err_search'), 'error');
                }
            } catch (err) {
                console.error(err);
                showToast(i18n.t('err_connection'), 'error');
            }
        };
        reader.readAsText(file);
        e.target.value = '';
    });
    generatePdfBtn.addEventListener('click', async () => {
        if (itinerary.length < 2) {
            showToast('Ajoutez au moins 2 villes pour générer un PDF.', 'warning');
            return;
        }
        generatePdfBtn.disabled = true;
        showLoading(i18n.t('pdf_generating'));
        let pdfFinished = false;
        const timeoutHandle = setTimeout(() => {
            if (!pdfFinished) {
                pdfFinished = true;
                showToast(i18n.t('pdf_timeout'), 'warning');
                generatePDFFile(null);
            }
        }, 12000);
        try {
            await new Promise(r => setTimeout(r, 2000));
            map.invalidateSize();
            await new Promise(r => setTimeout(r, 300));
            const mapElement = document.getElementById('plannerMap');
            html2canvas(mapElement, {
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff',
                logging: false,
                scale: 2,
                onclone: (clonedDoc) => {
                    const clonedMap = clonedDoc.getElementById('plannerMap');
                    if (clonedMap) {
                        clonedMap.style.transform = 'none';
                        clonedMap.style.transition = 'none';
                        const internalContainer = clonedMap.querySelector('.leaflet-map-pane');
                        if (internalContainer) internalContainer.style.transform = 'none';
                    }
                }
            }).then(canvas => {
                if (pdfFinished) return;
                try {
                    const mapImage = canvas.toDataURL('image/png');
                    clearTimeout(timeoutHandle);
                    pdfFinished = true;
                    generatePDFFile(mapImage);
                } catch (dataErr) {
                    console.error('DataURL error:', dataErr);
                    clearTimeout(timeoutHandle);
                    pdfFinished = true;
                    generatePDFFile(null);
                }
            }).catch(err => {
                if (pdfFinished) return;
                console.error('Capture error:', err);
                clearTimeout(timeoutHandle);
                pdfFinished = true;
                showToast(i18n.t('pdf_canvas_err'), 'warning');
                generatePDFFile(null);
            }
            );
        } catch (err) {
            console.error('PDF generation error:', err);
            if (!pdfFinished) {
                clearTimeout(timeoutHandle);
                pdfFinished = true;
                showToast('Erreur lors de la génération du PDF.', 'error');
                hideLoading();
                generatePdfBtn.disabled = false;
            }
        }
    });
    function generatePDFFile(mapImage) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const pageWidth = doc.internal.pageSize.getWidth();
        const margin = 20;
        let y = 20;
        try {
            doc.setFontSize(28);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(115, 215, 0);
            doc.text('Linia', margin, y + 10);
            doc.setFontSize(10);
            doc.setTextColor(130, 130, 130);
            doc.setFont('helvetica', 'normal');
            const now = new Date();
            doc.text(`Généré le ${now.toLocaleDateString('fr-FR')}`, pageWidth - margin - 40, y + 5);
            y += 20;
            const contentWidth = pageWidth - (margin * 2);
            if (mapImage && mapImage.startsWith('data:image')) {
                const finalImgHeight = 100;
                doc.addImage(mapImage, 'PNG', margin, y, contentWidth, finalImgHeight);
                doc.setDrawColor(220, 220, 220);
                doc.rect(margin, y, contentWidth, finalImgHeight);
                y += finalImgHeight + 15;
            } else {
                y += 10;
            }
            doc.setFontSize(16);
            doc.setTextColor(50, 50, 50);
            doc.setFont('helvetica', 'bold');
            doc.text(`${itinerary.length} villes traversées`, margin, y);
            y += 8;
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(100, 100, 100);
            const startName = itinerary[0]?.stop_name || 'Départ';
            const endName = itinerary[itinerary.length - 1]?.stop_name || 'Arrivée';
            doc.text(String(`${startName} -> ${endName}`), margin, y);
            y += 15;
            itinerary.forEach((stop, index) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                const isFirst = index === 0;
                const isLast = index === itinerary.length - 1;
                const operators = stop.operators || [];
                const circleX = margin + 4;
                const circleY = y;
                if (isFirst) {
                    doc.setFillColor(115, 215, 0);
                } else if (operators.includes('blablacar_bus') && !operators.includes('flixbus')) {
                    doc.setFillColor(0, 112, 210);
                } else {
                    doc.setFillColor(115, 215, 0);
                }
                doc.circle(circleX, circleY, 3.5, 'F');
                doc.setFontSize(7);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(255, 255, 255);
                const numStr = String(index + 1);
                doc.text(numStr, circleX - (numStr.length > 1 ? 2.5 : 1.5), circleY + 1.5);
                doc.setFontSize(12);
                doc.setFont('helvetica', isFirst || isLast ? 'bold' : 'normal');
                doc.setTextColor(40, 40, 40);
                const stopName = stop.stop_name ? String(stop.stop_name) : 'Ville inconnue';
                doc.text(stopName, margin + 14, y + 2);
                if (!isFirst && operators.length > 0) {
                    doc.setFontSize(9);
                    doc.setFont('helvetica', 'normal');
                    let opX = margin + 14;
                    doc.setTextColor(100, 100, 100);
                    doc.text("via ", opX, y + 7);
                    opX += 6;
                    const opsToPrint = [];
                    if (operators.includes('flixbus')) opsToPrint.push({ name: 'Flixbus', color: [115, 215, 0] });
                    if (operators.includes('blablacar_bus')) opsToPrint.push({ name: 'BlaBlaCar', color: [0, 112, 210] });
                    if (opsToPrint.length === 0) {
                        opsToPrint.push({ name: 'Bus', color: [100, 100, 100] });
                    }
                    opsToPrint.forEach((op, i) => {
                        doc.setTextColor(op.color[0], op.color[1], op.color[2]);
                        doc.text(String(op.name), opX, y + 7);
                        opX += doc.getTextWidth(String(op.name));
                        if (i < opsToPrint.length - 1) {
                            doc.setTextColor(150, 150, 150);
                            doc.text(" + ", opX, y + 7);
                            opX += doc.getTextWidth(" + ");
                        }
                    });
                }
                if (!isLast) {
                    doc.setDrawColor(200, 200, 200);
                    doc.setLineWidth(0.3);
                    doc.line(circleX, circleY + 4.5, circleX, circleY + 16);
                }
                y += 18;
            });
            const firstName = (itinerary[0]?.stop_name || 'Linia').replace(/[^a-zA-Z0-9]/g, '-');
            const lastName = (itinerary[itinerary.length - 1]?.stop_name || 'Fin').replace(/[^a-zA-Z0-9]/g, '-');
            doc.save(`Linia_Itineraire_${firstName}_${lastName}.pdf`);
            showToast(i18n.t('pdf_success'), 'success');
        } catch (pdfErr) {
            console.error('PDF construction error:', pdfErr);
            showToast('Erreur lors de l’assemblage du PDF.', 'error');
        } finally {
            hideLoading();
            generatePdfBtn.disabled = false;
        }
    }
    const disclaimerToggleBtn = document.getElementById('disclaimerToggleBtn');
    const plannerDisclaimer = document.getElementById('plannerDisclaimer');
    if (disclaimerToggleBtn && plannerDisclaimer) {
        disclaimerToggleBtn.addEventListener('click', () => {
            plannerDisclaimer.classList.toggle('collapsed');
            const isCollapsed = plannerDisclaimer.classList.contains('collapsed');
            const iconMinus = disclaimerToggleBtn.querySelector('.icon-minus');
            const iconPlus = disclaimerToggleBtn.querySelector('.icon-plus');
            if (iconMinus) iconMinus.style.display = isCollapsed ? 'none' : 'block';
            if (iconPlus) iconPlus.style.display = isCollapsed ? 'block' : 'none';
        });
    }

    if (typeof makePanelDraggable === 'function') {
        makePanelDraggable('plannerSidebar', 'plannerSidebarHeader');
        makePanelDraggable('connectedPanel', 'connectedHeader');
    }

    if (window.innerWidth <= 768) {
        if (plannerBubble) {
            plannerBubble.style.display = 'flex';
        }
        if (minimizeSidebarBtn) {
            minimizeSidebarBtn.style.display = '';
        }
    }

    if (plannerBubbleContent) {
        plannerBubbleContent.addEventListener('click', () => {
            if (itinerary.length === 0) {
                searchInput.focus();
                return;
            }
            plannerSidebar.classList.add('visible');
            plannerBubble.style.display = 'none';
        });
    }

    if (minimizeSidebarBtn) {
        minimizeSidebarBtn.addEventListener('click', () => {
            plannerSidebar.classList.remove('visible');
            if (window.innerWidth <= 768 && plannerBubble) {
                plannerBubble.style.display = 'flex';
            }
        });
    }

    if (reopenConnectedBtn) {
        reopenConnectedBtn.addEventListener('click', () => {
            if (itinerary.length > 0) {
                const lastStop = itinerary[itinerary.length - 1];
                loadConnectedCities(lastStop.stop_id, lastStop.stop_name);
            }
        });
    }

    async function loadSharedRoute() {
        const params = new URLSearchParams(window.location.search);
        const routeParam = params.get('route');
        if (!routeParam) return;
        const stopIds = routeParam.split(',').filter(id => id.trim());
        if (stopIds.length === 0) return;
        showLoading(i18n.t('loading') || 'Chargement...');
        try {
            for (let idx = 0; idx < stopIds.length; idx++) {
                const stopId = stopIds[idx].trim();
                const response = await fetch(`/api/stop_info/${encodeURIComponent(stopId)}`);
                const data = await response.json();
                if (!response.ok || !data.stop_info) continue;
                const stopInfo = data.stop_info;
                itinerary.push({
                    stop_id: stopInfo.stop_id,
                    stop_name: stopInfo.stop_name,
                    stop_lat: parseFloat(stopInfo.stop_lat),
                    stop_lon: parseFloat(stopInfo.stop_lon),
                    operators: []
                });
            }
            if (itinerary.length > 0) {
                renderTimeline();
                await renderMapItinerary();
                updateButtons();
                searchInput.placeholder = i18n.t('search_add_step') || 'Ajouter une étape...';
                const lastStop = itinerary[itinerary.length - 1];
                await loadConnectedCities(lastStop.stop_id, lastStop.stop_name);
                showToast(i18n.t('toast_route_loaded') || 'Itinéraire chargé !', 'success');
            }
        } catch (err) {
            console.error('Error loading shared route:', err);
            showToast(i18n.t('err_connection') || 'Erreur de connexion.', 'error');
        } finally {
            hideLoading();
        }
        const cleanUrl = new URL(window.location.href);
        cleanUrl.searchParams.delete('route');
        window.history.replaceState({}, '', cleanUrl);
    }

    loadSharedRoute();
    updateButtons();
});


--- FIN FICHIER ---

--- DÉBUT FICHIER : static\style.css ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\static\style.css ---

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

:root {
    --linia-orange: #CC5533;
    --linia-purple: #414288;
    --linia-teal: #008080;
    --linia-orange-hover: #b34a2d;
    --linia-purple-hover: #353670;
    --linia-teal-hover: #006666;

    --flix-green: #73d700;
    --flix-green-accent: #73d700;
    --flix-green-hover: #5cb800;
    --blablacar-blue: #00aff5;
    --blablacar-blue-accent: #0070d2;
    --blablacar-blue-hover: #0056a3;
    --text-primary: #1a1a1b;
    --text-secondary: #5f6368;
    --text-muted: #9aa0a6;
    --bg-white: #ffffff;
    --bg-light: #f8f9fa;
    --bg-hover: #f1f3f4;
    --border-light: #e8eaed;
    --border-color: #e8eaed;
    --blue-accent: var(--linia-purple);
    --green-accent: var(--linia-teal);
    --green-hover: var(--linia-teal-hover);
    --shadow-sm: 0 1px 2px 0 rgba(60, 64, 67, .30), 0 1px 3px 1px rgba(60, 64, 67, .15);
    --shadow-md: 0 1px 3px 0 rgba(60, 64, 67, .30), 0 4px 8px 3px rgba(60, 64, 67, .15);
    --shadow-lg: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 20px;
    --radius-full: 9999px;
    --font-main: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
}

*,
*::before,
*::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html,
body {
    height: 100%;
    font-family: var(--font-main);
    background-color: var(--bg-white);
    color: var(--text-primary);
    font-size: 14px;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

a {
    color: var(--blue-accent);
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.spinner {
    border: 3px solid var(--border-light);
    border-left-color: var(--blue-accent);
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 0.7s linear infinite;
    display: inline-block;
}

.toast-container {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 10000;
    display: flex;
    flex-direction: column-reverse;
    gap: 8px;
}

.toast {
    background-color: var(--text-primary);
    color: white;
    padding: 12px 20px;
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-lg);
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 0.3s ease, transform 0.3s ease;
    font-size: 13px;
    max-width: 360px;
}

.toast.show {
    opacity: 1;
    transform: translateY(0);
}

.toast-error {
    background-color: #d93025;
}

.toast-success {
    background-color: var(--green-accent);
}

.toast-info {
    background-color: var(--blue-accent);
}

.toast-warning {
    background-color: #f9ab00;
    color: var(--text-primary);
}

.landing-page {
    width: 100%;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
}

.landing-map-bg {
    position: absolute;
    inset: 0;
    z-index: 0;
    width: 100%;
    height: 100%;
}

.mobile-landing-extras {
    display: none;
}

.landing-actions {
    display: flex;
    flex-direction: row;
    align-items: stretch;
    justify-content: center;
    gap: 16px;
    width: 100%;
    margin: 0 auto;
}

.landing-map-overlay {
    position: absolute;
    inset: 0;
    z-index: 1;
    background: radial-gradient(ellipse at center,
            rgba(255, 255, 255, 0.4) 0%,
            rgba(255, 255, 255, 0.6) 50%,
            rgba(255, 255, 255, 0.8) 100%);
    pointer-events: none;
}

.landing-content {
    position: relative;
    z-index: 20;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 24px;
    width: 100%;
    max-width: 640px;
}

.landing-text-block {
    text-align: center;
    margin-bottom: 20px;
}

.welcome-line {
    font-size: 28px;
    font-weight: 300;
    color: var(--text-secondary);
    margin-bottom: 4px;
    height: 42px;
    position: relative;
    overflow: hidden;
}

.cycling-text {
    display: inline-block;
    transition: opacity 0.4s ease, transform 0.4s ease;
    opacity: 1;
    transform: translateY(0);
}

.cycling-text.text-hidden {
    opacity: 0;
    transform: translateY(-8px);
}

.cycling-text.text-visible {
    opacity: 1;
    transform: translateY(0);
}

.brand-name {
    font-size: 72px;
    font-weight: 700;
    letter-spacing: -2px;
    color: var(--text-primary);
}

@keyframes gradient-shift {
    0% {
        background-position: 100% center;
    }

    100% {
        background-position: -100% center;
    }
}

.highlight {
    background: linear-gradient(90deg,
            var(--linia-orange),
            var(--linia-purple),
            var(--linia-teal),
            var(--linia-orange));
    background-size: 300% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradient-shift 8s linear infinite;
}

.landing-search-container {
    width: 100%;
    max-width: 585px;
    position: relative;
    margin: 0 auto 24px auto;
}

.landing-search-wrapper {
    position: relative;
}

.landing-search-bar {
    width: 100%;
    padding: 14px 52px 14px 44px;
    border: 2px solid var(--linia-orange);
    border-radius: 0.5em;
    font-size: 16px;
    font-family: var(--font-main);
    color: var(--text-primary);
    background: var(--bg-white);
    outline: none;
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
    animation: search-glow-dynamic 5s ease-in-out infinite;
}

@keyframes search-glow-dynamic {
    0% {
        border-color: var(--linia-orange);
        box-shadow: 0 0 8px rgba(204, 85, 51, 0.2);
    }

    33% {
        border-color: var(--linia-purple);
        box-shadow: 0 0 15px rgba(65, 66, 136, 0.35);
    }

    66% {
        border-color: var(--linia-teal);
        box-shadow: 0 0 15px rgba(0, 128, 128, 0.35);
    }

    100% {
        border-color: var(--linia-orange);
        box-shadow: 0 0 8px rgba(204, 85, 51, 0.2);
    }
}

.landing-search-bar::placeholder {
    color: var(--text-muted);
}

.landing-search-bar:hover,
.landing-search-bar:focus {
    box-shadow: 0 0 20px rgba(66, 133, 244, 0.4);
    background: var(--bg-white);
}

.landing-search-icon,
.map-search-icon,
.planner-search-icon {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    pointer-events: none;
    z-index: 15;
    display: flex;
    align-items: center;
    justify-content: center;
}

.landing-search-spinner,
.map-search-spinner,
.planner-search-spinner {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 15;
}

.landing-suggestions {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    right: 0;
    background: var(--bg-white);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    max-height: 280px;
    overflow-y: auto;
    z-index: 100;
    display: none;
}

.landing-suggestions.visible {
    display: block;
}

.suggestion-item {
    padding: 12px 20px;
    cursor: pointer;
    font-size: 14px;
    color: var(--text-secondary);
    transition: background-color 0.15s ease;
    border-bottom: 1px solid var(--border-light);
}

.suggestion-item:last-child {
    border-bottom: none;
}

.suggestion-item:hover {
    background-color: var(--bg-hover);
    color: var(--text-primary);
}

.landing-actions {
    display: flex;
    flex-direction: row;
    align-items: stretch;
    justify-content: center;
    gap: 16px;
    width: 100%;
    margin: 0 auto;
}

.linia-btn-premium {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    height: 52px;
    padding: 0 1.4em;
    font-size: 15px;
    font-weight: 600;
    font-family: var(--font-main);
    color: var(--text-primary);
    background: var(--bg-white);
    border: 2px solid var(--border-light);
    border-radius: 0.5em;
    cursor: pointer;
    text-decoration: none;
    position: relative;
    overflow: hidden;
    z-index: 1;
    transition: all 0.2s ease-in;
}

.linia-btn-premium:active {
    color: #666;
    transform: translateY(2px);
}

.linia-btn-premium svg {
    flex-shrink: 0;
    transition: transform 0.3s ease;
}

.linia-btn-premium::before {
    content: "";
    position: absolute;
    left: 50%;
    transform: translateX(-50%) scaleY(1) scaleX(1.25);
    top: 100%;
    width: 140%;
    height: 180%;
    background-color: rgba(0, 0, 0, 0.05);
    border-radius: 50%;
    display: block;
    transition: all 0.5s 0.1s cubic-bezier(0.55, 0, 0.1, 1);
    z-index: -1;
}

.linia-btn-premium::after {
    content: "";
    position: absolute;
    left: 55%;
    transform: translateX(-50%) scaleY(1) scaleX(1.45);
    top: 180%;
    width: 160%;
    height: 190%;
    background: linear-gradient(135deg, var(--linia-purple), var(--linia-teal));
    border-radius: 50%;
    display: block;
    transition: all 0.5s 0.1s cubic-bezier(0.55, 0, 0.1, 1);
    z-index: -1;
}

.linia-btn-premium:hover {
    color: #ffffff;
    border-color: transparent;
    background: linear-gradient(white, white) padding-box,
        linear-gradient(90deg, var(--linia-orange), var(--linia-purple), var(--linia-teal)) border-box;
    text-decoration: none;
}

.linia-btn-premium:hover svg {
    transform: scale(1.1);
}

.linia-btn-premium:hover::before {
    top: -35%;
    background-color: var(--linia-orange);
    transform: translateX(-50%) scaleY(1.3) scaleX(0.8);
}

.linia-btn-premium:hover::after {
    top: -45%;
    background: linear-gradient(135deg, var(--linia-purple), var(--linia-teal));
    transform: translateX(-50%) scaleY(1.3) scaleX(0.8);
}

.landing-action-btn {
    flex: 1;
}

.how-it-works-btn {
    flex: 1;
    text-align: center;
    justify-content: center;
}

.map-page {
    width: 100%;
    height: 100vh;
    position: relative;
    overflow: hidden;
}

#map {
    width: 100%;
    height: 100%;
    z-index: 1;
}

.map-search-bar-container {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    width: 90%;
    max-width: 440px;
}

/* --- FOOTER & DISCLAIMER CARD --- */

.linia-footer {
    position: relative;
    padding: 2.5em;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5em;
    z-index: 99999;
    width: 100%;
}

.landing-footer {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 99999;
}

/* --- INFO BUTTON TOOLTIP --- */

/* --- INFO BUTTON TOOLTIP REFINED --- */

.linia-info-wrapper {
    position: relative;
    display: inline-block;
    margin-bottom: 2em;
    z-index: 9999;
    /* Higher than landing-actions */
}

.linia-info-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    padding: 0;
    background: rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(12px) saturate(180%);
    -webkit-backdrop-filter: blur(12px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    position: relative;
    z-index: 1;
    animation: info-pulse 3s infinite ease-in-out;
}

@keyframes info-pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(0, 128, 128, 0.4);
    }

    70% {
        box-shadow: 0 0 0 10px rgba(0, 128, 128, 0);
    }

    100% {
        box-shadow: 0 0 0 0 rgba(0, 128, 128, 0);
    }
}

.linia-info-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, var(--linia-orange), var(--linia-purple));
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
}

.linia-info-btn:hover {
    transform: translateY(-2px) scale(1.1);
    background: rgba(255, 255, 255, 0.45);
    border-color: rgba(255, 255, 255, 0.8);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.linia-info-btn:hover::before {
    opacity: 1;
}

.linia-info-btn svg {
    color: var(--linia-teal);
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.linia-info-btn:hover svg {
    transform: scale(1.15) rotate(15deg);
}

.linia-info-tooltip {
    position: absolute;
    bottom: calc(100% + 12px);
    left: 50%;
    transform: translateX(-50%) translateY(10px);
    width: 320px;
    padding: 1.5em;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(30px) saturate(200%);
    -webkit-backdrop-filter: blur(30px) saturate(200%);
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 1.2em;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    pointer-events: auto;
    /* Required for clicking link */
    z-index: 10000;
    text-align: left;
}

/* Hover Bridge: Pseudo-element to bridge gap between button and tooltip */
.linia-info-tooltip::before {
    content: '';
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    height: 25px;
    /* Bridges the distance */
    background: transparent;
}

.linia-info-wrapper:hover .linia-info-tooltip {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(0);
}

/* Tooltip content styles same as before */
.tooltip-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
}

.tooltip-header svg {
    color: var(--linia-orange);
    flex-shrink: 0;
}

.tooltip-header h3 {
    font-size: 13px;
    font-weight: 800;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--text-primary);
}

.linia-info-tooltip p {
    font-size: 11.5px;
    line-height: 1.6;
    color: var(--text-secondary);
    margin: 0 0 15px 0;
    font-weight: 500;
}

.tooltip-footer {
    padding-top: 12px;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    display: flex;
    justify-content: flex-end;
}

.tooltip-legal-link {
    font-size: 11px;
    font-weight: 700;
    color: var(--linia-teal);
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

.tooltip-legal-link:hover {
    color: var(--linia-orange);
    transform: translateX(3px);
}

/* Tooltip Arrow */
.linia-info-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 8px solid transparent;
    border-top-color: rgba(255, 255, 255, 0.85);
}

@media (max-width: 768px) {
    .linia-info-tooltip {
        width: 280px;
        left: 50%;
    }
}

.footer-signature-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5em;
    pointer-events: auto;
}

.signature-link {
    font-size: 12px;
    color: var(--text-primary);
    text-decoration: none;
    font-weight: 600;
    opacity: 0.8;
    transition: opacity 0.2s ease;
}

.signature-link:hover {
    opacity: 1;
}

.map-search-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.map-search-bar {
    width: 100%;
    padding: 12px 48px 12px 40px;
    border: 2px solid var(--linia-teal);
    border-radius: 0.5em;
    font-size: 16px;
    /* Prevent mobile auto-zoom */
    font-family: var(--font-main);
    color: var(--text-primary);
    background: var(--bg-white);
    box-shadow: var(--shadow-md);
    outline: none;
    transition: box-shadow 0.2s ease, border-color 0.2s ease;
    animation: search-glow-dynamic 5s ease-in-out infinite;
}

.map-search-bar::placeholder {
    color: var(--text-muted);
}

.map-search-bar:focus {
    box-shadow: var(--shadow-lg);
}

.map-suggestions {
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    right: 0;
    background: var(--bg-white);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    max-height: 240px;
    overflow-y: auto;
    z-index: 100;
    display: none;
}

.map-suggestions.visible {
    display: block;
}

.expanding-nav-btn {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background-color: var(--bg-white);
    border: 1px solid var(--border-light);
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-md);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    position: fixed;
    z-index: 1000;
    text-decoration: none !important;
}

.expanding-nav-btn .svgIcon {
    width: 20px;
    height: 20px;
    transition: all 0.3s ease;
    color: var(--text-secondary);
}

.expanding-nav-btn:hover {
    width: 140px;
    border-radius: var(--radius-sm);
    background: linear-gradient(135deg, var(--linia-purple), var(--linia-teal));
    border-color: transparent;
    box-shadow: var(--shadow-lg);
}

.expanding-nav-btn:hover .svgIcon {
    transform: translateY(-150%);
    opacity: 0;
}

.expanding-nav-btn::before {
    position: absolute;
    bottom: -20px;
    content: attr(data-label);
    color: white;
    font-size: 13px;
    font-weight: 700;
    opacity: 0;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.expanding-nav-btn:hover::before {
    opacity: 1;
    bottom: 50%;
    transform: translateY(50%);
}

.nav-btn-home {
    top: 20px;
    right: 20px;
}

.nav-btn-planner {
    top: 82px;
    right: 20px;
}

.nav-btn-planner.is-active {
    background: var(--linia-teal);
}

.nav-btn-planner.is-active .svgIcon {
    color: white;
}

.route-panel {
    position: fixed;
    top: 130px;
    left: 20px;
    width: 380px;
    max-height: calc(100vh - 180px);
    background: var(--bg-white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    z-index: 1000;
    transform: translateX(-420px);
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.route-panel.visible {
    transform: translateX(0);
}

.planner-sidebar {
    position: fixed;
    top: 130px;
    left: 20px;
    width: 380px;
    max-height: calc(100vh - 180px);
    background: var(--bg-white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

.planner-sidebar-header {
    padding: 24px 24px 16px;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.planner-sidebar-header h2 {
    font-size: 20px;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
}

.planner-sidebar-actions {
    display: flex;
    gap: 8px;
}

.planner-sidebar-body {
    flex: 1;
    overflow-y: auto;
    padding: 16px 20px;
}

.planner-sidebar-footer {
    padding: 20px 24px 24px;
    background: var(--bg-white);
    border-top: 1px solid var(--border-light);
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.planner-footer-main-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
}

.planner-footer-main-actions .planner-footer-btn {
    flex: 1;
    justify-content: center;
}

.planner-empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    text-align: center;
    color: var(--text-muted);
}

.planner-timeline {
    list-style: none;
    padding: 0;
    margin: 0;
    position: relative;
}

.planner-timeline::before {
    content: '';
    position: absolute;
    top: 24px;
    bottom: 24px;
    left: 15px;
    width: 2px;
    background: var(--border-color);
    z-index: 0;
    opacity: 0.5;
}

.planner-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-light);
    background: var(--bg-white);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
}

.planner-btn:hover:not(:disabled) {
    background: var(--bg-hover);
    color: var(--text-primary);
}

.planner-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.planner-btn-ghost {
    background: transparent;
    border-color: transparent;
}

.route-panel-header {
    padding: 20px 24px 16px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    border-bottom: 1px solid var(--border-light);
}

.route-panel-header h2 {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
    line-height: 1.3;
}

.route-panel-close {
    background: var(--bg-light);
    border: none;
    font-size: 24px;
    width: 32px;
    height: 32px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    transition: background 0.2s;
}

.route-panel-close:hover {
    background: #e1e4e8;
}

.route-panel-body {
    flex: 1;
    overflow-y: auto;
    padding: 0;
}

.trip-details-panel {
    position: fixed;
    top: 138px;
    right: 20px;
    width: 320px;
    max-height: calc(100vh - 180px);
    background: var(--bg-white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    z-index: 1100;
    transform: translateX(360px);
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.trip-details-panel.visible {
    transform: translateX(0);
}

.trip-details-header {
    padding: 24px 20px 16px;
    border-bottom: 1px solid var(--border-light);
    position: relative;
    background: var(--bg-white);
}

.trip-details-title-container {
    padding-right: 32px;
}

.trip-details-title-container h3 {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 4px 0;
}

.trip-details-subtitle {
    font-size: 13px;
    color: var(--text-secondary);
    display: block;
}

.trip-details-close {
    position: absolute;
    top: 18px;
    right: 18px;
    background: var(--bg-light);
    border: none;
    font-size: 20px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    transition: all 0.2s ease;
    z-index: 5;
}

.trip-details-close:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
    transform: rotate(90deg);
}



.trip-details-body {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}

.timeline-list {
    list-style: none;
    padding: 0;
    margin: 0;
    position: relative;
}

.timeline-list::before {
    content: '';
    position: absolute;
    top: 12px;
    bottom: 12px;
    left: 7px;
    width: 2px;
    background: var(--border-color);
    z-index: 0;
    opacity: 0.5;
}

.timeline-item {
    position: relative;
    padding-left: 28px;
    padding-bottom: 24px;
    z-index: 1;
}

.timeline-item:last-child {
    padding-bottom: 0;
}

.timeline-dot {
    position: absolute;
    left: 0;
    top: 4px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--bg-white);
    border: 2px solid var(--border-color);
    z-index: 2;
    transition: all 0.2s ease;
}

.timeline-item.active-blabla .timeline-dot {
    border-color: var(--blablacar-blue-accent);
    background-color: var(--blablacar-blue-accent);
}

.timeline-item.active-blabla .timeline-city-name {
    color: var(--blablacar-blue-accent);
    font-weight: 700;
}

.timeline-item.active-flix .timeline-dot {
    border-color: var(--flix-green-accent);
    background-color: var(--flix-green-accent);
}

.timeline-item.active-flix .timeline-city-name {
    color: var(--flix-green-hover);
    font-weight: 700;
}

.timeline-content {
    display: flex;
    flex-direction: column;
}

.timeline-city-name {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-primary);
}

.timeline-time {
    font-size: 12px;
    color: var(--text-secondary);
}

.reopen-panel-btn {
    position: fixed;
    top: 130px;
    left: 18px;
    bottom: auto;
    z-index: 950;
    display: none;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: var(--bg-white);
    color: var(--text-secondary);
    border: 1px solid var(--border-light);
    border-radius: 50%;
    box-shadow: var(--shadow-md);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.reopen-panel-btn:hover {
    background-color: var(--bg-hover);
    border-radius: var(--radius-sm);
    background: linear-gradient(135deg, var(--linia-purple), var(--linia-teal));
    color: white;
    border-color: transparent;
    box-shadow: var(--shadow-lg);
}

.reopen-trip-panel-btn {
    position: fixed;
    top: 138px;
    right: 20px;
    bottom: auto;
    z-index: 950;
    display: none;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: var(--bg-white);
    color: var(--text-secondary);
    border: 1px solid var(--border-light);
    border-radius: 50%;
    box-shadow: var(--shadow-md);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.reopen-trip-panel-btn:hover {
    background-color: var(--bg-hover);
    border-radius: var(--radius-sm);
    background: linear-gradient(135deg, var(--linia-purple), var(--linia-teal));
    color: white;
    border-color: transparent;
    box-shadow: var(--shadow-lg);
}

.reopen-panel-btn svg,
.reopen-trip-panel-btn svg {
    flex-shrink: 0;
    transform: rotate(90deg);
}

.reopen-trip-panel-btn svg {
    transform: rotate(-90deg);
}


.operator-legend {
    display: flex;
    gap: 16px;
    padding: 8px 12px;
    font-size: 12px;
    color: var(--text-secondary);
    border-bottom: 1px solid var(--border-light);
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

.legend-color-box {
    width: 10px;
    height: 10px;
    border-radius: 2px;
}

.legend-flixbus {
    background-color: var(--flix-green-accent);
}

.legend-blablacar {
    background-color: var(--blablacar-blue-accent);
}

.route-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.route-list .route-item {
    padding: 12px 16px;
    margin: 4px 0;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 14px;
    color: var(--text-secondary);
    border-left: 3px solid transparent;
    transition: background-color 0.15s ease, transform 0.1s ease;
}

.route-item:hover {
    background-color: var(--bg-hover);
    color: var(--text-primary);
    transform: translateX(2px);
}

.route-item strong {
    font-weight: 500;
    color: var(--text-primary);
}

.route-item--flixbus {
    border-left-color: var(--flix-green-accent);
}

.route-item--flixbus:hover {
    background-color: rgba(115, 215, 0, 0.15);
    color: var(--flix-green-hover);
    border-left-width: 4px;
}

.route-item--blablacar-bus {
    border-left-color: var(--blablacar-blue-accent);
}

.route-item--blablacar-bus:hover {
    background-color: rgba(0, 112, 210, 0.15);
    color: var(--blablacar-blue-hover);
    border-left-width: 4px;
}

.route-item--unknown {
    border-left-color: var(--text-muted);
}

.route-controls {
    padding: 12px 16px;
    background: var(--bg-white);
    border-bottom: 1px solid var(--border-light);
}

.filter-pills {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
}

.lang-switcher-btn {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 20 !important;
    padding: 8px;
    pointer-events: auto !important;
}

.lang-switcher-btn * {
    transition: none !important;
    animation: none !important;
    pointer-events: none;
}

.lang-switcher-btn:hover {
    color: var(--text-primary) !important;
    transform: translateY(-50%) scale(1.1) !important;
}

.filter-pill {
    padding: 6px 14px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-full);
    background: transparent;
    font-size: 13px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
}

.filter-pill:hover {
    background: var(--bg-hover);
}

.filter-pill.active {
    background: var(--text-primary);
    color: white;
    border-color: var(--text-primary);
}

.route-filter-search {
    position: relative;
}

.route-filter-search input {
    width: 100%;
    padding: 10px 14px;
    border: 1px solid var(--border-light);
    border-radius: var(--radius-sm);
    background: var(--bg-light);
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s ease;
}

.route-filter-search input:focus {
    border-color: var(--blue-accent);
}

.loading-overlay {
    position: absolute;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1001;
    background: var(--bg-white);
    padding: 12px 24px;
    border-radius: var(--radius-full);
    box-shadow: var(--shadow-md);
    display: none;
    align-items: center;
    gap: 10px;
    font-size: 13px;
    color: var(--text-secondary);
}

.loading-overlay.visible {
    display: flex;
}

.route-empty-msg {
    text-align: center;
    padding: 20px;
    color: var(--text-muted);
    font-size: 13px;
}

.about-page {
    width: 100%;
    min-height: 100vh;
    background: var(--bg-white);
    display: flex;
    flex-direction: column;
}

.about-nav {
    padding: 16px 32px;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    align-items: center;
    gap: 12px;
}

.about-nav .nav-brand {
    font-size: 20px;
    font-weight: 700;
    text-decoration: none;
}

.about-nav .nav-link {
    font-size: 14px;
    color: var(--text-secondary);
    text-decoration: none;
    margin-left: auto;
    transition: color 0.15s ease;
}

.about-nav .nav-link:hover {
    color: var(--text-primary);
    text-decoration: none;
}

.about-content {
    max-width: 680px;
    margin: 0 auto;
    padding: 48px 24px 80px;
}

.about-content h1 {
    font-size: 32px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.about-content .about-subtitle {
    font-size: 16px;
    color: var(--text-secondary);
    margin-bottom: 40px;
    line-height: 1.6;
}

.about-content h2 {
    font-size: 20px;
    font-weight: 600;
    color: var(--text-primary);
    margin-top: 40px;
    margin-bottom: 12px;
}

.about-content p {
    font-size: 15px;
    color: var(--text-secondary);
    line-height: 1.7;
    margin-bottom: 12px;
}

.about-content ul {
    list-style: disc;
    padding-left: 24px;
    margin-bottom: 16px;
}

.about-content ul li {
    font-size: 15px;
    color: var(--text-secondary);
    line-height: 1.7;
    margin-bottom: 4px;
}

.download-card {
    background: var(--bg-light);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
    padding: 24px;
    margin-top: 24px;
}

.download-card h3 {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.download-card p {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 12px;
}

.download-card .download-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: var(--green-accent);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    font-size: 14px;
    font-weight: 500;
    font-family: var(--font-main);
    text-decoration: none;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.download-card .download-btn:hover {
    background: var(--green-hover);
    text-decoration: none;
    color: white;
}

.planner-page {
    width: 100%;
    height: 100vh;
    position: relative;
    overflow: hidden;
}

#plannerMap {
    width: 100%;
    height: 100%;
    z-index: 1;
}

.planner-search-container {
    position: absolute;
    top: 16px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    width: 90%;
    max-width: 440px;
}

.planner-search-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.planner-search-icon {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    pointer-events: none;
}

.planner-search-spinner {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
}

.planner-suggestions {
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    right: 0;
    background: var(--bg-white);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    max-height: 240px;
    overflow-y: auto;
    z-index: 100;
    display: none;
}

.planner-suggestions.visible {
    display: block;
}

.planner-timeline-item {
    position: relative;
    padding-left: 44px;
    padding-bottom: 20px;
    z-index: 1;
    animation: fadeInStep 0.3s ease forwards;
    opacity: 0;
}

@keyframes fadeInStep {
    from {
        opacity: 0;
        transform: translateY(8px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.planner-timeline-item:last-child {
    padding-bottom: 0;
}

.planner-search-bar {
    width: 100%;
    padding: 12px 48px 12px 40px;
    border: 2px solid var(--linia-purple);
    border-radius: 0.5em;
    font-size: 16px;
    /* Prevent mobile auto-zoom */
    font-family: var(--font-main);
    color: var(--text-primary);
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(8px);
    box-shadow: var(--shadow-md);
    outline: none;
    transition: all 0.3s ease;
    animation: search-glow-dynamic 5s ease-in-out infinite;
}

.planner-search-bar:focus {
    background: #fff;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.planner-timeline-dot {
    position: absolute;
    left: 4px;
    top: 2px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--linia-teal);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
    box-shadow: 0 2px 6px rgba(0, 128, 128, 0.35);
}

.planner-dot-start {
    background: var(--linia-orange) !important;
    box-shadow: 0 2px 6px rgba(204, 85, 51, 0.35) !important;
}

.planner-dot-flix {
    background: var(--flix-green-accent) !important;
    box-shadow: 0 2px 6px rgba(115, 215, 0, 0.35) !important;
}

.planner-dot-blabla {
    background: var(--blablacar-blue-accent) !important;
    box-shadow: 0 2px 6px rgba(0, 112, 210, 0.35) !important;
}

.planner-dot-both {
    background: linear-gradient(135deg, var(--linia-purple), var(--linia-teal)) !important;
    box-shadow: 0 2px 6px rgba(0, 128, 128, 0.25) !important;
}

.planner-dot-default {
    background: var(--linia-teal) !important;
}

.planner-step-number {
    color: white;
    font-size: 11px;
    font-weight: 700;
    line-height: 1;
}

.planner-timeline-content {
    display: flex;
    flex-direction: column;
    gap: 1px;
}

.planner-step-label {
    font-size: 11px;
    font-weight: 500;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.planner-step-city {
    font-size: 15px;
    font-weight: 600;
    color: var(--text-primary);
}

.planner-step-operators {
    display: flex;
    gap: 4px;
    margin-top: 3px;
}

.planner-op-badge {
    display: inline-block;
    font-size: 9px;
    font-weight: 600;
    color: white;
    padding: 2px 7px;
    border-radius: var(--radius-full);
    letter-spacing: 0.3px;
}

.planner-step-first .planner-step-label {
    background: linear-gradient(90deg, var(--linia-orange), var(--linia-purple), var(--linia-teal));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
}

.planner-step-last .planner-step-label {
    color: var(--text-primary);
    font-weight: 700;
}

.planner-connected-panel {
    position: fixed;
    top: 80px;
    right: 16px;
    width: 340px;
    max-height: calc(100vh - 120px);
    background: var(--bg-white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    z-index: 1000;
    display: none;
    flex-direction: column;
    overflow: hidden;
    animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

.planner-connected-panel.visible {
    display: flex !important;
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(20px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.planner-connected-header {
    padding: 20px 20px 14px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    border-bottom: 1px solid var(--border-light);
}

.planner-connected-header h3 {
    font-size: 16px;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 2px 0;
}

.planner-connected-subtitle {
    font-size: 12px;
    color: var(--text-secondary);
    display: block;
}

.planner-connected-close {
    background: var(--bg-light);
    border: none;
    font-size: 22px;
    width: 30px;
    height: 30px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    transition: background 0.2s;
}

.planner-connected-close:hover {
    background: #e1e4e8;
}

.planner-connected-search {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-light);
}

.planner-connected-search input {
    width: 100%;
    padding: 10px 14px;
    border: 1px solid var(--border-light);
    border-radius: var(--radius-sm);
    background: var(--bg-light);
    font-size: 16px;
    /* Prevent mobile auto-zoom */
    font-family: var(--font-main);
    outline: none;
    transition: border-color 0.2s ease;
}

.planner-connected-search input:focus {
    border-color: var(--linia-teal);
}

.planner-connected-body {
    flex: 1;
    overflow-y: auto;
    padding: 0;
}

.planner-connected-empty {
    text-align: center;
    padding: 24px;
    color: var(--text-muted);
    font-size: 13px;
}

.planner-connected-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.planner-city-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 20px;
    cursor: pointer;
    border-left: 3px solid transparent;
    transition: all 0.15s ease;
}

.planner-city-item:hover {
    background-color: var(--blablacar-blue-subtle-bg);
    border-left-color: var(--blablacar-blue-accent);
    transform: translateX(2px);
}

.planner-city-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}

.planner-city-operators {
    display: flex;
    gap: 4px;
    flex-shrink: 0;
}

.planner-city-name {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-primary);
    flex: 1;
}

.planner-city-badge {
    font-size: 10px;
    font-weight: 600;
    color: var(--text-muted);
    background: var(--bg-light);
    padding: 2px 8px;
    border-radius: var(--radius-full);
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.planner-city-visited {
    opacity: 0.5;
}

.planner-city-visited .planner-city-dot {
    background: var(--border-color);
}

.planner-map-marker {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--flix-green-accent);
    border: 3px solid white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.2s ease;
}

.planner-map-marker.hovered,
.planner-map-marker:hover {
    transform: scale(1.15);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    z-index: 1000;
}

.planner-marker-label {
    color: white;
    font-size: 11px;
    font-weight: 700;
    font-family: var(--font-main);
}

.planner-marker-start {
    background: var(--flix-green-accent);
}

.planner-marker-flix {
    background: var(--flix-green-accent);
}

.planner-marker-blabla {
    background: var(--blablacar-blue-accent);
}

.linia-map-marker {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
    z-index: 10;
}

.linia-map-marker.op-flixbus {
    background-color: var(--flix-green-accent);
}

.linia-map-marker.op-blablacar-bus {
    background-color: var(--blablacar-blue-accent);
}

.linia-map-marker.hovered,
.linia-map-marker:hover {
    transform: scale(1.4);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    z-index: 1000;
}

.linia-map-marker.op-flixbus.hovered,
.linia-map-marker.op-flixbus:hover {
    background-color: var(--blablacar-blue-accent);
}

.linia-map-marker.op-blablacar-bus.hovered,
.linia-map-marker.op-blablacar-bus:hover {
    background-color: var(--flix-green-accent);
}


/* --- Leaflet Customization --- */
.leaflet-control-zoom {
    border: none !important;
    box-shadow: none !important;
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin: 20px !important;
}

.leaflet-control-zoom-in,
.leaflet-control-zoom-out {
    width: 44px !important;
    height: 44px !important;
    line-height: 44px !important;
    border-radius: 50% !important;
    background-color: var(--bg-white) !important;
    color: var(--text-secondary) !important;
    border: 1px solid var(--border-light) !important;
    box-shadow: var(--shadow-md) !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 22px !important;
}

.leaflet-control-zoom-in:hover,
.leaflet-control-zoom-out:hover {
    border-radius: var(--radius-sm) !important;
    background: linear-gradient(135deg, var(--linia-purple), var(--linia-teal)) !important;
    color: white !important;
    border-color: transparent !important;
    box-shadow: var(--shadow-lg) !important;
}

.leaflet-popup-content-wrapper {
    background: rgba(255, 255, 255, 0.85) !important;
    backdrop-filter: blur(12px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(12px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.45) !important;
    border-radius: var(--radius-md) !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12) !important;
    padding: 2px !important;
}

.leaflet-popup-tip {
    background: rgba(255, 255, 255, 0.85) !important;
    backdrop-filter: blur(12px) !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12) !important;
}

.leaflet-popup-content {
    margin: 14px 18px !important;
    font-family: var(--font-main) !important;
    font-size: 14px !important;
    font-weight: 500 !important;
    color: var(--text-primary) !important;
    line-height: 1.4 !important;
}

.leaflet-popup-content b,
.leaflet-popup-content strong {
    font-weight: 700 !important;
}

.leaflet-popup-close-button {
    padding: 8px !important;
    color: var(--text-secondary) !important;
    transition: color 0.2s ease !important;
}

.leaflet-popup-close-button:hover {
    color: var(--text-primary) !important;
    background: transparent !important;
}

::-webkit-scrollbar {
    width: 6px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
}

* {
    scrollbar-width: thin;
    scrollbar-color: var(--border-color) transparent;
}

footer {
    width: 100%;
    padding: 24px;
    text-align: center;
    color: var(--text-muted);
    font-size: 13px;
    z-index: 10;
}

footer p {
    margin-bottom: 8px;
    font-style: italic;
}

.color-bar-signature {
    height: 4px;
    width: 100%;
    max-width: 250px;
    margin: 0 auto;
    border-radius: 2px;
    background: linear-gradient(to right,
            #8B5CF6 0%,
            #8B5CF6 20%,
            #3B82F6 20%,
            #3B82F6 40%,
            #22C55E 40%,
            #22C55E 60%,
            #FFDB59 60%,
            #FFDB59 80%,
            #EF4444 80%,
            #EF4444 100%);
}

@media (max-width: 640px) {
    .welcome-line {
        font-size: 20px;
        height: 32px;
    }

    .brand-name {
        font-size: 40px;
    }

    .landing-search-bar {
        font-size: 15px;
        padding: 12px 48px 12px 16px;
    }

    .map-search-bar-container {
        top: 12px;
        width: 92%;
    }

    .map-search-input {
        padding: 10px 44px 10px 14px;
        font-size: 14px;
    }

    .route-panel {
        max-height: 55vh;
    }

    .about-nav {
        padding: 12px 16px;
    }

    .about-content {
        padding: 32px 16px 80px;
    }

    .about-content h1 {
        font-size: 24px;
    }

    .about-content h2 {
        font-size: 18px;
    }

    .toast-container {
        bottom: 16px;
        right: 12px;
        left: 12px;
    }

    .toast {
        max-width: 100%;
    }

    .planner-sidebar {
        position: fixed;
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        max-height: 45vh;
        border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .planner-connected-panel {
        position: fixed;
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        max-height: 50vh;
        border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .planner-search-container {
        width: 92%;
        top: 12px;
    }
}

.planner-footer-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 10px;
    border-radius: var(--radius-sm);
    transition: all 0.2s ease;
}

.planner-footer-btn:hover {
    background-color: var(--bg-hover);
    color: var(--text-primary);
}

.planner-footer-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

.planner-footer-divider {
    width: 1px;
    height: 24px;
    background-color: var(--border-light);
    margin: 0 8px;
}

.bottom-nav {
    display: none;
}

@media (max-width: 768px) {

    .map-page,
    .planner-page {
        height: 100vh;
        height: 100dvh;
        overflow: hidden;
    }

    .landing-content {
        margin-top: -15vh !important;
    }

    .landing-actions {
        display: none !important;
    }

    .mobile-landing-extras {
        display: flex;
        flex-direction: column;
        width: 100%;
        margin-top: 32px;
        animation: fadeIn 0.6s ease-out;
    }

    .mobile-section-header {
        margin-bottom: 12px;
    }

    .mobile-section-header h3 {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .mobile-recents-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .recent-item {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 14px;
        background: var(--bg-white);
        border-radius: 12px;
        border: 1px solid var(--border-light);
        color: var(--text-primary);
        font-size: 15px;
        cursor: pointer;
    }

    .recent-item svg {
        color: var(--text-muted);
    }

    .empty-recents {
        text-align: center;
        padding: 20px;
        color: var(--text-muted);
        font-size: 14px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 12px;
        border: 1px dashed var(--border-light);
    }

    .bottom-nav {
        display: flex;
        justify-content: space-around;
        align-items: center;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 64px;
        background-color: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        border-top: 1px solid var(--border-light);
        z-index: 10000;
        padding-bottom: env(safe-area-inset-bottom);
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1) !important;
    }

    .bottom-nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        color: var(--text-secondary);
        font-size: 11px;
        flex: 1;
        height: 100%;
    }

    .bottom-nav-item.active {
        color: var(--linia-orange);
    }

    .bottom-nav-item svg {
        margin-bottom: 4px;
    }

    .map-search-bar-container,
    .planner-search-container {
        top: 10px !important;
        width: 94% !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        z-index: 1001 !important;
        margin-left: 0 !important;
    }

    .landing-search-bar,
    .map-search-bar,
    .planner-search-bar {
        padding-left: 20px !important;
    }

    .lang-switcher-btn {
        display: none !important;
    }

    .landing-page .lang-switcher-btn {
        position: fixed !important;
        left: auto !important;
        right: 15px !important;
        top: 15px !important;
        transform: none !important;
        background: white !important;
        box-shadow: var(--shadow-md) !important;
        border-radius: 50% !important;
        width: 40px !important;
        height: 40px !important;
        z-index: 10002 !important;
        display: flex !important;
    }

    .route-panel,
    .trip-details-panel,
    .planner-sidebar,
    .planner-connected-panel {
        position: fixed !important;
        top: auto !important;
        bottom: 64px !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        max-width: none !important;
        max-height: none !important;
        border-radius: 24px 24px 0 0 !important;
        box-shadow: 0 -8px 24px rgba(0, 0, 0, 0.15) !important;
        background: white !important;
        transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1) !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }

    .planner-sidebar {
        height: 60vh !important;
        z-index: 1002 !important;
        transform: translateY(115%) !important;
        display: flex !important;
        flex-direction: column !important;
    }

    .planner-sidebar.visible {
        transform: translateY(0) !important;
    }

    .planner-connected-panel {
        height: 75vh;
        z-index: 1010 !important;
        transform: translateY(115%);
        display: flex !important;
    }

    .route-panel,
    .trip-details-panel {
        height: 50vh;
        z-index: 1004 !important;
        transform: translateY(115%);
    }

    .planner-connected-panel.visible,
    .route-panel.visible,
    .trip-details-panel.visible {
        transform: translateY(0) !important;
        display: flex !important;
    }

    .route-panel-header,
    .trip-details-header,
    .planner-sidebar-header,
    .planner-connected-header {
        touch-action: none;
        /* Prevents pull-to-refresh on mobile */
    }

    .drag-handle {

        width: 40px;
        height: 4px;
        background-color: var(--border-medium, #CBD5E1);
        border-radius: 4px;
        margin: 12px auto;
        cursor: grab;
        touch-action: none;
        /* Prevents pull-to-refresh and scrolling on mobile */
    }

    .drag-handle:active {
        cursor: grabbing;
    }



    .planner-sidebar-body {
        max-height: none;
    }


    .planner-sidebar-footer {
        padding: 12px 20px 20px;
        background: white;
        border-top: 1px solid var(--border-light);
    }

    .reopen-panel-btn {
        top: auto !important;
        bottom: 74px !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        width: 50px !important;
        height: 38px !important;
        background: var(--bg-white) !important;
        color: var(--text-secondary) !important;
        border: 2px solid var(--flix-green-accent) !important;
        border-radius: 20px !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
        z-index: 1005 !important;
        animation: search-glow-dynamic 5s ease-in-out infinite !important;
        display: none;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease !important;
    }

    .reopen-panel-btn svg,
    .reopen-trip-panel-btn svg {
        transform: rotate(0deg);
    }


    .map-home-btn,
    .map-planner-btn,
    .linia-nav-btn,
    footer,
    .app-footer,
    .nav-link {
        display: none !important;
    }
}

@media (max-width: 768px) {
    .nav-btn-home {
        top: 70px !important;
        right: 16px !important;
        display: flex !important;
    }

    .nav-btn-planner {
        top: 122px !important;
        right: 16px !important;
        display: flex !important;
    }

    .reopen-trip-panel-btn {
        top: 174px !important;
        right: 16px !important;
        display: none;
        /* Controlled by JS but style must be correct */
        align-items: center !important;
        justify-content: center !important;
    }

    .leaflet-top.leaflet-left {

        top: 50px !important;
    }

    .planner-bubble {
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--bg-white);
        border: 2px solid var(--flix-green-accent);
        border-radius: 0.5em;
        /* Match search bars */
        padding: 10px 20px;
        box-shadow: var(--shadow-lg);
        display: flex;
        align-items: center;
        gap: 12px;
        z-index: 1005;
        font-weight: 600;
        color: var(--text-primary);
        font-size: 14px;
        white-space: nowrap;
        animation: search-glow-dynamic 5s ease-in-out infinite;
    }

    .planner-bubble-content {
        cursor: pointer;
    }

    .nav-btn-reopen-connected {
        top: 122px !important;
        right: 16px !important;
        /* display: flex !important is set by JS when visible */
    }
}


.lang-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    z-index: 100000;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.lang-modal-overlay.show {
    opacity: 1;
    pointer-events: all;
}



.lang-menu {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -45%);
    width: 90%;
    max-width: 600px;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: 30px;
    padding: 30px;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 15px;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
    z-index: 100001;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}

.lang-menu.show {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -50%);
    pointer-events: all;
}

.lang-option {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    border: 1px solid rgba(0, 0, 0, 0.05);
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 13px;
    font-weight: 700;
    color: var(--text-secondary);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
}

.lang-option:hover {
    transform: scale(1.1);
    background: var(--bg-light);
    color: var(--text-primary);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
}

.lang-option.active {
    background: var(--flix-green-accent);
    color: white;
    border-color: var(--flix-green-accent);
    box-shadow: 0 6px 15px rgba(115, 215, 0, 0.4);
}

@media (max-width: 768px) {
    .lang-modal-overlay {
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
    }

    .lang-menu {
        width: 100vw !important;
        height: 100vh !important;
        max-width: none !important;
        max-height: none !important;
        top: 0 !important;
        left: 0 !important;
        transform: none !important;
        border-radius: 0 !important;
        padding: 60px 20px !important;
        background: rgba(255, 255, 255, 0.6) !important;
        gap: 20px;
    }

    .lang-menu.show {
        transform: none !important;
    }

    .lang-option {
        width: 65px;
        height: 65px;
        font-size: 18px;
        background: white;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .landing-page .lang-switcher-btn {
        position: fixed !important;
        right: 15px !important;
        top: 15px !important;
        left: auto !important;
        display: flex !important;
        z-index: 100002 !important;
        background: white !important;
        color: var(--text-primary) !important;
        border-radius: 50%;
        width: 44px;
        height: 44px;
        box-shadow: var(--shadow-md);
    }
}

.planner-suggestion-marker {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 0 4px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.planner-suggestion-marker:hover {
    transform: scale(1.5);
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
    z-index: 1000;
}

.suggestion-marker-flix {
    background-color: var(--flix-green-accent);
}

.suggestion-marker-blabla {
    background-color: var(--blablacar-blue-accent);
}

.suggestion-marker-both {
    background: linear-gradient(135deg, var(--flix-green-accent), var(--blablacar-blue-accent));
}

.planner-mixed-polyline {
    stroke: url(#mixedGradient) !important;
}

.planner-disclaimer {
    margin: 16px;
    padding: 1.2em;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-md);
    display: flex;
    flex-direction: column;
    gap: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.disclaimer-header {
    display: flex;
    align-items: center;
    gap: 6px;
    color: var(--text-primary);
    opacity: 0.9;
}

.disclaimer-header svg {
    flex-shrink: 0;
    color: var(--flix-green-accent);
}

.disclaimer-header strong {
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.disclaimer-title-group {
    display: flex;
    align-items: center;
    gap: 6px;
}

.disclaimer-toggle {
    background: var(--bg-light);
    border: 1px solid var(--border-light);
    color: var(--text-secondary);
    width: 24px;
    height: 24px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 0;
}

.disclaimer-toggle:hover {
    background: #e1e4e8;
    color: var(--text-primary);
}

.disclaimer-content-wrapper {
    max-height: 200px;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0, 1, 0, 1);
}

.planner-disclaimer.collapsed .disclaimer-content-wrapper {
    max-height: 0;
}

.planner-disclaimer.collapsed {
    padding-bottom: 0.5em;
    gap: 0;
}

.planner-disclaimer p {
    font-size: 11px;
    line-height: 1.5;
    color: var(--text-secondary);
    margin: 0;
}

@media (max-width: 768px) {
    .planner-disclaimer {
        margin: 12px 20px;
        padding: 14px;
    }
}


.planner-body #loadingOverlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100vw;
    height: 100vh;
    z-index: 99999;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    border-radius: 0;
    transform: none;
    padding: 0;
    box-shadow: none;
    font-size: inherit;
    color: inherit;
}

.planner-body #loadingOverlay.visible {
    opacity: 1;
    visibility: visible;
    display: flex;
}


#loadingText {
    font-size: 16px;
    font-weight: 600;
    color: var(--linia-purple);
    letter-spacing: 0.5px;
    text-transform: uppercase;
    animation: pulseText 1.5s infinite ease-in-out;
    font-family: var(--font-main);
}

@keyframes pulseText {

    0%,
    100% {
        opacity: 0.6;
    }

    50% {
        opacity: 1;
    }
}

/* 2. Styles de la Boussole (SVG) */
.pl {
    display: block;
    width: 9.375em;
    height: 9.375em;
}

.pl__arrows,
.pl__ring-rotate,
.pl__ring-stroke,
.pl__tick {
    animation-duration: 2s;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
}

.pl__arrows {
    animation-name: arrows42;
    transform: rotate(45deg);
    transform-origin: 16px 52px;
}

.pl__ring-rotate,
.pl__ring-stroke {
    transform-origin: 80px 80px;
}

.pl__ring-rotate {
    animation-name: ringRotate42;
}

.pl__ring-stroke {
    animation-name: ringStroke42;
    transform: rotate(-45deg);
}

.pl__tick {
    animation-name: tick42;
}

.pl__tick:nth-child(2) {
    animation-delay: -1.75s;
}

.pl__tick:nth-child(3) {
    animation-delay: -1.5s;
}

.pl__tick:nth-child(4) {
    animation-delay: -1.25s;
}

.pl__tick:nth-child(5) {
    animation-delay: -1s;
}

.pl__tick:nth-child(6) {
    animation-delay: -0.75s;
}

.pl__tick:nth-child(7) {
    animation-delay: -0.5s;
}

.pl__tick:nth-child(8) {
    animation-delay: -0.25s;
}

/* 3. Keyframes des animations */
@keyframes arrows42 {
    from {
        transform: rotate(45deg);
    }

    to {
        transform: rotate(405deg);
    }
}

@keyframes ringRotate42 {
    from {
        transform: rotate(0);
    }

    to {
        transform: rotate(720deg);
    }
}

@keyframes ringStroke42 {

    from,
    to {
        stroke-dashoffset: 452;
        transform: rotate(-45deg);
    }

    50% {
        stroke-dashoffset: 169.5;
        transform: rotate(-180deg);
    }
}

@keyframes tick42 {

    from,
    3%,
    47%,
    to {
        stroke-dashoffset: -12;
    }

    14%,
    36% {
        stroke-dashoffset: 0;
    }
}

/* Confetti Notification Styles */
.confetti-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 100000;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

.confetti-overlay.visible {
    opacity: 1;
    visibility: visible;
}

.confetti-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.confetti-particle {
    position: absolute;
    top: -20px;
    opacity: 1;
    animation: confetti-fall 3s linear forwards;
}

.confetti-rect {
    border-radius: 2px;
}

.confetti-circle {
    border-radius: 50%;
}

.confetti-diamond {
    transform: rotate(45deg);
}

@keyframes confetti-fall {
    0% {
        transform: translateY(0) rotate(0deg) translateX(0);
        opacity: 1;
    }

    100% {
        transform: translateY(110vh) rotate(var(--rotation)) translateX(var(--drift));
        opacity: 0;
    }
}

.confetti-modal {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    padding: 24px 40px;
    border-radius: 24px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    transform: scale(0.8);
    transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 1px solid rgba(255, 255, 255, 0.3);
    pointer-events: auto;
}

.confetti-overlay.visible .confetti-modal {
    transform: scale(1);
}

.confetti-text {
    font-size: 20px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--linia-purple), var(--linia-teal));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    font-family: var(--font-main);
}

/* GitHub FAQ Button */
.btn-github {
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0;
    border: none;
    transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
    border-radius: 8px;
    font-weight: 700;
    padding: 2px 10px;
    font-size: 0.9em;
    line-height: 1.6;
    background: linear-gradient(110deg, var(--linia-orange), var(--linia-purple), var(--linia-teal));
    color: white !important;
    text-decoration: none !important;
    vertical-align: middle;
    margin: 0 3px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    white-space: nowrap;
    position: relative;
    top: -1px;
}

.btn-github .btn-prefix {
    max-width: 0;
    opacity: 0;
    overflow: hidden;
    display: inline-block;
    transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
    white-space: nowrap;
}

.btn-github:hover .btn-prefix {
    max-width: 200px;
    opacity: 1;
    margin-right: 6px;
}

.btn-github:hover {
    filter: brightness(1.15);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    text-decoration: none !important;
}

.btn-github svg {
    margin-right: 6px;
    fill: white;
    transition: transform 0.3s ease;
}

.btn-github:hover svg {
    transform: rotate(15deg) scale(1.1);
}

--- FIN FICHIER ---

--- DÉBUT FICHIER : templates\about.html ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\templates\about.html ---

<!DOCTYPE html>
<html lang="{{ current_lang }}">

<head>
    {% include 'seo_head.html' %}
</head>

<body>
    <div class="about-page">
        <nav class="about-nav">
            <a class="nav-brand" href="{{ url_for_page('home') }}"><span class="highlight">Linia</span></a>
            <div style="flex-grow: 1;"></div>
            <a class="nav-link" href="{{ url_for_page('home') }}" style="margin-left: 0;">{{ t('return_home') }}</a>
        </nav>

        <div class="about-content">
            <h1>{{ t('about_header') }}</h1>
            <p class="about-subtitle">{{ t('about_intro') }}</p>

            <div class="about-section">
                <h2>{{ t('about_networks') }}</h2>
                <p>{{ t('about_networks_desc') }}</p>
            </div>

            <div class="about-section">
                <h2>{{ t('about_planning') }}</h2>
                <p>{{ t('about_planning_desc') }}</p>
            </div>

            <div class="about-section">
                <h2>{{ t('about_export') }}</h2>
                <p>{{ t('about_export_desc') }}</p>
            </div>

            <div class="about-section">
                <h2>{{ t('faq_title') }}</h2>
                <div style="display: grid; gap: 10px; margin-top: 10px;">
                    <details class="faq-item"
                        style="border: 1px solid var(--border-light); border-radius: 12px; padding: 12px 14px; background: rgba(255,255,255,0.03);">
                        <summary style="cursor: pointer; font-weight: 700;">{{ t('faq_free_q') }}</summary>
                        <div style="margin-top: 8px; opacity: 0.85; line-height: 1.6;">{{ t('faq_free_a') }}</div>
                    </details>
                    <details class="faq-item"
                        style="border: 1px solid var(--border-light); border-radius: 12px; padding: 12px 14px; background: rgba(255,255,255,0.03);">
                        <summary style="cursor: pointer; font-weight: 700;">{{ t('faq_countries_q') }}</summary>
                        <div style="margin-top: 8px; opacity: 0.85; line-height: 1.6;">{{ t('faq_countries_a') }}</div>
                    </details>
                    <details class="faq-item"
                        style="border: 1px solid var(--border-light); border-radius: 12px; padding: 12px 14px; background: rgba(255,255,255,0.03);">
                        <summary style="cursor: pointer; font-weight: 700;">{{ t('faq_update_q') }}</summary>
                        <div style="margin-top: 8px; opacity: 0.85; line-height: 1.6;">{{ t('faq_update_a') }}</div>
                    </details>
                    <details class="faq-item"
                        style="border: 1px solid var(--border-light); border-radius: 12px; padding: 12px 14px; background: rgba(255,255,255,0.03);">
                        <summary style="cursor: pointer; font-weight: 700;">{{ t('faq_report_q') }}</summary>
                        <div style="margin-top: 8px; opacity: 0.85; line-height: 1.6;">
                            {% set github_btn = '<a href="https://github.com/Strakaza/linia" target="_blank"
                                class="btn-github"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M7.99992 1.33331C7.12444 1.33331 6.25753 1.50575 5.4487 1.84078C4.63986 2.17581 3.90493 2.66688 3.28587 3.28593C2.03563 4.53618 1.33325 6.23187 1.33325 7.99998C1.33325 10.9466 3.24659 13.4466 5.89325 14.3333C6.22659 14.3866 6.33325 14.18 6.33325 14C6.33325 13.8466 6.33325 13.4266 6.33325 12.8733C4.48659 13.2733 4.09325 11.98 4.09325 11.98C3.78659 11.2066 3.35325 11 3.35325 11C2.74659 10.5866 3.39992 10.6 3.39992 10.6C4.06659 10.6466 4.41992 11.2866 4.41992 11.2866C4.99992 12.3 5.97992 12 6.35992 11.84C6.41992 11.4066 6.59325 11.1133 6.77992 10.9466C5.29992 10.78 3.74659 10.2066 3.74659 7.66665C3.74659 6.92665 3.99992 6.33331 4.43325 5.85998C4.36659 5.69331 4.13325 4.99998 4.49992 4.09998C4.49992 4.09998 5.05992 3.91998 6.33325 4.77998C6.85992 4.63331 7.43325 4.55998 7.99992 4.55998C8.56659 4.55998 9.13992 4.63331 9.66659 4.77998C10.9399 3.91998 11.4999 4.09998 11.4999 4.09998C11.8666 4.99998 11.6333 5.69331 11.5666 5.85998C11.9999 6.33331 12.2533 6.92665 12.2533 7.66665C12.2533 10.2133 10.6933 10.7733 9.20659 10.94C9.44659 11.1466 9.66659 11.5533 9.66659 12.1733C9.66659 13.0666 9.66659 13.7866 9.66659 14C9.66659 14.18 9.77325 14.3933 10.1133 14.3333C12.7599 13.44 14.6666 10.9466 14.6666 7.99998C14.6666 7.1245 14.4941 6.25759 14.1591 5.44876C13.8241 4.63992 13.333 3.90499 12.714 3.28593C12.0949 2.66688 11.36 2.17581 10.5511 1.84078C9.7423 1.50575 8.8754 1.33331 7.99992 1.33331V1.33331Z"
                                        fill="currentColor"></path>
                                </svg><span class="btn-prefix">' ~ t('github_hover_prefix') ~ '</span>
                                <span>GitHub</span></a>' %}
                            {{ t('faq_report_a', github=github_btn) | safe }}
                        </div>
                    </details>
                </div>
            </div>

            <div class="download-card">
                <h3>{{ t('data_sources') }}</h3>
                <p>{{ t('data_sources_desc') }}</p>
                <a class="linia-btn-premium" download="" href="{{ url_for('download_unified_gtfs') }}"
                    style="margin-top: 20px; width: 100%;">
                    <svg fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" width="20">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" x2="12" y1="15" y2="3"></line>
                    </svg>
                    <span>{{ t('download_gtfs') }}</span>
                </a>
            </div>

            <footer class="linia-footer">
                <div class="linia-disclaimer-card">
                    <p class="disclaimer-text">{{ t('disclaimer_text') }}</p>
                    <div class="card-footer-links">
                        <a href="{{ url_for_page('legal') }}" class="legal-link">{{ t('nav_legal') }}</a>
                    </div>
                </div>
                <div class="footer-signature-container">
                    <a href="https://strakaza.fr" class="signature-link">{{ t('footer_signature') }}</a>
                    <div class="color-bar-signature"></div>
                </div>
            </footer>

            <nav class="bottom-nav">
                <a class="bottom-nav-item" href="{{ url_for_page('home') }}">
                    <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" width="24">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span>{{ t('nav_home') }}</span>
                </a>
                <a class="bottom-nav-item" href="{{ url_for_page('planner') }}">
                    <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" width="24">
                        <circle cx="6" cy="19" r="3"></circle>
                        <path d="M9 19h8.5a3.5 3.5 0 1 0 0-7h-11a3.5 3.5 0 1 1 0-7H15"></path>
                        <circle cx="18" cy="5" r="3"></circle>
                    </svg>
                    <span>{{ t('nav_itinerary') }}</span>
                </a>
                <a class="bottom-nav-item active" href="{{ url_for_page('about') }}">
                    <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" width="24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" x2="12" y1="16" y2="12"></line>
                        <line x1="12" x2="12.01" y1="8" y2="8"></line>
                    </svg>
                    <span>{{ t('nav_info') }}</span>
                </a>
            </nav>
        </div>
</body>

</html>

--- FIN FICHIER ---

--- DÉBUT FICHIER : templates\hreflang.html ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\templates\hreflang.html ---

{% if hreflang_urls %}
    {% for code, url in hreflang_urls.items() %}
        {% if code == 'x-default' %}
<link rel="alternate" hreflang="x-default" href="{{ url }}">
        {% else %}
<link rel="alternate" hreflang="{{ code }}" href="{{ url }}">
        {% endif %}
    {% endfor %}
{% endif %}



--- FIN FICHIER ---

--- DÉBUT FICHIER : templates\landing.html ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\templates\landing.html ---

<!DOCTYPE html>
<html lang="{{ current_lang }}">

<head>
    {% include 'seo_head.html' %}
    <link crossorigin="" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" rel="stylesheet" />
</head>

<body>
    <div class="landing-page">
        <div class="landing-map-bg" id="landingMap"></div>
        <div class="landing-map-overlay"></div>

        <div class="landing-content">
            <div class="landing-text-block">
                <div class="welcome-line">
                    <span class="cycling-text" id="cyclingText">{{ t('welcome') }}</span>
                </div>
                <h1 class="brand-name"><span class="highlight">Linia</span></h1>
            </div>

            <div class="landing-search-container">
                <div class="landing-search-wrapper">
                    <button class="lang-switcher-btn" id="langSwitcher" title="Changer la langue">
                        <svg fill="none" height="20" stroke="currentColor" stroke-linecap="round"
                            stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="2" x2="22" y1="12" y2="12"></line>
                            <path
                                d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                            </path>
                        </svg>
                    </button>

                    <input autocomplete="off" class="landing-search-bar" id="landingSearchInput"
                        placeholder="{{ t('search_placeholder') }}" type="text" />

                    <svg class="landing-search-icon" fill="none" height="20" id="landingSearchIcon"
                        stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        viewBox="0 0 24 24" width="20">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" x2="16.65" y1="21" y2="16.65"></line>
                    </svg>
                    <div class="spinner landing-search-spinner" id="landingSearchSpinner" style="display:none;"></div>
                </div>
                <div class="landing-suggestions" id="landingSuggestions"></div>
            </div>

            <div class="landing-actions">
                <a class="planner-launch-btn landing-action-btn linia-btn-premium" href="{{ url_for_page('planner') }}">
                    <svg fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" width="16">
                        <circle cx="12" cy="10" r="3"></circle>
                        <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z"></path>
                    </svg>
                    <span>{{ t('btn_planner') }}</span>
                </a>
                <a class="how-it-works-btn landing-action-btn linia-btn-premium" href="{{ url_for_page('about') }}">
                    <svg fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" width="16">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" x2="12" y1="16" y2="12"></line>
                        <line x1="12" x2="12.01" y1="8" y2="8"></line>
                    </svg>
                    <span>{{ t('btn_how') }}</span>
                </a>
            </div>

            <div class="mobile-landing-extras">
                <div class="mobile-section-header">
                    <h3>{{ t('recent_searches') }}</h3>
                </div>
                <div class="mobile-recents-list" id="recentSearchesList">
                </div>
            </div>

            <nav class="bottom-nav">
                <a class="bottom-nav-item active" href="{{ url_for_page('home') }}">
                    <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" width="24">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span>{{ t('nav_home') }}</span>
                </a>
                <a class="bottom-nav-item" href="{{ url_for_page('planner') }}">
                    <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" width="24">
                        <circle cx="6" cy="19" r="3"></circle>
                        <path d="M9 19h8.5a3.5 3.5 0 1 0 0-7h-11a3.5 3.5 0 1 1 0-7H15"></path>
                        <circle cx="18" cy="5" r="3"></circle>
                    </svg>
                    <span>{{ t('nav_itinerary') }}</span>
                </a>
                <a class="bottom-nav-item" href="{{ url_for_page('about') }}">
                    <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" width="24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" x2="12" y1="16" y2="12"></line>
                        <line x1="12" x2="12.01" y1="8" y2="8"></line>
                    </svg>
                    <span>{{ t('nav_info') }}</span>
                </a>
            </nav>
        </div>
    </div>

    <footer class="linia-footer landing-footer">
        <div class="linia-info-wrapper">
            <button class="linia-info-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                    stroke-linejoin="round" width="18" height="18">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
            </button>

            <div class="linia-info-tooltip">
                <div class="tooltip-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                        stroke-linejoin="round" width="16" height="16">
                        <path
                            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                        </path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    <h3>Important</h3>
                </div>
                <p>{{ t('disclaimer_text') }}</p>
                <div class="tooltip-footer">
                    <a href="{{ url_for_page('legal') }}" class="tooltip-legal-link">
                        {{ t('nav_legal') }} &rarr;
                    </a>
                </div>
            </div>
        </div>
        <div class="footer-signature-container">
            <a href="https://strakaza.fr" class="signature-link">{{ t('footer_signature') }}</a>
            <div class="color-bar-signature"></div>
        </div>
    </footer>

    <script crossorigin="" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cities = [
                { name: "'s-Hertogenbosch", center: [51.69917, 5.30417] },
                { name: "A Coruña", center: [43.37135, -8.396] },
                { name: "Aachen", center: [50.77664, 6.08342] },
                { name: "Aalborg", center: [57.048, 9.9187] },
                { name: "Aberdeen", center: [57.14369, -2.09814] },
                { name: "Acilia-Castel Fusano-Ostia Antica", center: [41.76337, 12.33078] },
                { name: "Adana", center: [36.98615, 35.32531] },
                { name: "Adapazarı", center: [40.78056, 30.40333] },
                { name: "Adıyaman", center: [37.76441, 38.27629] },
                { name: "Afyonkarahisar", center: [38.75667, 30.54333] },
                { name: "Aix-en-Provence", center: [43.5283, 5.44973] },
                { name: "Aksaray", center: [38.37255, 34.02537] },
                { name: "Alanya", center: [36.54375, 31.99982] },
                { name: "Albacete", center: [38.99424, -1.85643] },
                { name: "Alcalá de Henares", center: [40.48205, -3.35996] },
                { name: "Alchevsk", center: [48.46893, 38.81669] },
                { name: "Alcobendas", center: [40.54746, -3.64197] },
                { name: "Alcorcón", center: [40.34582, -3.82487] },
                { name: "Algeciras", center: [36.13326, -5.45051] },
                { name: "Alicante", center: [38.34517, -0.48149] },
                { name: "Almere Stad", center: [52.37025, 5.21413] },
                { name: "Almería", center: [36.83814, -2.45974] },
                { name: "Altona", center: [53.55, 9.93333] },
                { name: "Amadora", center: [38.75382, -9.23083] },
                { name: "Amasya", center: [40.65333, 35.83306] },
                { name: "Amersfoort", center: [52.155, 5.3875] },
                { name: "Amiens", center: [49.9, 2.3] },
                { name: "Amsterdam", center: [52.37403, 4.88969] },
                { name: "Anderlecht", center: [50.83619, 4.31454] },
                { name: "Angers", center: [47.47156, -0.55202] },
                { name: "Ankara", center: [39.91987, 32.85427] },
                { name: "Antakya", center: [36.20655, 36.15722] },
                { name: "Antalya", center: [36.90812, 30.69556] },
                { name: "Antwerpen", center: [51.22047, 4.40026] },
                { name: "Apeldoorn", center: [52.21, 5.96944] },
                { name: "Arad", center: [46.18333, 21.31667] },
                { name: "Archway", center: [51.56733, -0.13415] },
                { name: "Arezzo", center: [43.46276, 11.88068] },
                { name: "Arganzuela", center: [40.40021, -3.69618] },
                { name: "Argenteuil", center: [48.94788, 2.24744] },
                { name: "Arnavutköy", center: [41.18355, 28.7402] },
                { name: "Arnhem", center: [51.98, 5.91111] },
                { name: "Ataşehir", center: [40.9833, 29.1167] },
                { name: "Athens", center: [37.98376, 23.72784] },
                { name: "Augsburg", center: [48.37154, 10.89851] },
                { name: "Aydın", center: [37.84501, 27.83963] },
                { name: "Ağrı", center: [39.71467, 43.04015] },
                { name: "Bacău", center: [46.56718, 26.91384] },
                { name: "Badajoz", center: [38.87789, -6.97061] },
                { name: "Badalona", center: [41.45004, 2.24741] },
                { name: "Bahçelievler", center: [41.00231, 28.8598] },
                { name: "Baia Mare", center: [47.65729, 23.56808] },
                { name: "Balıkesir", center: [39.64917, 27.88611] },
                { name: "Bandırma", center: [40.35222, 27.97667] },
                { name: "Banja Luka", center: [44.77842, 17.19386] },
                { name: "Barakaldo", center: [43.29639, -2.98813] },
                { name: "Barcelona", center: [41.38879, 2.15899] },
                { name: "Bari", center: [41.12066, 16.86982] },
                { name: "Basel", center: [47.55839, 7.57327] },
                { name: "Basildon", center: [51.56844, 0.45782] },
                { name: "Basingstoke", center: [51.26249, -1.08708] },
                { name: "Bath", center: [51.3751, -2.36172] },
                { name: "Batikent", center: [39.96833, 32.73083] },
                { name: "Batman", center: [37.88738, 41.13221] },
                { name: "Bağcılar", center: [41.03903, 28.85671] },
                { name: "Başakşehir", center: [41.106, 28.791] },
                { name: "Bedford", center: [52.13459, -0.46632] },
                { name: "Belfast", center: [54.59682, -5.92541] },
                { name: "Belgrade", center: [44.80401, 20.46513] },
                { name: "Bemowo", center: [52.2546, 20.90844] },
                { name: "Bender", center: [46.83156, 29.47769] },
                { name: "Berdyansk", center: [46.75578, 36.78815] },
                { name: "Bergamo", center: [45.69601, 9.66721] },
                { name: "Bergedorf", center: [53.48462, 10.22904] },
                { name: "Bergen", center: [60.39299, 5.32415] },
                { name: "Bergisch Gladbach", center: [50.9856, 7.13298] },
                { name: "Berlin", center: [52.52437, 13.41053] },
                { name: "Bern", center: [46.94809, 7.44744] },
                { name: "Besançon", center: [47.24878, 6.01815] },
                { name: "Bexley", center: [51.44162, 0.14866] },
                { name: "Beylikdüzü", center: [40.982, 28.6399] },
                { name: "Białołeka", center: [52.32127, 20.97204] },
                { name: "Białystok", center: [53.13333, 23.16433] },
                { name: "Bielany", center: [52.29242, 20.93531] },
                { name: "Bielefeld", center: [52.03333, 8.53333] },
                { name: "Bielsko-Biala", center: [49.82245, 19.04686] },
                { name: "Bila Tserkva", center: [49.8004, 30.12851] },
                { name: "Bilbao", center: [43.26271, -2.92528] },
                { name: "Bingöl", center: [38.88472, 40.49389] },
                { name: "Birkenhead", center: [53.39337, -3.01479] },
                { name: "Birmingham", center: [52.48142, -1.89983] },
                { name: "Blackburn", center: [53.75, -2.48333] },
                { name: "Blackpool", center: [53.81667, -3.05] },
                { name: "Bochum", center: [51.48165, 7.21648] },
                { name: "Bologna", center: [44.49381, 11.33875] },
                { name: "Bolton", center: [53.58333, -2.43333] },
                { name: "Bolu", center: [40.73583, 31.60611] },
                { name: "Bolzano", center: [46.49067, 11.33982] },
                { name: "Bonn", center: [50.73438, 7.09549] },
                { name: "Bordeaux", center: [44.84044, -0.5805] },
                { name: "Bottrop", center: [51.52392, 6.9285] },
                { name: "Boulogne-Billancourt", center: [48.83545, 2.24128] },
                { name: "Bournemouth", center: [50.72048, -1.8795] },
                { name: "Bradford", center: [53.79391, -1.75206] },
                { name: "Braga", center: [41.55032, -8.42005] },
                { name: "Bratislava", center: [48.14816, 17.10674] },
                { name: "Braunschweig", center: [52.26594, 10.52673] },
                { name: "Braşov", center: [45.64861, 25.60613] },
                { name: "Breda", center: [51.58656, 4.77596] },
                { name: "Bremen", center: [53.07582, 8.80717] },
                { name: "Bremerhaven", center: [53.55357, 8.57553] },
                { name: "Brent", center: [51.55306, -0.3023] },
                { name: "Brescia", center: [45.53558, 10.21472] },
                { name: "Brest", center: [48.39029, -4.48628] },
                { name: "Brighton", center: [50.82838, -0.13947] },
                { name: "Bristol", center: [51.45523, -2.59665] },
                { name: "Brno", center: [49.19522, 16.60796] },
                { name: "Brovary", center: [50.51809, 30.80671] },
                { name: "Brugge", center: [51.20892, 3.22424] },
                { name: "Brussels", center: [50.85045, 4.34878] },
                { name: "Brăila", center: [45.27152, 27.97429] },
                { name: "Bucharest", center: [44.43225, 26.10626] },
                { name: "Budapest", center: [47.49835, 19.04045] },
                { name: "Budapest III. kerület", center: [47.54157, 19.04501] },
                { name: "Budapest XI. kerület", center: [47.47603, 19.03605] },
                { name: "Budapest XIII. kerület", center: [47.52978, 19.08068] },
                { name: "Burgas", center: [42.50606, 27.46781] },
                { name: "Burgos", center: [42.34106, -3.70184] },
                { name: "Burnley", center: [53.8, -2.23333] },
                { name: "Bursa", center: [40.19559, 29.06013] },
                { name: "Burton upon Trent", center: [52.80728, -1.64263] },
                { name: "Buzău", center: [45.15, 26.83333] },
                { name: "Bydgoszcz", center: [53.1235, 18.00762] },
                { name: "Bytom", center: [50.34802, 18.93282] },
                { name: "Büyükçekmece", center: [41.02072, 28.58502] },
                { name: "Bălţi", center: [47.76314, 27.92932] },
                { name: "Cadiz", center: [36.52672, -6.2891] },
                { name: "Caen", center: [49.18585, -0.35912] },
                { name: "Cagliari", center: [39.23054, 9.11917] },
                { name: "Cambridge", center: [52.2, 0.11667] },
                { name: "Carabanchel", center: [40.39094, -3.7242] },
                { name: "Cardiff", center: [51.48, -3.18] },
                { name: "Cartagena", center: [37.60197, -0.98397] },
                { name: "Castelló de la Plana", center: [39.98567, -0.04935] },
                { name: "Catania", center: [37.49223, 15.07041] },
                { name: "Cergy-Pontoise", center: [49.03894, 2.07805] },
                { name: "Chamartín", center: [40.46206, -3.6766] },
                { name: "Chamberí", center: [40.43404, -3.70379] },
                { name: "Charleroi", center: [50.41136, 4.44448] },
                { name: "Charlottenburg", center: [52.51667, 13.28333] },
                { name: "Chelmsford", center: [51.73575, 0.46958] },
                { name: "Cheltenham", center: [51.90006, -2.07972] },
                { name: "Chemnitz", center: [50.8357, 12.92922] },
                { name: "Cherkasy", center: [49.44452, 32.05738] },
                { name: "Chernihiv", center: [51.50541, 31.28656] },
                { name: "Chernivtsi", center: [48.29045, 25.93241] },
                { name: "Chesterfield", center: [53.25, -1.41667] },
                { name: "Chisinau", center: [47.00902, 28.85938] },
                { name: "Chorzów", center: [50.30582, 18.9742] },
                { name: "City of Westminster", center: [51.4975, -0.1357] },
                { name: "Ciudad Lineal", center: [40.44505, -3.65132] },
                { name: "Ciutat Vella", center: [41.38022, 2.17319] },
                { name: "Clermont-Ferrand", center: [45.77969, 3.08682] },
                { name: "Cluj-Napoca", center: [46.76667, 23.6] },
                { name: "Coimbra", center: [40.20564, -8.41955] },
                { name: "Colchester", center: [51.88921, 0.90421] },
                { name: "Constanţa", center: [44.18073, 28.63432] },
                { name: "Copenhagen", center: [55.67594, 12.56553] },
                { name: "Cork", center: [51.89797, -8.47061] },
                { name: "Coventry", center: [52.40656, -1.51217] },
                { name: "Craiova", center: [44.31667, 23.8] },
                { name: "Crawley", center: [51.11303, -0.18312] },
                { name: "Croydon", center: [51.38333, -0.1] },
                { name: "Częstochowa", center: [50.79646, 19.12409] },
                { name: "Córdoba", center: [37.89155, -4.77275] },
                { name: "Dagenham", center: [51.55, 0.16667] },
                { name: "Darmstadt", center: [49.87167, 8.65027] },
                { name: "Debrecen", center: [47.53167, 21.62444] },
                { name: "Delicias", center: [41.64928, -0.90757] },
                { name: "Denizli", center: [37.77417, 29.0875] },
                { name: "Derby", center: [52.92277, -1.47663] },
                { name: "Derince", center: [40.75694, 29.81472] },
                { name: "Dijon", center: [47.31667, 5.01667] },
                { name: "Diyarbakır", center: [37.91363, 40.21721] },
                { name: "Dnipro", center: [48.46664, 35.04066] },
                { name: "Donaustadt", center: [48.2333, 16.46002] },
                { name: "Doncaster", center: [53.52285, -1.13116] },
                { name: "Donetsk", center: [48.023, 37.80224] },
                { name: "Donostia / San Sebastián", center: [43.31283, -1.97499] },
                { name: "Dordrecht", center: [51.81, 4.67361] },
                { name: "Dortmund", center: [51.51494, 7.466] },
                { name: "Dos Hermanas", center: [37.28287, -5.92088] },
                { name: "Drammen", center: [59.74389, 10.20449] },
                { name: "Dresden", center: [51.05089, 13.73832] },
                { name: "Dublin", center: [53.33306, -6.24889] },
                { name: "Dudley", center: [52.5, -2.08333] },
                { name: "Duisburg", center: [51.43247, 6.76516] },
                { name: "Dundee", center: [56.46913, -2.97489] },
                { name: "Durrës", center: [41.32355, 19.45469] },
                { name: "Düsseldorf", center: [51.22172, 6.77616] },
                { name: "Düzce", center: [40.83889, 31.16389] },
                { name: "Dąbrowa Górnicza", center: [50.33394, 19.20479] },
                { name: "East Helsinki", center: [60.21043, 25.08289] },
                { name: "Eastbourne", center: [50.76871, 0.28453] },
                { name: "Edinburgh", center: [55.95206, -3.19648] },
                { name: "Edirne", center: [41.67719, 26.55597] },
                { name: "Eimsbüttel", center: [53.57416, 9.95679] },
                { name: "Eindhoven", center: [51.44083, 5.47778] },
                { name: "Eixample", center: [41.38896, 2.16179] },
                { name: "Elazığ", center: [38.67431, 39.22321] },
                { name: "Elbasan", center: [41.1125, 20.08222] },
                { name: "Elbląg", center: [54.1522, 19.40884] },
                { name: "Elche", center: [38.26218, -0.70107] },
                { name: "Enfield Town", center: [51.65147, -0.08497] },
                { name: "Enschede", center: [52.21833, 6.89583] },
                { name: "Erfurt", center: [50.9787, 11.03283] },
                { name: "Erlangen", center: [49.59099, 11.00783] },
                { name: "Erzincan", center: [39.73919, 39.49015] },
                { name: "Erzurum", center: [39.90861, 41.27694] },
                { name: "Esenler", center: [41.0435, 28.87619] },
                { name: "Esenyurt", center: [41.02697, 28.67732] },
                { name: "Eskişehir", center: [39.77667, 30.52056] },
                { name: "Espoo", center: [60.2052, 24.6522] },
                { name: "Essen", center: [51.45657, 7.01228] },
                { name: "Exeter", center: [50.7236, -3.52751] },
                { name: "Favoriten", center: [48.16116, 16.38233] },
                { name: "Ferrara", center: [44.83804, 11.62057] },
                { name: "Florence", center: [43.77925, 11.24626] },
                { name: "Floridsdorf", center: [48.25, 16.4] },
                { name: "Foggia", center: [41.45845, 15.55188] },
                { name: "Forlì", center: [44.22177, 12.04144] },
                { name: "Frankfurt am Main", center: [50.11552, 8.68417] },
                { name: "Freiburg", center: [47.9959, 7.85222] },
                { name: "Friedrichshain", center: [52.51559, 13.45482] },
                { name: "Fuencarral", center: [40.5, -3.68333] },
                { name: "Fuencarral-El Pardo", center: [40.4984, -3.7314] },
                { name: "Fuenlabrada", center: [40.28419, -3.79415] },
                { name: "Funchal", center: [32.66568, -16.92547] },
                { name: "Fürth", center: [49.47593, 10.98856] },
                { name: "Galaţi", center: [45.43687, 28.05028] },
                { name: "Gasteiz / Vitoria", center: [42.84998, -2.67268] },
                { name: "Gaziantep", center: [37.05944, 37.3825] },
                { name: "Gdańsk", center: [54.35227, 18.64912] },
                { name: "Gdynia", center: [54.51889, 18.53188] },
                { name: "Gebze", center: [40.80276, 29.43068] },
                { name: "Gelsenkirchen", center: [51.50508, 7.09654] },
                { name: "Genoa", center: [44.40478, 8.94439] },
                { name: "Gent", center: [51.05, 3.71667] },
                { name: "Genève", center: [46.20222, 6.14569] },
                { name: "Gera", center: [50.88029, 12.08187] },
                { name: "Getafe", center: [40.30571, -3.73295] },
                { name: "Gijón", center: [43.53573, -5.66152] },
                { name: "Gillingham", center: [51.38914, 0.54863] },
                { name: "Giresun", center: [40.91698, 38.38741] },
                { name: "Girona", center: [41.98311, 2.82493] },
                { name: "Glasgow", center: [55.86515, -4.25763] },
                { name: "Gliwice", center: [50.29761, 18.67658] },
                { name: "Gloucester", center: [51.86568, -2.2431] },
                { name: "Gorzów Wielkopolski", center: [52.73679, 15.22878] },
                { name: "Granada", center: [37.18817, -3.60667] },
                { name: "Graz", center: [47.06667, 15.45] },
                { name: "Grenoble", center: [45.17869, 5.71479] },
                { name: "Groningen", center: [53.21917, 6.56667] },
                { name: "Gràcia", center: [41.40237, 2.15641] },
                { name: "Győr", center: [47.68333, 17.63512] },
                { name: "Göteborg", center: [57.70716, 11.96679] },
                { name: "Göttingen", center: [51.53443, 9.93228] },
                { name: "Haarlem", center: [52.38084, 4.63683] },
                { name: "Hagen", center: [51.36081, 7.47168] },
                { name: "Halle (Saale)", center: [51.48158, 11.97947] },
                { name: "Hamburg", center: [53.55073, 9.99302] },
                { name: "Hamburg-Mitte", center: [53.55, 10.01667] },
                { name: "Hamburg-Nord", center: [53.58935, 9.984] },
                { name: "Hamm", center: [51.68033, 7.82089] },
                { name: "Hannover", center: [52.37052, 9.73322] },
                { name: "Harburg", center: [53.46057, 9.98388] },
                { name: "Harrow", center: [51.57835, -0.33208] },
                { name: "Hastings", center: [50.85568, 0.58009] },
                { name: "Heidelberg", center: [49.40768, 8.69079] },
                { name: "Heilbronn", center: [49.13995, 9.22054] },
                { name: "Helsingborg", center: [56.04673, 12.69437] },
                { name: "Helsinki", center: [60.16952, 24.93545] },
                { name: "Hengelo", center: [52.26583, 6.79306] },
                { name: "Herne", center: [51.5388, 7.22572] },
                { name: "High Wycombe", center: [51.62907, -0.74934] },
                { name: "Hildesheim", center: [52.15077, 9.95112] },
                { name: "Hoofddorp", center: [52.3025, 4.68889] },
                { name: "Horlivka", center: [48.33576, 38.05325] },
                { name: "Horta-Guinardó", center: [41.41849, 2.1677] },
                { name: "Hortaleza", center: [40.47444, -3.6411] },
                { name: "Huddersfield", center: [53.64904, -1.78416] },
                { name: "Huelva", center: [37.26638, -6.94004] },
                { name: "Iaşi", center: [47.16667, 27.6] },
                { name: "Ilford", center: [51.55765, 0.07278] },
                { name: "Ingolstadt", center: [48.76508, 11.42372] },
                { name: "Innsbruck", center: [47.26266, 11.39454] },
                { name: "Ipswich", center: [52.05917, 1.15545] },
                { name: "Irákleion", center: [35.32787, 25.14341] },
                { name: "Islington", center: [51.53622, -0.10304] },
                { name: "Isparta", center: [37.76444, 30.55222] },
                { name: "Istanbul", center: [41.01384, 28.94966] },
                { name: "Ivano-Frankivsk", center: [48.92312, 24.71248] },
                { name: "Iğdır", center: [39.92371, 44.045] },
                { name: "Jaén", center: [37.76922, -3.79028] },
                { name: "Jena", center: [50.92878, 11.5899] },
                { name: "Jerez de la Frontera", center: [36.68645, -6.13606] },
                { name: "Jyväskylä", center: [62.24147, 25.72088] },
                { name: "Jönköping", center: [57.78145, 14.15618] },
                { name: "Kahramanmaraş", center: [37.5847, 36.92641] },
                { name: "Kalisz", center: [51.76109, 18.09102] },
                { name: "Kallithéa", center: [37.95, 23.7] },
                { name: "Kamyanske", center: [48.51716, 34.60617] },
                { name: "Karabağlar", center: [38.382, 27.132] },
                { name: "Karabük", center: [41.20488, 32.62768] },
                { name: "Karaman", center: [37.18111, 33.215] },
                { name: "Karlsruhe", center: [49.00937, 8.40444] },
                { name: "Kassel", center: [51.31667, 9.5] },
                { name: "Kastamonu", center: [41.37805, 33.77528] },
                { name: "Katowice", center: [50.25841, 19.02754] },
                { name: "Kaunas", center: [54.90272, 23.90961] },
                { name: "Kayseri", center: [38.73222, 35.48528] },
                { name: "Kecskemét", center: [46.90618, 19.69128] },
                { name: "Kerch", center: [45.35675, 36.47542] },
                { name: "Kharkiv", center: [49.98177, 36.25475] },
                { name: "Kherson", center: [46.63695, 32.61458] },
                { name: "Khmelnytskyi", center: [49.41835, 26.97936] },
                { name: "Kiel", center: [54.32133, 10.13489] },
                { name: "Kielce", center: [50.87033, 20.62752] },
                { name: "Kilis", center: [36.71611, 37.115] },
                { name: "Kingston upon Hull", center: [53.7446, -0.33525] },
                { name: "Klagenfurt am Wörthersee", center: [46.62472, 14.30528] },
                { name: "Klaipėda", center: [55.7068, 21.13912] },
                { name: "Koblenz", center: [50.35357, 7.57883] },
                { name: "Konya", center: [37.87135, 32.48464] },
                { name: "Korabel", center: [46.61884, 32.5796] },
                { name: "Koszalin", center: [54.19438, 16.17222] },
                { name: "Košice", center: [48.71395, 21.25808] },
                { name: "Kragujevac", center: [44.01667, 20.91667] },
                { name: "Kraków", center: [50.06143, 19.93658] },
                { name: "Kramatorsk", center: [48.73049, 37.58793] },
                { name: "Krefeld", center: [51.33645, 6.55381] },
                { name: "Kremenchuk", center: [49.06253, 33.40484] },
                { name: "Kreuzberg", center: [52.49973, 13.40338] },
                { name: "Kristiansand", center: [58.14671, 7.9956] },
                { name: "Kropyvnytskyy", center: [48.50834, 32.26618] },
                { name: "Kryvyy Rih", center: [47.90572, 33.39404] },
                { name: "Kuopio", center: [62.89238, 27.67703] },
                { name: "Kyiv", center: [50.45466, 30.5238] },
                { name: "Köln", center: [50.93333, 6.95] },
                { name: "Kütahya", center: [39.42417, 29.98333] },
                { name: "Kırıkkale", center: [39.84528, 33.50639] },
                { name: "Kırşehir", center: [39.14583, 34.16389] },
                { name: "Kızıltepe", center: [37.18836, 40.57723] },
                { name: "L'Hospitalet de Llobregat", center: [41.35967, 2.10028] },
                { name: "La Laguna", center: [28.4853, -16.32014] },
                { name: "Lahti", center: [60.98267, 25.66151] },
                { name: "Las Palmas de Gran Canaria", center: [28.09973, -15.41343] },
                { name: "Latina", center: [40.38897, -3.74569] },
                { name: "Lausanne", center: [46.516, 6.63282] },
                { name: "Le Havre", center: [49.49346, 0.10785] },
                { name: "Le Mans", center: [48.0021, 0.20251] },
                { name: "Leeds", center: [53.79648, -1.54785] },
                { name: "Leganés", center: [40.32718, -3.7635] },
                { name: "Legnica", center: [51.21006, 16.1619] },
                { name: "Leicester", center: [52.6386, -1.13169] },
                { name: "Leiden", center: [52.15833, 4.49306] },
                { name: "Leipzig", center: [51.33962, 12.37129] },
                { name: "Leuven", center: [50.87959, 4.70093] },
                { name: "Leverkusen", center: [51.0303, 6.98432] },
                { name: "León", center: [42.60003, -5.57032] },
                { name: "Liberec", center: [50.76711, 15.05619] },
                { name: "Lille", center: [50.63297, 3.05858] },
                { name: "Limoges", center: [45.83362, 1.24759] },
                { name: "Lincoln", center: [53.22683, -0.53792] },
                { name: "Linköping", center: [58.41086, 15.62157] },
                { name: "Linz", center: [48.30639, 14.28611] },
                { name: "Lisbon", center: [38.72509, -9.1498] },
                { name: "Liverpool", center: [53.41058, -2.97794] },
                { name: "Livorno", center: [43.54427, 10.32615] },
                { name: "Liège", center: [50.63373, 5.56749] },
                { name: "Ljubljana", center: [46.05108, 14.50513] },
                { name: "Lleida", center: [41.61674, 0.62218] },
                { name: "Logroño", center: [42.46667, -2.45] },
                { name: "London", center: [51.50853, -0.12574] },
                { name: "Lublin", center: [51.25, 22.56667] },
                { name: "Ludwigshafen am Rhein", center: [49.48121, 8.44641] },
                { name: "Luhansk", center: [48.56814, 39.30553] },
                { name: "Luton", center: [51.87967, -0.41748] },
                { name: "Lutsk", center: [50.75784, 25.35024] },
                { name: "Lviv", center: [49.83826, 24.02324] },
                { name: "Lyon", center: [45.74846, 4.84671] },
                { name: "Lyon 03", center: [45.76124, 4.85184] },
                { name: "Lárisa", center: [39.63689, 22.41761] },
                { name: "Lübeck", center: [53.86893, 10.68729] },
                { name: "Maastricht", center: [50.84833, 5.68889] },
                { name: "Madrid", center: [40.4165, -3.70256] },
                { name: "Madrid Centro", center: [40.41831, -3.70275] },
                { name: "Magdeburg", center: [52.12773, 11.62916] },
                { name: "Maidstone", center: [51.26667, 0.51667] },
                { name: "Mainz", center: [49.98419, 8.2791] },
                { name: "Makiivka", center: [48.04782, 37.92576] },
                { name: "Malatya", center: [38.35018, 38.31667] },
                { name: "Malmö", center: [55.60587, 13.00073] },
                { name: "Maltepe", center: [40.93567, 29.15507] },
                { name: "Manchester", center: [53.48095, -2.23743] },
                { name: "Manisa", center: [38.61202, 27.42647] },
                { name: "Mannheim", center: [49.4891, 8.46694] },
                { name: "Mansfield", center: [53.13333, -1.2] },
                { name: "Marbella", center: [36.51543, -4.88583] },
                { name: "Mardin", center: [37.31309, 40.74357] },
                { name: "Marienthal", center: [53.56667, 10.08333] },
                { name: "Mariupol", center: [47.09514, 37.54131] },
                { name: "Marne La Vallée", center: [48.83584, 2.64241] },
                { name: "Marseille", center: [43.29695, 5.38107] },
                { name: "Marzahn", center: [52.54525, 13.56983] },
                { name: "Mataró", center: [41.54211, 2.4445] },
                { name: "Melitopol", center: [46.84735, 35.38196] },
                { name: "Mendip", center: [51.2372, -2.6266] },
                { name: "Merkezefendi", center: [37.80544, 29.04236] },
                { name: "Mersin", center: [36.81196, 34.63886] },
                { name: "Messina", center: [38.19394, 15.55256] },
                { name: "Mestre", center: [45.49167, 12.24538] },
                { name: "Metz", center: [49.11911, 6.17269] },
                { name: "Middlesbrough", center: [54.57623, -1.23483] },
                { name: "Milan", center: [45.46427, 9.18951] },
                { name: "Milton Keynes", center: [52.04172, -0.75583] },
                { name: "Miskolc", center: [48.10306, 20.77806] },
                { name: "Mitte", center: [52.52003, 13.40489] },
                { name: "Modena", center: [44.64783, 10.92539] },
                { name: "Moers", center: [51.45342, 6.6326] },
                { name: "Mokotów", center: [52.1934, 21.03487] },
                { name: "Moncloa-Aravaca", center: [40.43547, -3.7317] },
                { name: "Montpellier", center: [43.61093, 3.87635] },
                { name: "Montreuil", center: [48.86415, 2.44322] },
                { name: "Monza", center: [45.58005, 9.27246] },
                { name: "Moratalaz", center: [40.40742, -3.64935] },
                { name: "Mostar", center: [43.34333, 17.80806] },
                { name: "Mulhouse", center: [47.75205, 7.32866] },
                { name: "Munich", center: [48.13743, 11.57549] },
                { name: "Muratpaşa", center: [36.89157, 30.76498] },
                { name: "Murcia", center: [37.98704, -1.13004] },
                { name: "Mustafakemalpaşa", center: [40.03815, 28.40866] },
                { name: "Mykolayiv", center: [46.97625, 31.99296] },
                { name: "Málaga", center: [36.72016, -4.42034] },
                { name: "Móstoles", center: [40.32234, -3.86496] },
                { name: "Mönchengladbach", center: [51.18539, 6.44172] },
                { name: "Mülheim", center: [51.43218, 6.87967] },
                { name: "Münster", center: [51.96236, 7.62571] },
                { name: "Namur", center: [50.4669, 4.86746] },
                { name: "Nancy", center: [48.68439, 6.18496] },
                { name: "Nantes", center: [47.21725, -1.55336] },
                { name: "Naples", center: [40.85216, 14.26811] },
                { name: "Nazilli", center: [37.91631, 28.32225] },
                { name: "Neue Neustadt", center: [52.15, 11.63333] },
                { name: "Neukölln", center: [52.47719, 13.43126] },
                { name: "Neuss", center: [51.19807, 6.68504] },
                { name: "Newcastle under Lyme", center: [53.0, -2.23333] },
                { name: "Newcastle upon Tyne", center: [54.97328, -1.61396] },
                { name: "Newport", center: [51.58774, -2.99835] },
                { name: "Nice", center: [43.70313, 7.26608] },
                { name: "Nijmegen", center: [51.8425, 5.85278] },
                { name: "Nikopol", center: [47.56826, 34.39126] },
                { name: "Nippes", center: [50.96545, 6.95314] },
                { name: "Niš", center: [43.32472, 21.90333] },
                { name: "Northampton", center: [52.25, -0.88333] },
                { name: "Norwich", center: [52.62783, 1.29834] },
                { name: "Nottingham", center: [52.9536, -1.15047] },
                { name: "Nou Barris", center: [41.44163, 2.17727] },
                { name: "Novara", center: [45.44694, 8.62118] },
                { name: "Novi Sad", center: [45.25167, 19.83694] },
                { name: "Nyíregyháza", center: [47.95539, 21.71671] },
                { name: "Nîmes", center: [43.83665, 4.35788] },
                { name: "Nürnberg", center: [49.45421, 11.07752] },
                { name: "Oberhausen", center: [51.47805, 6.8625] },
                { name: "Odense", center: [55.39594, 10.38831] },
                { name: "Odesa", center: [46.48572, 30.74383] },
                { name: "Offenbach", center: [50.10061, 8.76647] },
                { name: "Oldenburg", center: [53.14118, 8.21467] },
                { name: "Oldham", center: [53.54051, -2.1183] },
                { name: "Olsztyn", center: [53.77995, 20.49416] },
                { name: "Opole", center: [50.67211, 17.92533] },
                { name: "Oradea", center: [47.0458, 21.91833] },
                { name: "Ordu", center: [40.97782, 37.89047] },
                { name: "Orihuela", center: [38.08483, -0.94401] },
                { name: "Orléans", center: [47.90289, 1.90389] },
                { name: "Oslo", center: [59.91273, 10.74609] },
                { name: "Osmaniye", center: [37.07417, 36.24778] },
                { name: "Osnabrück", center: [52.27264, 8.0498] },
                { name: "Ostrava", center: [49.83465, 18.28204] },
                { name: "Ottakring", center: [48.21667, 16.3] },
                { name: "Oulu", center: [65.01236, 25.46816] },
                { name: "Ourense", center: [42.33669, -7.86407] },
                { name: "Oviedo", center: [43.36029, -5.84476] },
                { name: "Oxford", center: [51.75222, -1.25596] },
                { name: "Paderborn", center: [51.71905, 8.75439] },
                { name: "Padova", center: [45.40797, 11.88586] },
                { name: "Palermo", center: [38.1166, 13.3636] },
                { name: "Palma", center: [39.56939, 2.65024] },
                { name: "Pamplona", center: [42.81687, -1.64323] },
                { name: "Paris", center: [48.85341, 2.3488] },
                { name: "Paris 11e Arrondissement", center: [48.85834, 2.37952] },
                { name: "Paris 12e Arrondissement", center: [48.83523, 2.43505] },
                { name: "Paris 13e Arrondissement", center: [48.8262, 2.35986] },
                { name: "Parla", center: [40.23604, -3.76752] },
                { name: "Parma", center: [44.79935, 10.32618] },
                { name: "Pavlohrad", center: [48.53214, 35.86878] },
                { name: "Peristéri", center: [38.01539, 23.69187] },
                { name: "Perpignan", center: [42.69764, 2.89541] },
                { name: "Perugia", center: [43.1122, 12.38878] },
                { name: "Pescara", center: [42.4584, 14.20283] },
                { name: "Peterborough", center: [52.57364, -0.24777] },
                { name: "Petržalka", center: [48.12331, 17.12866] },
                { name: "Pforzheim", center: [48.88436, 8.69892] },
                { name: "Piacenza", center: [45.05242, 9.69342] },
                { name: "Piatra Neamţ", center: [46.91667, 26.33333] },
                { name: "Pilsen", center: [49.74747, 13.37759] },
                { name: "Piraeus", center: [37.94203, 23.64619] },
                { name: "Pisa", center: [43.70853, 10.4036] },
                { name: "Piteşti", center: [44.85, 24.86667] },
                { name: "Pleven", center: [43.41667, 24.61667] },
                { name: "Ploieşti", center: [44.95, 26.01667] },
                { name: "Plovdiv", center: [42.15, 24.75] },
                { name: "Plymouth", center: [50.37153, -4.14305] },
                { name: "Podgorica", center: [42.44124, 19.26309] },
                { name: "Poltava", center: [49.58925, 34.55367] },
                { name: "Poole", center: [50.71429, -1.98458] },
                { name: "Porto", center: [41.14961, -8.61099] },
                { name: "Portsmouth", center: [50.79899, -1.09125] },
                { name: "Porz am Rhein", center: [50.88637, 7.0583] },
                { name: "Potsdam", center: [52.39886, 13.06566] },
                { name: "Poznań", center: [52.40692, 16.92993] },
                { name: "Praga Południe", center: [52.24424, 21.08545] },
                { name: "Prague", center: [50.08804, 14.42076] },
                { name: "Prato", center: [43.8805, 11.09699] },
                { name: "Prenzlauer Berg", center: [52.53878, 13.42443] },
                { name: "Preston", center: [53.76282, -2.70452] },
                { name: "Puente de Vallecas", center: [40.39354, -3.662] },
                { name: "Pátra", center: [38.24444, 21.73444] },
                { name: "Pécs", center: [46.0725, 18.23083] },
                { name: "Płock", center: [52.54682, 19.70638] },
                { name: "Quarto Oggiaro", center: [45.51314, 9.14343] },
                { name: "Queluz", center: [38.75657, -9.25451] },
                { name: "Radom", center: [51.40253, 21.14714] },
                { name: "Reading", center: [51.45625, -0.97113] },
                { name: "Recklinghausen", center: [51.61379, 7.19738] },
                { name: "Regensburg", center: [49.01513, 12.10161] },
                { name: "Reggio Calabria", center: [38.11047, 15.66129] },
                { name: "Reggio nell'Emilia", center: [44.69825, 10.63125] },
                { name: "Reims", center: [49.26526, 4.02853] },
                { name: "Remscheid", center: [51.17983, 7.1925] },
                { name: "Rennes", center: [48.11198, -1.67429] },
                { name: "Retiro", center: [40.41317, -3.68307] },
                { name: "Reus", center: [41.15612, 1.10687] },
                { name: "Reutlingen", center: [48.49144, 9.20427] },
                { name: "Riga", center: [56.946, 24.10589] },
                { name: "Rijeka", center: [45.32673, 14.44241] },
                { name: "Rimini", center: [44.05755, 12.56528] },
                { name: "Rivne", center: [50.62036, 26.23695] },
                { name: "Rize", center: [41.02083, 40.52194] },
                { name: "Rodenkirchen", center: [50.89328, 6.99481] },
                { name: "Rome", center: [41.89193, 12.51133] },
                { name: "Rostock", center: [54.0887, 12.14049] },
                { name: "Rotherham", center: [53.43012, -1.35678] },
                { name: "Rotterdam", center: [51.9225, 4.47917] },
                { name: "Rouen", center: [49.44313, 1.09932] },
                { name: "Ruda Śląska", center: [50.2584, 18.85632] },
                { name: "Ruse", center: [43.84872, 25.9534] },
                { name: "Rybnik", center: [50.09713, 18.54179] },
                { name: "Rzeszów", center: [50.04132, 21.99901] },
                { name: "Saarbrücken", center: [49.23262, 7.00982] },
                { name: "Sabadell", center: [41.54329, 2.10942] },
                { name: "Saint Peters", center: [51.36667, 1.41667] },
                { name: "Saint-Quentin-en-Yvelines", center: [48.77186, 2.01891] },
                { name: "Saint-Étienne", center: [45.43389, 4.39] },
                { name: "Salamanca", center: [40.96882, -5.66388] },
                { name: "Salamanca", center: [40.42972, -3.67975] },
                { name: "Salerno", center: [40.67545, 14.79328] },
                { name: "Salford", center: [53.48771, -2.29042] },
                { name: "Saltivka", center: [50.02207, 36.34901] },
                { name: "Salzburg", center: [47.79941, 13.04399] },
                { name: "Salzgitter", center: [52.15705, 10.4154] },
                { name: "Samandağ", center: [36.08012, 35.97603] },
                { name: "Samsun", center: [41.27976, 36.3361] },
                { name: "San Blas-Canillejas", center: [40.43893, -3.61537] },
                { name: "Sancaktepe", center: [41.00244, 29.23187] },
                { name: "Sant Andreu", center: [41.43541, 2.18982] },
                { name: "Sant Martí", center: [41.41814, 2.19933] },
                { name: "Santa Coloma de Gramenet", center: [41.45152, 2.2081] },
                { name: "Santa Cruz de Tenerife", center: [28.46824, -16.25462] },
                { name: "Santander", center: [43.46472, -3.80444] },
                { name: "Sants-Montjuïc", center: [41.37263, 2.1546] },
                { name: "Sarajevo", center: [43.84864, 18.35644] },
                { name: "Sarrià-Sant Gervasi", center: [41.40104, 2.1394] },
                { name: "Satu Mare", center: [47.79926, 22.86255] },
                { name: "Schaerbeek", center: [50.86935, 4.37737] },
                { name: "Schöneberg", center: [52.49801, 13.3443] },
                { name: "Sector 1", center: [44.49239, 26.04831] },
                { name: "Sector 2", center: [44.4528, 26.13321] },
                { name: "Sector 3", center: [44.4234, 26.16874] },
                { name: "Sector 4", center: [44.37571, 26.12085] },
                { name: "Sector 5", center: [44.38808, 26.07144] },
                { name: "Sector 6", center: [44.43579, 26.01649] },
                { name: "Setúbal", center: [38.5244, -8.8882] },
                { name: "Sevastopol", center: [44.60795, 33.52134] },
                { name: "Sevilla", center: [37.38283, -5.97317] },
                { name: "Sheffield", center: [53.38297, -1.4659] },
                { name: "Sibiu", center: [45.8, 24.15] },
                { name: "Siegen", center: [50.87481, 8.02431] },
                { name: "Siirt", center: [37.9293, 41.94134] },
                { name: "Simferopol", center: [44.95719, 34.11079] },
                { name: "Simmering", center: [48.18333, 16.43333] },
                { name: "Siracusa", center: [37.07542, 15.28664] },
                { name: "Sivas", center: [39.74833, 37.01611] },
                { name: "Siverek", center: [37.75503, 39.31667] },
                { name: "Skopje", center: [41.99646, 21.43141] },
                { name: "Slough", center: [51.50949, -0.59541] },
                { name: "Sloviansk", center: [48.84974, 37.59739] },
                { name: "Sofia", center: [42.69751, 23.32415] },
                { name: "Solihull", center: [52.41426, -1.78094] },
                { name: "Solingen", center: [51.17343, 7.0845] },
                { name: "Sollentuna", center: [59.42804, 17.95093] },
                { name: "Sosnowiec", center: [50.28682, 19.10385] },
                { name: "South Dublin", center: [53.29026, -6.34151] },
                { name: "Southampton", center: [50.90395, -1.40428] },
                { name: "Southend-on-Sea", center: [51.53782, 0.71433] },
                { name: "Split", center: [43.50891, 16.43915] },
                { name: "St Helens", center: [53.45, -2.73333] },
                { name: "Stara Darnytsya", center: [50.43333, 30.63333] },
                { name: "Stara Zagora", center: [42.43278, 25.64194] },
                { name: "Stavanger", center: [58.97005, 5.73332] },
                { name: "Stockholm", center: [59.32938, 18.06871] },
                { name: "Stockport", center: [53.40979, -2.15761] },
                { name: "Stoke-on-Trent", center: [53.00415, -2.18538] },
                { name: "Strasbourg", center: [48.58392, 7.74553] },
                { name: "Stuttgart", center: [48.78232, 9.17702] },
                { name: "Sultanbeyli", center: [40.96072, 29.27067] },
                { name: "Sultangazi", center: [41.10652, 28.86847] },
                { name: "Sumy", center: [50.91741, 34.79906] },
                { name: "Sunderland", center: [54.90465, -1.38222] },
                { name: "Sutton", center: [51.35, -0.2] },
                { name: "Sutton Coldfield", center: [52.56667, -1.81667] },
                { name: "Swansea", center: [51.62079, -3.94323] },
                { name: "Swindon", center: [51.55797, -1.78116] },
                { name: "Szczecin", center: [53.42894, 14.55302] },
                { name: "Szeged", center: [46.253, 20.14824] },
                { name: "Székesfehérvár", center: [47.18995, 18.41034] },
                { name: "Södermalm", center: [59.31278, 18.07577] },
                { name: "Tallinn", center: [59.43696, 24.75353] },
                { name: "Tampere", center: [61.49911, 23.78712] },
                { name: "Taranto", center: [40.46438, 17.24707] },
                { name: "Targówek", center: [52.29185, 21.04845] },
                { name: "Tarnów", center: [50.01381, 20.98698] },
                { name: "Tarragona", center: [41.11905, 1.24544] },
                { name: "Tarsus", center: [36.91766, 34.89277] },
                { name: "Tekirdağ", center: [40.9781, 27.51101] },
                { name: "Telde", center: [27.99243, -15.41915] },
                { name: "Telford", center: [52.67659, -2.44926] },
                { name: "Terni", center: [42.56335, 12.64329] },
                { name: "Ternopil", center: [49.55404, 25.59067] },
                { name: "Terrassa", center: [41.56667, 2.01667] },
                { name: "Tetuán de las Victorias", center: [40.45975, -3.6975] },
                { name: "The Hague", center: [52.07667, 4.29861] },
                { name: "Thessaloníki", center: [40.64361, 22.93086] },
                { name: "Tilburg", center: [51.55551, 5.0913] },
                { name: "Timişoara", center: [45.75372, 21.22571] },
                { name: "Tirana", center: [41.32744, 19.81866] },
                { name: "Tiraspol", center: [46.84274, 29.62909] },
                { name: "Tokat", center: [40.31389, 36.55444] },
                { name: "Torrejón de Ardoz", center: [40.45535, -3.46973] },
                { name: "Toruń", center: [53.01375, 18.59814] },
                { name: "Tottenham", center: [51.60373, -0.06794] },
                { name: "Toulon", center: [43.12442, 5.92836] },
                { name: "Toulouse", center: [43.60426, 1.44367] },
                { name: "Tours", center: [47.39484, 0.70398] },
                { name: "Trabzon", center: [41.005, 39.72694] },
                { name: "Trento", center: [46.06787, 11.12108] },
                { name: "Trier", center: [49.75565, 6.63935] },
                { name: "Trieste", center: [45.64953, 13.77678] },
                { name: "Trondheim", center: [63.43049, 10.39506] },
                { name: "Turgutlu", center: [38.49533, 27.6997] },
                { name: "Turhal", center: [40.3875, 36.08111] },
                { name: "Turin", center: [45.07049, 7.68682] },
                { name: "Turku", center: [60.45148, 22.26869] },
                { name: "Tuzla", center: [44.53842, 18.66709] },
                { name: "Tychy", center: [50.13717, 18.96641] },
                { name: "Târgu Mureş", center: [46.54245, 24.55747] },
                { name: "Udine", center: [46.0693, 13.23715] },
                { name: "Ulm", center: [48.39841, 9.99155] },
                { name: "Uman", center: [48.7501, 30.21944] },
                { name: "Umeå", center: [63.82842, 20.25972] },
                { name: "Umraniye", center: [41.01643, 29.12476] },
                { name: "Uppsala", center: [59.85882, 17.63889] },
                { name: "Ursynów", center: [52.15051, 21.05041] },
                { name: "Usera", center: [40.38866, -3.70035] },
                { name: "Utrecht", center: [52.09083, 5.12222] },
                { name: "Uzhhorod", center: [48.6242, 22.2947] },
                { name: "Uşak", center: [38.67351, 29.4058] },
                { name: "Valencia", center: [39.47391, -0.37966] },
                { name: "Valladolid", center: [41.65518, -4.72372] },
                { name: "Van", center: [38.49457, 43.38323] },
                { name: "Vantaa", center: [60.29414, 25.04099] },
                { name: "Varna", center: [43.21667, 27.91667] },
                { name: "Venlo", center: [51.37, 6.16806] },
                { name: "Verona", center: [45.43854, 10.9938] },
                { name: "Vicenza", center: [45.54672, 11.5475] },
                { name: "Vienna", center: [48.20849, 16.37208] },
                { name: "Vigo", center: [42.23282, -8.72264] },
                { name: "Villaverde", center: [40.35, -3.7] },
                { name: "Villeurbanne", center: [45.76601, 4.8795] },
                { name: "Vilnius", center: [54.68916, 25.2798] },
                { name: "Vinnytsya", center: [49.2322, 28.46871] },
                { name: "Viranşehir", center: [37.22349, 39.75519] },
                { name: "Vlorë", center: [40.4686, 19.48318] },
                { name: "Västerås", center: [59.61617, 16.55276] },
                { name: "Wakefield", center: [53.68331, -1.49768] },
                { name: "Walsall", center: [52.58528, -1.98396] },
                { name: "Walthamstow", center: [51.59067, -0.02077] },
                { name: "Wandsbek", center: [53.58334, 10.08305] },
                { name: "Warrington", center: [53.39254, -2.58024] },
                { name: "Warsaw", center: [52.22977, 21.01178] },
                { name: "Watford", center: [51.65531, -0.39602] },
                { name: "Wałbrzych", center: [50.77141, 16.28432] },
                { name: "West Bromwich", center: [52.51868, -1.9945] },
                { name: "Wiesbaden", center: [50.08258, 8.24932] },
                { name: "Wigan", center: [53.54296, -2.63706] },
                { name: "Wilmersdorf", center: [52.48333, 13.31667] },
                { name: "Winterthur", center: [47.50564, 8.72413] },
                { name: "Witten", center: [51.44362, 7.35258] },
                { name: "Woking", center: [51.31903, -0.55893] },
                { name: "Wola", center: [52.23477, 20.96004] },
                { name: "Wolfsburg", center: [52.42452, 10.7815] },
                { name: "Wolverhampton", center: [52.58547, -2.12296] },
                { name: "Worcester", center: [52.18935, -2.22001] },
                { name: "Wrocław", center: [51.1, 17.03333] },
                { name: "Wuppertal", center: [51.25627, 7.14816] },
                { name: "Würzburg", center: [49.79391, 9.95121] },
                { name: "Włocławek", center: [52.64817, 19.0678] },
                { name: "Yevpatoriya", center: [45.20091, 33.36655] },
                { name: "York", center: [53.95763, -1.08271] },
                { name: "Zaanstad", center: [52.45313, 4.81356] },
                { name: "Zabrze", center: [50.32492, 18.78576] },
                { name: "Zagreb", center: [45.81444, 15.97798] },
                { name: "Zaporizhzhya", center: [47.85167, 35.11714] },
                { name: "Zaragoza", center: [41.65606, -0.87734] },
                { name: "Zemun", center: [44.8458, 20.40116] },
                { name: "Zenica", center: [44.20169, 17.90397] },
                { name: "Zeytinburnu", center: [40.99441, 28.90417] },
                { name: "Zhytomyr", center: [50.26235, 28.67913] },
                { name: "Zielona Góra", center: [51.93548, 15.50643] },
                { name: "Zoetermeer", center: [52.0575, 4.49306] },
                { name: "Zonguldak", center: [41.45139, 31.79305] },
                { name: "Zugló", center: [47.51758, 19.10549] },
                { name: "Zwolle", center: [52.5125, 6.09444] },
                { name: "Zürich", center: [47.36667, 8.55] },
                { name: "Århus", center: [56.15674, 10.21076] },
                { name: "Çanakkale", center: [40.15552, 26.41271] },
                { name: "Çankaya", center: [39.9179, 32.86268] },
                { name: "Çorlu", center: [41.16069, 27.80093] },
                { name: "Çorum", center: [40.54889, 34.95333] },
                { name: "Örebro", center: [59.27412, 15.2066] },
                { name: "Üsküdar", center: [41.02274, 29.01366] },
                { name: "Čačak", center: [43.89139, 20.34972] },
                { name: "İnegol", center: [40.07806, 29.51333] },
                { name: "İskenderun", center: [36.58718, 36.17347] },
                { name: "İzmir", center: [38.41273, 27.13838] },
                { name: "İzmit", center: [40.76499, 29.92928] },
                { name: "Łódź", center: [51.77058, 19.47395] },
                { name: "Şanlıurfa", center: [37.16708, 38.79392] },
                { name: "Şişli", center: [41.06046, 28.98717] }
            ];

            const randomCity = cities[Math.floor(Math.random() * cities.length)];
            const bgMap = L.map('landingMap', {
                center: randomCity.center,
                zoom: 13,
                zoomControl: false,
                dragging: false,
                touchZoom: false,
                scrollWheelZoom: false,
                doubleClickZoom: false,
                boxZoom: false,
                attributionControl: true
            });

            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                subdomains: 'abcd',
                maxZoom: 20,
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
            }).addTo(bgMap);

            const messages = [
                "Bienvenue sur", "Welcome to", "Willkommen bei", "Bienvenido a", "Bem-vindo a",
                "Welkom bij", "Mirësevini në", "Benvinguts a", "Dobrodošli u", "Добре дошли в",
                "Velkommen til", "Tere tulemast", "Tervetuloa", "Καλώς ήρθατε στο", "Üdvözöljük a",
                "स्वागत है", "Laipni lūdzam", "Sveiki atvykę į", "Wëllkomm op", "Добредојдовте во",
                "Bun venit la", "Witaj w", "Vítejte v", "Vitajte v", "Dobrodošli v",
                "Välkommen till", "Hoş geldiniz", "Ласкаво просимо до", "Добро пожаловать в", "Сардэчна запрашаем у"
            ];

            let currentIndex = Math.floor(Math.random() * messages.length);
            const cyclingText = document.getElementById('cyclingText');
            cyclingText.textContent = messages[currentIndex];

            setInterval(() => {
                cyclingText.classList.remove('text-visible');
                cyclingText.classList.add('text-hidden');
                setTimeout(() => {
                    let nextIndex;
                    do {
                        nextIndex = Math.floor(Math.random() * messages.length);
                    } while (nextIndex === currentIndex);
                    currentIndex = nextIndex;
                    cyclingText.textContent = messages[currentIndex];
                    cyclingText.classList.remove('text-hidden');
                    cyclingText.classList.add('text-visible');
                }, 400);
            }, 3000);

            const searchInput = document.getElementById('landingSearchInput');
            const suggestionsDiv = document.getElementById('landingSuggestions');
            const searchSpinner = document.getElementById('landingSearchSpinner');
            const searchIcon = document.getElementById('landingSearchIcon');
            let searchTimeout = null;

            searchInput.addEventListener('input', function () {
                const query = this.value.trim();
                clearTimeout(searchTimeout);
                if (query.length < 2) {
                    suggestionsDiv.innerHTML = '';
                    suggestionsDiv.classList.remove('visible');
                    return;
                }
                searchTimeout = setTimeout(() => fetchSuggestions(query), 300);
            });

            document.addEventListener('click', function (e) {
                if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.classList.remove('visible');
                }
            });

            searchInput.addEventListener('focus', function () {
                if (suggestionsDiv.children.length > 0) suggestionsDiv.classList.add('visible');
            });

            async function fetchSuggestions(query) {
                searchSpinner.style.display = 'inline-block';
                searchIcon.style.display = 'none';
                try {
                    const response = await fetch(`/api/search_stops?query=${encodeURIComponent(query)}`);
                    const data = await response.json();
                    if (response.ok) renderSuggestions(data);
                } catch (err) { console.error(err); }
                finally {
                    searchSpinner.style.display = 'none';
                    searchIcon.style.display = '';
                }
            }

            function renderSuggestions(suggestions) {
                suggestionsDiv.innerHTML = '';
                if (!suggestions.length) {
                    // Traduction SSR injectée dans le JS !
                    suggestionsDiv.innerHTML = `<div style="padding:14px;text-align:center;color:#9aa0a6;">{{ t('no_stop_found') }}</div>`;
                    suggestionsDiv.classList.add('visible');
                    return;
                }
                suggestions.forEach(stop => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.textContent = stop.stop_name;
                    item.onclick = () => {
                        saveRecentSearch(stop.stop_id, stop.stop_name);
                        // Redirection avec la bonne URL sémantique via Jinja
                        window.location.href = `{{ url_for_page('map') }}?stop_id=${stop.stop_id}`;
                    };
                    suggestionsDiv.appendChild(item);
                });
                suggestionsDiv.classList.add('visible');
            }

            function saveRecentSearch(id, name) {
                let recents = JSON.parse(localStorage.getItem('linia_recents') || '[]');
                recents = recents.filter(r => r.id !== id);
                recents.unshift({ id, name, date: new Date().getTime() });
                if (recents.length > 5) recents.pop();
                localStorage.setItem('linia_recents', JSON.stringify(recents));
            }

            function loadRecents() {
                const recentList = document.getElementById('recentSearchesList');
                if (!recentList) return;
                const recents = JSON.parse(localStorage.getItem('linia_recents') || '[]');
                if (recents.length === 0) {
                    recentList.innerHTML = '<p class="empty-recents">Vos recherches récentes apparaîtront ici.</p>';
                    return;
                }
                recentList.innerHTML = recents.map(r => `
                    <div class="recent-item" onclick="window.location.href='{{ url_for_page('map') }}?stop_id=${r.id}'">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span>${r.name}</span>
                    </div>
                `).join('');
            }

            loadRecents();
        });
    </script>
</body>

</html>

--- FIN FICHIER ---

--- DÉBUT FICHIER : templates\legal.html ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\templates\legal.html ---

<!DOCTYPE html>
<html lang="{{ current_lang }}">

<head>
    {% include 'seo_head.html' %}
    <style>
        .legal-content h2 {
            margin-top: 30px;
            color: var(--primary-green);
            font-size: 1.2rem;
        }

        .legal-content p {
            line-height: 1.6;
            opacity: 0.8;
            margin-bottom: 15px;
        }
    </style>
</head>

<body>
    <div class="about-page">
        <nav class="about-nav">
            <a class="nav-brand" href="{{ url_for_page('home') }}"><span class="highlight">Linia</span></a>
            <div style="flex-grow: 1;"></div>
            <a class="nav-link" href="{{ url_for_page('home') }}" style="margin-left: 0;">{{ t('return_home') }}</a>
        </nav>

        <div class="about-content legal-content">
            <h1>{{ t('legal_title') }}</h1>

            <section class="about-section">
                <h2>{{ t('legal_editor_title') }}</h2>
                <p>{{ t('legal_editor_content') }}</p>
            </section>

            <section class="about-section">
                <h2>{{ t('legal_hosting_title') }}</h2>
                <p>{{ t('legal_hosting_content') }}</p>
            </section>

            <section class="about-section">
                <h2>{{ t('legal_intellectual_title') }}</h2>
                <p>{{ t('legal_intellectual_content') }}</p>
            </section>

            <section class="about-section">
                <h2>{{ t('legal_responsibility_title') }}</h2>
                <p>{{ t('legal_responsibility_content') }}</p>
            </section>

            <section class="about-section">
                <h2>{{ t('legal_privacy_title') }}</h2>
                <p>{{ t('legal_privacy_content') }}</p>
            </section>
        </div>

        <footer class="linia-footer">
            <div class="footer-signature-container">
                <a href="https://strakaza.fr" class="signature-link">{{ t('footer_signature') }}</a>
                <div class="color-bar-signature"></div>
            </div>
        </footer>

        <nav class="bottom-nav">
            <a class="bottom-nav-item" href="{{ url_for_page('home') }}">
                <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2" viewBox="0 0 24 24" width="24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>{{ t('nav_home') }}</span>
            </a>
            <a class="bottom-nav-item" href="{{ url_for_page('planner') }}">
                <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2" viewBox="0 0 24 24" width="24">
                    <circle cx="6" cy="19" r="3"></circle>
                    <path d="M9 19h8.5a3.5 3.5 0 1 0 0-7h-11a3.5 3.5 0 1 1 0-7H15"></path>
                    <circle cx="18" cy="5" r="3"></circle>
                </svg>
                <span>{{ t('nav_itinerary') }}</span>
            </a>
            <a class="bottom-nav-item" href="{{ url_for_page('about') }}">
                <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2" viewBox="0 0 24 24" width="24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" x2="12" y1="16" y2="12"></line>
                    <line x1="12" x2="12.01" y1="8" y2="8"></line>
                </svg>
                <span>{{ t('nav_info') }}</span>
            </a>
        </nav>
    </div>
</body>

</html>

--- FIN FICHIER ---

--- DÉBUT FICHIER : templates\map.html ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\templates\map.html ---

<!DOCTYPE html>
<html lang="{{ current_lang }}">

<head>
    {% include 'seo_head.html' %}
    <link crossorigin="" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" rel="stylesheet" />
</head>

<body>
    {% set lang_prefix = '' if current_lang == 'fr' else '/' ~ current_lang %}
    <div class="map-page">
        <div id="map"></div>

        <a class="expanding-nav-btn nav-btn-home" href="{{ url_for_page('home') }}" data-label="{{ t('nav_home') }}">
            <svg class="svgIcon" fill="none" height="24" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        </a>

        <a class="expanding-nav-btn nav-btn-planner" href="{{ url_for_page('planner') }}"
            data-label="{{ t('nav_itinerary') }}">
            <svg class="svgIcon" fill="none" height="22" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" width="22">
                <circle cx="6" cy="19" r="3"></circle>
                <path d="M9 19h8.5a3.5 3.5 0 1 0 0-7h-11a3.5 3.5 0 1 1 0-7H15"></path>
                <circle cx="18" cy="5" r="3"></circle>
            </svg>
        </a>

        <div class="trip-details-panel" id="tripDetailsPanel">
            <div class="trip-details-header">
                <div class="trip-details-title-container">
                    <h3 id="tripPanelTitle"></h3>
                    <span class="trip-details-subtitle" id="tripPanelSubtitle"></span>
                </div>
                <button class="trip-details-close" id="tripPanelClose" title="{{ t('btn_close') }}">×</button>
            </div>
            <div class="trip-details-body" id="tripPanelBody">
            </div>
        </div>

        <div class="map-search-bar-container">
            <div class="map-search-wrapper">
                <input autocomplete="off" class="map-search-bar" id="mapSearchInput"
                    placeholder="{{ t('search_start') }}" type="text" />
                <svg class="map-search-icon" fill="none" height="18" id="mapSearchIcon" stroke="currentColor"
                    stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="18">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" x2="16.65" y1="21" y2="16.65"></line>
                </svg>
                <div class="spinner map-search-spinner" id="mapSearchSpinner" style="display:none;"></div>
            </div>
            <div class="map-suggestions" id="mapSuggestions"></div>
        </div>

        <div class="loading-overlay" id="loadingOverlay">
            <div class="spinner"></div>
            <span id="loadingText" style="margin-top: 10px;">{{ t('loading') }}</span>
        </div>

        <button class="reopen-panel-btn" id="reopenPanelBtn" style="display:none;" title="Afficher les lignes">
            <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                stroke-width="2.5" viewBox="0 0 24 24" width="24">
                <polyline points="18 15 12 9 6 15"></polyline>
            </svg>
        </button>

        <div class="route-panel" id="routePanel">
            <div class="route-panel-header">
                <div>
                    <h2 id="routePanelTitle">{{ t('loading') }}</h2>
                    <div class="operator-legend" id="operatorLegend" style="display:none;">
                        <div class="legend-item"><span class="legend-color-box legend-flixbus"></span> Flixbus</div>
                        <div class="legend-item"><span class="legend-color-box legend-blablacar"></span> BlaBlaCar</div>
                    </div>
                </div>
                <button class="route-panel-close" id="routePanelClose">×</button>
            </div>
            <div class="route-controls">
                <div class="filter-pills">
                    <button class="filter-pill active" data-filter="all">Tout</button>
                    <button class="filter-pill" data-filter="flixbus">Flixbus</button>
                    <button class="filter-pill" data-filter="blablacar_bus">BlaBlaCar</button>
                </div>
                <div class="route-filter-search">
                    <input id="routeLocalSearch" data-i18n-placeholder="search_city"
                        placeholder="🔍 Rechercher une ville..." type="text" />
                </div>
            </div>
            <div class="route-panel-body" id="routePanelBody">
            </div>
        </div>
        {% if preloaded_start_id and preloaded_end_id %}
        <div class="sr-only"
            style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0;">
            <h1>Trajet en bus de {{ city_a_name }} à {{ city_b_name }}</h1>
            <p>La distance entre {{ city_a_name }} et {{ city_b_name }} est couverte par les opérateurs de bus longue
                distance comme FlixBus et BlaBlaCar Bus. Consultez notre carte interactive pour visualiser le tracé de
                ce trajet complet et préparez votre voyage en bus.</p>
        </div>
        {% elif connected_destinations %}
        <div class="sr-only"
            style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0;">
            <h1>Trajets en bus au départ de {{ preloaded_stop_name }}</h1>
            <p>Découvrez les lignes de bus directes (Flixbus, BlaBlaCar Bus) depuis {{ preloaded_stop_name }} vers les
                destinations suivantes :</p>
            <ul>
                {% for dest in connected_destinations %}
                <li><a href="{{ dest.url }}">Bus {{ preloaded_stop_name }} - {{ dest.name }}</a></li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        <footer class="app-footer"
            style="position: absolute; bottom: 0; padding: 12px; font-size: 11px; pointer-events: none; z-index: 10000;">
            <p style="margin-bottom: 4px;">{{ t('footer_signature') }}</p>
            <div class="color-bar-signature" style="max-width: 150px;"></div>
        </footer>
        <nav class="bottom-nav">
            <a class="bottom-nav-item" href="{{ url_for_page('home') }}">
                <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2" viewBox="0 0 24 24" width="24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>{{ t('nav_home') }}</span>
            </a>
            <a class="bottom-nav-item" href="{{ url_for_page('planner') }}">
                <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2" viewBox="0 0 24 24" width="24">
                    <circle cx="6" cy="19" r="3"></circle>
                    <path d="M9 19h8.5a3.5 3.5 0 1 0 0-7h-11a3.5 3.5 0 1 1 0-7H15"></path>
                    <circle cx="18" cy="5" r="3"></circle>
                </svg>
                <span>{{ t('nav_itinerary') }}</span>
            </a>
            <a class="bottom-nav-item" href="{{ url_for_page('about') }}">
                <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2" viewBox="0 0 24 24" width="24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" x2="12" y1="16" y2="12"></line>
                    <line x1="12" x2="12.01" y1="8" y2="8"></line>
                </svg>
                <span>{{ t('nav_info') }}</span>
            </a>
        </nav>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <script crossorigin="" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    {% if preloaded_stop_id %}
    <script>
        window.PRELOADED_STOP_ID = "{{ preloaded_stop_id }}";
        window.PRELOADED_STOP_NAME = "{{ preloaded_stop_name }}";
    </script>
    {% endif %}
    {% if preloaded_start_id and preloaded_end_id %}
    <script>
        window.PRELOADED_START_ID = "{{ preloaded_start_id }}";
        window.PRELOADED_END_ID = "{{ preloaded_end_id }}";
        window.CITY_A_NAME = "{{ city_a_name }}";
        window.CITY_B_NAME = "{{ city_b_name }}";
    </script>
    {% endif %}

    <script src="{{ url_for('static', filename='map.js') }}"></script>
</body>

</html>

--- FIN FICHIER ---

--- DÉBUT FICHIER : templates\planner.html ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\templates\planner.html ---

<!DOCTYPE html>
<html lang="{{ current_lang }}">

<head>
    {% include 'seo_head.html' %}
    <link crossorigin="" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" rel="stylesheet" />
</head>

<body class="planner-body">
    <div class="planner-page">
        <svg style="width:0;height:0;position:absolute;">
            <defs>
                <linearGradient id="mixedGradient" x1="0%" x2="100%" y1="0%" y2="0%">
                    <stop offset="0%" style="stop-color:#73d700;stop-opacity:1"></stop>
                    <stop offset="100%" style="stop-color:#0070d2;stop-opacity:1"></stop>
                </linearGradient>
            </defs>
        </svg>

        <div id="plannerMap"></div>

        <a class="expanding-nav-btn nav-btn-home" href="{{ url_for_page('home') }}" data-label="{{ t('nav_home') }}">
            <svg class="svgIcon" fill="none" height="24" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        </a>

        <div class="planner-sidebar" id="plannerSidebar">
            <div class="planner-sidebar-header">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <h2>{{ t('itinerary_title') }}</h2>
                    <button class="minimize-sidebar-btn" id="minimizeSidebarBtn"
                        title="{{ t('btn_close') | default('Fermer') }}"
                        style="display: none; background: none; border: none; cursor: pointer; color: var(--text-secondary);">
                        <svg fill="none" height="20" stroke="currentColor" stroke-linecap="round"
                            stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                </div>
                <div class="planner-sidebar-actions">
                    <button class="planner-btn planner-btn-ghost" disabled="" id="undoBtn" title="{{ t('btn_undo') }}">
                        <svg fill="none" height="16" stroke="currentColor" stroke-linecap="round"
                            stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="16">
                            <polyline points="1 4 1 10 7 10"></polyline>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                        </svg>
                    </button>
                    <button class="planner-btn planner-btn-ghost" disabled="" id="resetBtn"
                        title="{{ t('btn_reset') }}">
                        <svg fill="none" height="16" stroke="currentColor" stroke-linecap="round"
                            stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="16">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="planner-sidebar-body" id="plannerTimeline">
                <div class="planner-empty-state">
                    <svg fill="none" height="48" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="1" style="opacity:0.3; margin-bottom:12px;" viewBox="0 0 24 24" width="48">
                        <circle cx="12" cy="10" r="3"></circle>
                        <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z"></path>
                    </svg>
                    <p>{{ t('planner_empty') }}</p>
                </div>
            </div>

            <div class="planner-disclaimer collapsed" id="plannerDisclaimer">
                <div class="disclaimer-header"
                    style="display: flex; justify-content: space-between; align-items: center; width: 100%; cursor: pointer;"
                    onclick="document.getElementById('plannerDisclaimer').classList.toggle('collapsed')">
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                            width="16">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" x2="12" y1="16" y2="12"></line>
                            <line x1="12" x2="12.01" y1="8" y2="8"></line>
                        </svg>
                        <strong>{{ t('disclaimer_title') }}</strong>
                    </div>
                    <svg fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" width="16">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </div>
                <div class="disclaimer-content-wrapper">
                    <p id="disclaimerText">{{ t('disclaimer_text') }}</p>
                </div>
            </div>

            <div class="planner-sidebar-footer" id="plannerFooter">
                <input accept=".json" id="loadItineraryInput" style="display: none;" type="file" />
                <div style="display: flex; gap: 8px; width: 100%; margin-bottom: 8px; align-items: center;">
                    <button class="planner-footer-btn" id="loadBtn" title="{{ t('btn_load') }}"
                        style="flex: 1; margin: 0;">
                        <svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                            width="20">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" x2="12" y1="15" y2="3"></line>
                        </svg>
                        <span>{{ t('btn_load') }}</span>
                    </button>
                    <div class="planner-footer-divider"></div>
                    <button class="planner-footer-btn" id="saveBtn" title="{{ t('btn_save') }}"
                        style="flex: 1; margin: 0;">
                        <svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                            width="20">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        <span>{{ t('btn_save') }}</span>
                    </button>
                </div>
                <!-- Premium Buttons Row -->
                <div style="display: flex; gap: 8px; width: 100%;">
                    <button class="linia-btn-premium" id="shareBtn" style="flex: 1; margin: 0;"
                        title="{{ t('btn_share') | default('Partager') }}">
                        <svg fill="none" height="18" stroke="currentColor" stroke-linecap="round"
                            stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="18">
                            <circle cx="18" cy="5" r="3"></circle>
                            <circle cx="6" cy="12" r="3"></circle>
                            <circle cx="18" cy="19" r="3"></circle>
                            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                        </svg>
                        <span>{{ t('btn_share') | default('Partager') }}</span>
                    </button>
                    <button class="linia-btn-premium" id="generatePdfBtn" style="flex: 1; margin: 0;">
                        <svg fill="none" height="16" stroke="currentColor" stroke-linecap="round"
                            stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="16">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" x2="8" y1="13" y2="13"></line>
                            <line x1="16" x2="8" y1="17" y2="17"></line>
                        </svg>
                        <span>{{ t('btn_pdf') }}</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="planner-search-container" id="plannerSearchContainer">
            <div class="planner-search-wrapper">
                <input autocomplete="off" class="planner-search-bar" id="plannerSearchInput"
                    placeholder="{{ t('search_start') }}" type="text" />
                <svg class="planner-search-icon" fill="none" height="18" id="plannerSearchIcon" stroke="currentColor"
                    stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="18">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" x2="16.65" y1="21" y2="16.65"></line>
                </svg>
                <div class="spinner planner-search-spinner" id="plannerSearchSpinner" style="display:none;"></div>
            </div>
            <div class="planner-suggestions" id="plannerSuggestions"></div>
        </div>

        <div class="planner-connected-panel" id="connectedPanel">
            <div class="planner-connected-header">
                <div>
                    <h3 id="connectedTitle">{{ t('connected_cities') }}</h3>
                    <span class="planner-connected-subtitle" id="connectedSubtitle"></span>
                </div>
                <button class="planner-connected-close" id="connectedClose" title="{{ t('btn_close') }}">×</button>
            </div>
            <div class="planner-connected-search">
                <input id="connectedSearchInput" placeholder="{{ t('filter_cities') }}" type="text" />
            </div>
            <div class="planner-connected-body" id="connectedBody">
            </div>
        </div>

        <button class="expanding-nav-btn nav-btn-reopen-connected" id="reopenConnectedBtn" style="display:none;"
            title="{{ t('btn_reopen') | default('Rouvrir') }}">
            <svg class="svgIcon" fill="none" height="22" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" width="22">
                <polyline points="18 15 12 9 6 15"></polyline>
            </svg>
        </button>

        <div class="planner-bubble" id="plannerBubble" style="display: none;">
            <div class="planner-bubble-content" id="plannerBubbleContent">
                <span id="plannerBubbleText"></span>
            </div>
        </div>


        <nav class="bottom-nav">
            <a class="bottom-nav-item" href="{{ url_for_page('home') }}">
                <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2" viewBox="0 0 24 24" width="24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>{{ t('nav_home') }}</span>
            </a>
            <a class="bottom-nav-item active" href="{{ url_for_page('planner') }}">
                <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2" viewBox="0 0 24 24" width="24">
                    <circle cx="6" cy="19" r="3"></circle>
                    <path d="M9 19h8.5a3.5 3.5 0 1 0 0-7h-11a3.5 3.5 0 1 1 0-7H15"></path>
                    <circle cx="18" cy="5" r="3"></circle>
                </svg>
                <span>{{ t('nav_itinerary') }}</span>
            </a>
            <a class="bottom-nav-item" href="{{ url_for_page('about') }}">
                <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2" viewBox="0 0 24 24" width="24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" x2="12" y1="16" y2="12"></line>
                    <line x1="12" x2="12.01" y1="8" y2="8"></line>
                </svg>
                <span>{{ t('nav_info') }}</span>
            </a>
        </nav>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <svg class="pl" viewBox="0 0 160 160" width="160px" height="160px" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <linearGradient id="grad" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0%" stop-color="#000"></stop>
                    <stop offset="100%" stop-color="#fff"></stop>
                </linearGradient>
                <mask id="mask1">
                    <rect x="0" y="0" width="160" height="160" fill="url(#grad)"></rect>
                </mask>
                <mask id="mask2">
                    <rect x="28" y="28" width="104" height="104" fill="url(#grad)"></rect>
                </mask>
            </defs>
            <g>
                <g class="pl__ring-rotate">
                    <circle class="pl__ring-stroke" cx="80" cy="80" r="72" fill="none" stroke="var(--linia-orange)"
                        stroke-width="16" stroke-dasharray="452.39 452.39" stroke-dashoffset="452"
                        stroke-linecap="round" transform="rotate(-45,80,80)"></circle>
                </g>
            </g>
            <g mask="url(#mask1)">
                <g class="pl__ring-rotate">
                    <circle class="pl__ring-stroke" cx="80" cy="80" r="72" fill="none" stroke="var(--linia-purple)"
                        stroke-width="16" stroke-dasharray="452.39 452.39" stroke-dashoffset="452"
                        stroke-linecap="round" transform="rotate(-45,80,80)"></circle>
                </g>
            </g>
            <g>
                <g stroke-width="4" stroke-dasharray="12 12" stroke-dashoffset="12" stroke-linecap="round"
                    transform="translate(80,80)">
                    <polyline class="pl__tick" stroke="#e0dfe6" points="0,2 0,14"
                        transform="rotate(-135,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#e0dfe6" points="0,2 0,14"
                        transform="rotate(-90,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#e0dfe6" points="0,2 0,14"
                        transform="rotate(-45,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#e0dfe6" points="0,2 0,14"
                        transform="rotate(0,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#e0dfe6" points="0,2 0,14"
                        transform="rotate(45,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#e0dfe6" points="0,2 0,14"
                        transform="rotate(90,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#e0dfe6" points="0,2 0,14"
                        transform="rotate(135,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#e0dfe6" points="0,2 0,14"
                        transform="rotate(180,0,0) translate(0,40)"></polyline>
                </g>
            </g>
            <g mask="url(#mask1)">
                <g stroke-width="4" stroke-dasharray="12 12" stroke-dashoffset="12" stroke-linecap="round"
                    transform="translate(80,80)">
                    <polyline class="pl__tick" stroke="#9b9bc4" points="0,2 0,14"
                        transform="rotate(-135,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#9b9bc4" points="0,2 0,14"
                        transform="rotate(-90,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#9b9bc4" points="0,2 0,14"
                        transform="rotate(-45,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#9b9bc4" points="0,2 0,14"
                        transform="rotate(0,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#9b9bc4" points="0,2 0,14"
                        transform="rotate(45,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#9b9bc4" points="0,2 0,14"
                        transform="rotate(90,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#9b9bc4" points="0,2 0,14"
                        transform="rotate(135,0,0) translate(0,40)"></polyline>
                    <polyline class="pl__tick" stroke="#9b9bc4" points="0,2 0,14"
                        transform="rotate(180,0,0) translate(0,40)"></polyline>
                </g>
            </g>
            <g>
                <g transform="translate(64,28)">
                    <g class="pl__arrows" transform="rotate(45,16,52)">
                        <path fill="var(--linia-teal)"
                            d="M17.998,1.506l13.892,43.594c.455,1.426-.56,2.899-1.998,2.899H2.108c-1.437,0-2.452-1.473-1.998-2.899L14.002,1.506c.64-2.008,3.356-2.008,3.996,0Z">
                        </path>
                        <path fill="var(--linia-purple)"
                            d="M14.009,102.499L.109,58.889c-.453-1.421,.559-2.889,1.991-2.889H29.899c1.433,0,2.444,1.468,1.991,2.889l-13.899,43.61c-.638,2.001-3.345,2.001-3.983,0Z">
                        </path>
                    </g>
                </g>
            </g>
            <g mask="url(#mask2)">
                <g transform="translate(64,28)">
                    <g class="pl__arrows" transform="rotate(45,16,52)">
                        <path fill="var(--linia-orange)"
                            d="M17.998,1.506l13.892,43.594c.455,1.426-.56,2.899-1.998,2.899H2.108c-1.437,0-2.452-1.473-1.998-2.899L14.002,1.506c.64-2.008,3.356-2.008,3.996,0Z">
                        </path>
                        <path fill="var(--linia-teal)"
                            d="M14.009,102.499L.109,58.889c-.453-1.421,.559-2.889,1.991-2.889H29.899c1.433,0,2.444,1.468,1.991,2.889l-13.899,43.61c-.638,2.001-3.345,2.001-3.983,0Z">
                        </path>
                    </g>
                </g>
            </g>
        </svg>
        <span id="loadingText" style="margin-top: 10px;">{{ t('loading') }}</span>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <script>window.L_DISABLE_3D = true;</script>
    <script crossorigin="" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="{{ url_for('static', filename='planner.js') }}"></script>
</body>

</html>

--- FIN FICHIER ---

--- DÉBUT FICHIER : templates\seo_head.html ---
--- POSITION : C:\Users\Amédée\Documents\linia-mobile\templates\seo_head.html ---

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
{# Title & meta description dynamiques #}
<title>{{ page_title }}</title>
<meta name="description" content="{{ page_description }}">

{# Robots par défaut index/follow, surcharge possible plus tard #}
<meta name="robots" content="index,follow">

{# Canonical #}
<link rel="canonical" href="{{ canonical_url }}">

{# Open Graph #}
<meta property="og:image" content="https://liniabus.eu/static/og-image.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:image" content="https://liniabus.eu/static/og-image.jpg">
{% if og_locale %}
<meta property="og:locale" content="{{ og_locale }}">
{% endif %}
{% if og_locale_alternates %}
{% for locale in og_locale_alternates %}
<meta property="og:locale:alternate" content="{{ locale }}">
{% endfor %}
{% endif %}

{# Twitter #}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ og_url }}">
<meta name="twitter:title" content="{{ og_title }}">
<meta name="twitter:description" content="{{ og_description }}">
<meta name="twitter:image" content="https://liniabus.eu/static/logo.png">

{# PWA / assets #}
<meta name="theme-color" content="#34a853">
<link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
<link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">

{# CSS global #}
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=3">

{# Hreflang alternates #}
{% include 'hreflang.html' %}

{# JSON-LD structured data optionnel #}
{% if structured_data_jsonld %}
<script type="application/ld+json">
{{ structured_data_jsonld | safe }}
</script>
{% endif %}

{# Script i18n global #}
<script>
    window.CURRENT_LANG = {{ current_lang | tojson }};
    window.TRANSLATIONS = {{ t_dict | tojson }};
</script>
<script src="{{ url_for('static', filename='i18n.js') }}" defer></script>

--- FIN FICHIER ---

